<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="Nginx ç½‘ç»œåè®® DNS äº‘è®¡ç®—">
<meta name="description" content="">
<meta name="theme-color" content="#000">
<title>å…³äº | ygçš„å°ç«™</title>
<link rel="shortcut icon" href="/favicon.ico?v=1601817694435">
<link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet" href="/media/css/mist.css">

<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/github.css"
  rel="stylesheet">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163205066-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-163205066-1');
</script>


<script>
  var _hmt = _hmt || [];
  (function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?1be048b8c5c87a450b605c349e64ca47";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>

  <meta name="description" content="å…³äº" />
  <meta name="keywords" content="" />
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class=" mist">
  <header class="header bg-color ">
    <div class="blog-header box-shadow-wrapper  " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="">
              <span class="logo-line-before">
                <i class=""></i>
              </span>
              <span class="main-title">ygçš„å°ç«™</span>
              <span class="logo-line-after">
                <i class=""></i>
              </span>
            </a>  
          
        </div>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> é¦–é¡µ
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> å½’æ¡£
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> æ ‡ç­¾
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> å…³äº
                </a>
              
            </li>
          
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout mist bg-color">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper  right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active">æ–‡ç« ç›®å½•</span>
            <span id="metaSideBar" class="sidebar-title-item">ç«™ç‚¹æ¦‚è§ˆ</span>
          </div>
        </div>
      
      <div class="sidebar-body mist" id="sidebar_body">
        
          
            <div class="post-side-meta" id="post_side_meta">
              
<div class="sidebar-wrapper box-shadow-wrapper ">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">ygçš„å°ç«™</p>
    <p class="site-description right-motion">Day day up!</p>
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">8</span>
        <span class="site-item-stat-name">æ–‡ç« </span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">8</span>
        <span class="site-item-stat-name">åˆ†ç±»</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">8</span>
        <span class="site-item-stat-name">æ ‡ç­¾</span>
      </a>
    </div>
  </div>
  
  
    <div class="sidebar-item sidebar-item-social">
      <div class="social-item">
        
          
            <a href="https://github.com/xly0713">
              <i class="fa fa-github-alt" title="Github"></i>
            </a>
          
        
        
      </div>
    </div>
  

  


</div>
            </div>
            <div class="post-toc sidebar-body-active" id="post_toc" style="opacity: 1;">
              <div class="toc-box right-motion">
  <div class="toc-wrapper auto-number no_compress"
    id="toc_wrapper">
    <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99">ğŸ  å…³äºæœ¬ç«™</a></li>
<li><a href="#%E5%8D%9A%E4%B8%BB%E6%98%AF%E8%B0%81">ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°</a></li>
<li><a href="#%E8%81%94%E7%B3%BB%E6%88%91%E5%91%80">ğŸ“¬ è”ç³»æˆ‘å‘€</a></li>
</ul>
</li>
</ul>

  </div>
</div>

<script>

  let lastTop = 0, lList = [], hList = [], postBody, lastIndex = -1;
  let active = 'active-show', activeClass = 'active-current';
  let tocWrapper = document.querySelector('#toc_wrapper');
  let tocContent = tocWrapper.children[0];
  let autoNumber = tocWrapper && tocWrapper.classList.contains('auto-number');

  function addTocNumber(elem, deep) {
    if (!elem) {
      return;
    }
    let prop = elem.__proto__;

    if (prop === HTMLUListElement.prototype) {
      for (let i = 0; i < elem.children.length; i++) {
        addTocNumber(elem.children[i], deep + (i + 1) + '.');
      }
    } else if (prop === HTMLLIElement.prototype) {
      // ä¿å­˜liå…ƒç´ 
      if (elem.children[0].__proto__ === HTMLAnchorElement.prototype) {
        lList.push(elem);
      }
      for (let i = 0; i < elem.children.length; i++) {
        let cur = elem.children[i];
        if (cur.__proto__ === HTMLAnchorElement.prototype) {
          if (autoNumber) {
            cur.text = deep + ' ' + cur.text;
          }
        } else if (cur.__proto__ === HTMLUListElement.prototype) {
          addTocNumber(cur, deep);
        }
      }
    }
  }

  function removeParentActiveClass() {
    let parents = tocContent.querySelectorAll('.' + active)
    parents.forEach(function (elem) {
      elem.classList.remove(active);
    });
  }

  function addActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.add(activeClass);
    }
  }

  function removeActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.remove(activeClass);
    }
  }

  function addActiveLiElemment(elem, parent) {
    if (!elem || elem === parent) {
      return;
    } else {
      if (elem.__proto__ === HTMLLIElement.prototype) {
        elem.classList.add(active);
      }
      addActiveLiElemment(elem.parentElement, parent);
    }
  }

  function showToc() {
    if (tocWrapper) {
      postBody = document.querySelector('#post_body');
      for (let i = 0; i < postBody.children.length; i++) {
        if (postBody.children[i].__proto__ === HTMLHeadingElement.prototype) {
          hList.push(postBody.children[i]);
        }
      }
      if (tocWrapper.classList.contains('compress')) {
        tocContent.classList.add('closed');
      } else if (tocWrapper.classList.contains('no_compress')) {
        tocContent.classList.add('expanded');
      } else {
        if (hList.length > 10) {
          active = 'active-hidden'
          tocContent.classList.add('closed');
        } else {
          tocContent.classList.add('expanded');
        }
      }
    }
  }

  (function () {
    // å¤„ç†ä¸æ˜¯ä»#ä¸€çº§æ ‡é¢˜å¼€å§‹ç›®å½•
    if (tocContent.children.length === 1 && tocContent.children[0].__proto__ === HTMLLIElement.prototype) {
      let con = tocContent.children[0].children[0];
      tocContent.innerHTML = con.innerHTML;
    }
    let markdownItTOC = document.querySelector('.markdownIt-TOC');
    let innerHeight = window.innerHeight;
    markdownItTOC.style = `max-height: ${innerHeight - 80 > 0 ? innerHeight - 80 : innerHeight}px`
    addTocNumber(tocContent, '');
  })();

  document.addEventListener('scroll', function (e) {
    if (lList.length <= 0) {
      return;
    }
    let scrollTop = document.scrollingElement.scrollTop + 10;
    let dir;

    if (lastTop - scrollTop > 0) {
      dir = 'up';
    } else {
      dir = 'down';
    }

    lastTop = scrollTop;
    if (scrollTop <= 0) {
      if (lastIndex >= 0 && lastIndex < hList.length) {
        lList[lastIndex].classList.remove(activeClass);
      }
      return;
    }

    let current = 0, hasFind = false;
    for (let i = 0; i < hList.length; i++) {
      if (hList[i].offsetTop > scrollTop) {
        current = i;
        hasFind = true;
        break;
      }
    }
    if (!hasFind && scrollTop > lList[lList.length - 1].offsetTop) {
      current = hList.length - 1;
    } else {
      current--;
    }
    if (dir === 'down') {
      if (current > lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex)
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    } else {
      if (current < lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex);
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    }
  });


  window.addEventListener('load', function () {
    showToc();
    document.querySelector('#sidebar').style = 'display: block;';
    tocWrapper.classList.add('toc-active');
    setTimeout(function () {
      if ("createEvent" in document) {
        let evt = document.createEvent("HTMLEvents");
        evt.initEvent("scroll", false, true);
        document.dispatchEvent(evt);
      }
      else {
        document.fireEvent("scroll");
      }
    }, 500)
  })

</script>
            </div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    window.Velocity(hideElement, 'stop');
    window.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        window.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
            <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://xly0713.github.io/post/about/">
      å…³äº
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>å‘å¸ƒäº</span>
      <span>2019-01-25</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>1åˆ†é’Ÿ</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>105<span class="pc-show">å­—æ•°</span></span>
    </span>
    
  </div>
</header>
            <div class="post-body next-md-body" id="post_body">
              <blockquote>
<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤</p>
</blockquote>
<h2 id="å…³äºæœ¬ç«™">ğŸ  å…³äºæœ¬ç«™</h2>
<p>æœ¬ç«™ä¸»è¦ç”¨æ¥è®°å½•ä¸€äº›æŠ€æœ¯ï¼Œå¸®åŠ©è‡ªå·±æ•´ç†é›¶ç¢çš„çŸ¥è¯†ï¼Œå¸Œæœ›å¯¹ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚æ¬¢è¿<a href="/atom.xml">RSS</a>è®¢é˜…æœ¬ç«™ã€‚</p>
<h2 id="åšä¸»æ˜¯è°">ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°</h2>
<p>åšä¸»æ˜¯ä¸€ååå°ç ”å‘æ”»åŸç‹®ï¼Œå…³æ³¨äº‘è®¡ç®—ç›¸å…³é¢†åŸŸï¼Œç›®å‰ä¸“æ³¨äºCDNæŠ€æœ¯å’Œç›´æ’­æŠ€æœ¯ã€‚</p>
<h2 id="è”ç³»æˆ‘å‘€">ğŸ“¬ è”ç³»æˆ‘å‘€</h2>
<ul>
<li>é‚®ä»¶: xly880713@gmail.com</li>
</ul>

            </div>
            <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
      ygçš„å°ç«™
    </li>
    <li class="post-copyright-link">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://xly0713.github.io/post/about/" title="å…³äº">https://xly0713.github.io/post/about/</a>
    </li>
    <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
      æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>
  <div class="tags">
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
    </div>
    <div class="nav-next">
      
    </div>
  </div>
</div>
            
  
    
      <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>
  var gitalk = new Gitalk({
    clientID: '52d02c95d4f1500d9f75',
    clientSecret: '878436bbe0814eb17153aae1f385fe271ceff250',
    repo: 'xly0713.github.io',
    owner: 'xly0713',
    admin: ['xly0713'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })
  gitalk.render('gitalk-container')
</script>
    
    
  

          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | Â© 2019-2020 Theme By <a href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      
    </div>
  </footer>
  
  
    <div class="drawer-box left" id="drawer_box">
      <span class="muse-line muse-line-first"></span>
      <span class="muse-line muse-line-middle"></span>
      <span class="muse-line muse-line-last"></span>
    </div>
  
  <div class="mist back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
  </div>
  
  
    

<link rel="stylesheet" href="/media/live2d/histoire/css/live2d.css" />
<div class="box-scale">
  <div id="landlord" style="left: 5px;bottom: px;" data-key="">
    <div class="message" style="opacity:0"></div>
    <canvas id="live2d" width="500" height="560" class="live2d"></canvas>
    <div class="live_talk_input_body">
      <div class="live_talk_input_name_body">
        <input name="name" type="text" class="live_talk_name white_input" id="AIuserName" autocomplete="off" placeholder="ä½ çš„åå­—" />
      </div>
      <div class="live_talk_input_text_body">
        <input name="talk" type="text" class="live_talk_talk white_input" id="AIuserText" autocomplete="off" placeholder="è¦å’Œæˆ‘èŠä»€ä¹ˆå‘€ï¼Ÿ"/>
        <button type="button" class="live_talk_send_btn" id="talk_send">å‘é€</button>
      </div>
    </div>
    <input name="live_talk" id="live_talk" value="1" type="hidden" />
    <div class="live_ico_box">
      <div class="live_ico_item type_info" id="showInfoBtn"></div>
      <div class="live_ico_item type_talk" id="showTalkBtn"></div>
      
      <div class="live_ico_item type_youdu" id="youduButton"></div>
      <div class="live_ico_item type_quit" id="hideButton"></div>
      <input name="live_statu_val" id="live_statu_val" value="0" type="hidden" />
      <audio src="" style="display:none;" id="live2d_bgm" data-bgm="0" preload="none"></audio>
      <input id="duType" value="douqilai" type="hidden">
      
    </div>
  </div>
</div>
<div id="open_live2d">å¬å”¤ä¼Šæ–¯ç‰¹ç“¦å°”</div>
<script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
var message_Path = '/media/live2d/histoire/';
let landlord = document.querySelector('#landlord');
var apiKey = landlord.dataset.key;
</script>
<script type="text/javascript" src="/media/live2d/histoire/js/live2d.js"></script>
<script type="text/javascript" src="/media/live2d/histoire/js/message.js"></script>
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
  back2TopText = document.querySelector('#back_to_top_text'),
  drawerBox = document.querySelector('#drawer_box'),
  rightSideBar = document.querySelector('.sidebar'),
  viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {
   
    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function(e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });
  
  window.addEventListener('scroll', function(e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  
  let hasCacu = false;
  window.onresize = function() {
    if (window.width > 991) {
      calcuHeight();
    } else {
      hasCacu = false;
    }
  }

  function calcuHeight() {
    // åŠ¨æ€è°ƒæ•´ç«™ç‚¹æ¦‚è§ˆé«˜åº¦
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();
  
  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function() {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, transitionDir,{ });
          }
        })
        window.Velocity(viewport, openProp,{
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp ,{
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // é“¾æ¥è·³è½¬
  let newWindow = 'false'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target","_blank");
      }
    })
  }
  // ä»£ç é«˜äº®
  hljs.initHighlightingOnLoad();

</script>
    <div class="light-box" id="light_box"></div>
<script>
  let imgs = document.querySelectorAll('.post-body img');
  let lightBox = document.querySelector('#light_box');
  lightBox.addEventListener('mousedown', (e) => {
    e.preventDefault()
  })
  lightBox.addEventListener('mousewheel', (e) => {
    e.preventDefault()
  })
  let width = window.innerWidth * 0.8;
  lightBox.onclick = () => {
    let img = lightBox.querySelector('img');
    lightBox.style = '';
    img && img.remove();
  }
  imgs.forEach(item => {
    item.onclick = function (e) {
      let lightImg = document.createElement('img');
      lightImg.src = this.src;
      lightBox.style = `height: 100%; opacity: 1; background-color: rgba(0, 0, 0, 0.5);cursor: zoom-out;`;
      lightImg.style = `width: ${width}px; border: 1px solid #fff; border-radius: 2px;`;
      lightImg.onclick = function () {
        lightBox.style = '';
        this.remove();
      }
      lightBox.append(lightImg);
    }
  })
</script>
  </div>
</body>
<input hidden id="copy" />
<script>
  //æ‹¿æ¥ä¸»ä¹‰(çœŸé¦™)^_^ï¼ŒClipboard å®ç°æ‘˜è‡ªæ˜é‡‘ https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // åˆ¤æ–­æ˜¯ä¸æ˜¯iosç«¯
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //åˆ›å»ºæ–‡æœ¬å…ƒç´ 
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //é€‰æ‹©å†…å®¹
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("å¤åˆ¶é”™è¯¯ï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === 'å¤åˆ¶æˆåŠŸ') {
        console.log('å¤åˆ¶æ“ä½œé¢‘ç‡è¿‡é«˜');
        return;
      }
      e.srcElement.textContent = 'å¤åˆ¶æˆåŠŸ';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === 'å¤åˆ¶æˆåŠŸ') {
            elem.textContent = 'å¤åˆ¶ä»£ç '
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = 'å¤åˆ¶ä»£ç ';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })
</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 500
  });
</script>

<!-- <div class="search-mask" id="search_mask">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input type="text" placeholder="æœç´¢">
      </div>
      <i class="fa fa-times-circle"></i>
    </div>
    <div class="result">
      
      <div class="item">
        <a class="result-title" href="https://xly0713.github.io/post/epoll-shi-jian-qu-dong/"" data-c="
          &lt;p&gt;å½“å‰Linuxç³»ç»Ÿä¸‹ï¼ŒNginxä¼šé»˜è®¤ä½¿ç”¨epollä½œä¸ºäº‹ä»¶é©±åŠ¨æœºåˆ¶ã€‚æœ¬æ–‡å¯¹epollåšä¸ªç®€å•ä»‹ç»ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;äº‹ä»¶é©±åŠ¨&#34;&gt;äº‹ä»¶é©±åŠ¨&lt;/h2&gt;
&lt;p&gt;äº‹ä»¶é©±åŠ¨åˆç§°ä½œIOå¤šè·¯å¤ç”¨ï¼Œepollæ˜¯Linuxå†…æ ¸å®ç°ä¸€ç§IOå¤šè·¯å¤ç”¨æœºåˆ¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IOï¼š åœ¨Linuxç³»ç»Ÿä¸‹ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ã€‚æ–‡ä»¶å¯è¯»/å¯å†™å³ç§°ä½œIOï¼Œæ¯”å¦‚ï¼šæ™®é€šæ–‡ä»¶ã€socketå¥—æ¥å­—ã€è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„ç®¡é“pipeï¼Œéƒ½æ˜¯å¯ä»¥IOçš„å¯¹è±¡ã€‚Linuxç³»ç»Ÿç»Ÿä¸€ç”¨æ–‡ä»¶æè¿°ç¬¦fdè¡¨ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;äº‹ä»¶ï¼š
&lt;ul&gt;
&lt;li&gt;å¯è¯»äº‹ä»¶ï¼šå½“fdå…³è”çš„å†…æ ¸è¯»ç¼“å†²åŒºå¯è¯»æ—¶ï¼Œåˆ™è§¦å‘å¯è¯»äº‹ä»¶ ï¼ˆå¯å†™ï¼šå†…æ ¸ç¼“å†²åŒºéç©ºï¼‰&lt;/li&gt;
&lt;li&gt;å¯å†™äº‹ä»¶ï¼šå½“fdå…³è”çš„å†…ç§‘å†™ç¼“å†²åŒºå¯å†™æ—¶ï¼Œåˆ™è§¦å‘å¯å†™äº‹ä»¶   (å¯è¯»ï¼šå†…æ ¸ç¼“å†²åŒºä¸æ»¡)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;äº‹ä»¶é€šçŸ¥æ–¹å¼
&lt;ul&gt;
&lt;li&gt;ä¸»åŠ¨é€šçŸ¥ï¼šä»…å½“æœ‰fdæœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå†…æ ¸ä¸»åŠ¨é€šçŸ¥ä¸Šå±‚åº”ç”¨æœ‰äº‹ä»¶å‘ç”Ÿçš„fdé›†åˆ&lt;/li&gt;
&lt;li&gt;è¢«åŠ¨é€šçŸ¥ï¼šä¸Šå±‚åº”ç”¨å‘å†…æ ¸è½®è¯¢æ£€æŸ¥fdé›†åˆä¸­çš„fdæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;epoll-apiä»‹ç»&#34;&gt;epoll APIä»‹ç»&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://xly0713.github.io/post-images/1589288969778.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;epoll_create&#34;&gt;epoll_create&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åŸå‹ï¼šint epoll_create(int size)
&lt;ul&gt;
&lt;li&gt;åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªepollå®ä¾‹ï¼Œå†…æ ¸ä¼šè¿”å›ä¸€ä¸ªè¡¨ç¤ºepollå®ä¾‹çš„fd&lt;/li&gt;
&lt;li&gt;å…¥å‚
&lt;ul&gt;
&lt;li&gt;size: åŸæœ¬è¡¨ç¤ºæ‰€è¦ç›‘è§†fdçš„æœ€å¤šä¸ªæ•°ã€‚ç°åœ¨Linuxç‰ˆä¸­æ— æ„ä¹‰ï¼Œåªè¦ä¼ å€¼å¤§äº0çš„æ•´æ•°å³å¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¿”å›å€¼: epollå®ä¾‹çš„fd&lt;/li&gt;
&lt;li&gt;è¯´æ˜ï¼šè°ƒç”¨è¯¥APIï¼Œå†…æ ¸ä¼šäº§ç”Ÿä¸€ä¸ªepollå®ä¾‹æ•°æ®ç»“æ„ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;epoll_ctl&#34;&gt;epoll_ctl&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åŸå‹: int epoll_ctl(int epfdï¼Œ int opï¼Œ int fdï¼Œ struct epoll_event *event)
&lt;ul&gt;
&lt;li&gt;åŠŸèƒ½ï¼šæ·»åŠ /åˆ é™¤/ä¿®æ”¹è¦ç›‘å¬çš„äº‹ä»¶&lt;/li&gt;
&lt;li&gt;å…¥å‚
&lt;ul&gt;
&lt;li&gt;epfd: å³epoll_createåˆ›å»ºçš„epollå®ä¾‹æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;op: æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹
&lt;ul&gt;
&lt;li&gt;EPOLL_CTL_ADD: æ·»åŠ ä¸€ä¸ªéœ€è¦ç›‘è§†çš„fd&lt;/li&gt;
&lt;li&gt;EPOLL_CTL_DEL: åˆ é™¤ä¸€ä¸ªfd&lt;/li&gt;
&lt;li&gt;EPOLL_CTL_MOD: ä¿®æ”¹ä¸€ä¸ªfd&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;fd: IOå¯¹è±¡æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;eventç»“æ„ä½“&lt;pre&gt;&lt;code&gt;struct epoll_event {
    __uint32_t events;
    epoll_data_t data;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;eventså­—æ®µï¼šæ„Ÿå…´è¶£çš„äº‹ä»¶æè¿°ï¼Œå¯å¤šé€‰
&lt;ul&gt;
&lt;li&gt;EPOLLINï¼šfdå¤„äºå¯è¯»çŠ¶æ€&lt;/li&gt;
&lt;li&gt;EPOLLOUTï¼šfdå¤„äºå¯å†™çŠ¶æ€&lt;/li&gt;
&lt;li&gt;EPOLLETï¼šé€šçŸ¥æ¨¡å¼ä¸ºè¾¹ç¼˜è§¦å‘æ¨¡å¼ï¼Œç›¸å¯¹äºæ°´å¹³è§¦å‘æ¨¡å¼è€Œè¨€&lt;/li&gt;
&lt;li&gt;EPOLLONESHOTï¼šç¬¬ä¸€æ¬¡è¿›è¡Œé€šçŸ¥ï¼Œä¹‹åä¸å†æ£€æµ‹&lt;/li&gt;
&lt;li&gt;EPOLLHUPï¼š æœ¬ç«¯äº§ç”Ÿä¸€ä¸ªæŒ‚æ–­äº‹ä»¶ï¼Œé»˜è®¤æ£€æµ‹äº‹ä»¶&lt;/li&gt;
&lt;li&gt;EPOLLDHUPï¼šå¯¹ç«¯äº§ç”Ÿä¸€ä¸ªæŒ‚æ–­äº‹ä»¶&lt;/li&gt;
&lt;li&gt;EPOLLPRIï¼šç”±å¸¦å¤–æ•°æ®è§¦å‘&lt;/li&gt;
&lt;li&gt;EPOLLERRï¼šäº§ç”Ÿé”™è¯¯æ—¶è§¦å‘ï¼Œé»˜è®¤æ£€æµ‹äº‹ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;dataå­—æ®µï¼šæ˜¯ä¸€ä¸ªunionç»“æ„&lt;pre&gt;&lt;code&gt;typedef union epoll_data {
    void *ptr;
    int fd;
    __uint32_t u32;
    __uint64_t u64;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸éœ€è¦é¢å¤–çš„ä¿¡æ¯ï¼Œåªéœ€ç®€å•çš„èµ‹å€¼: &lt;code&gt;epoll_data.fd = fd&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœéœ€è¦é¢å¤–ä¿¡æ¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨&lt;code&gt;void *ptr&lt;/code&gt;, è¿™æ ·epoll_waitè¿”å›æ—¶å¯ä»¥ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¿”å›å€¼: å¦‚æœè¿”å›-1è¡¨ç¤ºè°ƒç”¨å¤±è´¥&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;epoll_wait&#34;&gt;epoll_wait&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åŸå‹ï¼šint epoll_wait(int epfdï¼Œ struct epoll_event *eventsï¼Œ int maxeventsï¼Œ int timeout)
&lt;ul&gt;
&lt;li&gt;åŠŸèƒ½ï¼šé˜»å¡ç­‰å¾…å·²æ³¨å†Œçš„äº‹ä»¶å‘ç”Ÿï¼Œè¿”å›äº‹ä»¶çš„æ•°ç›®ï¼Œå¹¶å°†è§¦å‘çš„äº‹ä»¶å†™å…¥eventsæ•°ç»„ä¸­&lt;/li&gt;
&lt;li&gt;å…¥å‚ï¼š
&lt;ul&gt;
&lt;li&gt;epfd: å³epoll_createåˆ›å»ºçš„epollå®ä¾‹æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;eventsï¼šç”¨æ¥è®°å½•è¢«è§¦å‘çš„äº‹ä»¶æ•°ç»„ï¼Œå…¶å¤§å°åº”è¯¥å’Œmaxeventsä¸€è‡´&lt;/li&gt;
&lt;li&gt;maxevents: è¿”å›çš„eventsçš„æœ€å¤§ä¸ªæ•°&lt;/li&gt;
&lt;li&gt;timeout: é˜»å¡è¶…æ—¶(ä»¥msä¸ºå•ä½)
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¼ å‚-1ï¼Œ åˆ™è°ƒç”¨ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿæˆ–æ•è·å…¶ä»–ä¿¡å·&lt;/li&gt;
&lt;li&gt;å¦‚æœä¼ å‚0ï¼Œåˆ™éé˜»å¡æ£€æµ‹æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæ— è®ºæœ‰äº‹ä»¶è¿˜æ˜¯æ²¡äº‹ä»¶ï¼Œè°ƒç”¨ç«‹å³è¿”å›&lt;/li&gt;
&lt;li&gt;å¦‚æœä¼ å‚å¤§äº0ï¼Œ åˆ™æœ€å¤šç­‰å¾…timeoutæ—¶é—´è¿”å›ï¼Œå¦‚æœç­‰å¾…æœŸé—´æœ‰äº‹ä»¶å‘ç”Ÿåˆ™ç«‹å³è¿”å›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘&#34;&gt;æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘&lt;/h2&gt;
&lt;h3 id=&#34;æ°´å¹³è§¦å‘&#34;&gt;æ°´å¹³è§¦å‘&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åªè¦ç¼“å†²åŒºæœ‰æ•°æ®ï¼Œåˆ™è¿”å›å¯è¯»äº‹ä»¶&lt;/li&gt;
&lt;li&gt;åªè¦ç¼“å†²åŒºè¿˜ä¸æ»¡ï¼Œåˆ™è¿”å›å¯å†™äº‹ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è¾¹ç¼˜è§¦å‘&#34;&gt;è¾¹ç¼˜è§¦å‘&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯è¯»äº‹ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ç¼“å†²åŒºæ•°æ®ä¸ºç©ºå˜ä¸ºéç©ºæ—¶ï¼Œåˆ™è¿”å›å¯è¯»äº‹ä»¶&lt;/li&gt;
&lt;li&gt;å½“ç¼“å†²åŒºæ¥æ”¶åˆ°æ–°æ•°æ®æ—¶ï¼Œå³ç¼“å†²åŒºå¾…è¯»æ•°æ®å˜å¤šæ—¶ï¼Œè¿”å›å¯è¯»äº‹ä»¶&lt;/li&gt;
&lt;li&gt;å½“ç¼“å†²åŒºæœ‰æ•°æ®å¯è¯»ï¼Œä¸”åº”ç”¨è¿›ç¨‹å¯¹ç›¸åº”çš„æè¿°ç¬¦è¿›è¡ŒEPOLL_CTL_MOD ä¿®æ”¹EPOLLINäº‹ä»¶æ—¶ï¼Œè¿”å›å¯è¯»äº‹ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯å†™äº‹ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ç¼“å†²åŒºç”±ä¸å¯å†™å˜ä¸ºå¯å†™æ—¶ï¼Œåˆ™è¿”å›å¯å†™äº‹ä»¶&lt;/li&gt;
&lt;li&gt;å½“æœ‰æ—§æ•°æ®è¢«å‘é€èµ°ï¼Œå³ç¼“å†²åŒºä¸­çš„å†…å®¹å˜å°‘çš„æ—¶å€™ï¼Œè¿”å›å¯å†™äº‹ä»¶&lt;/li&gt;
&lt;li&gt;å½“ç¼“å†²åŒºæœ‰ç©ºé—´å¯å†™ï¼Œä¸”åº”ç”¨è¿›ç¨‹å¯¹ç›¸åº”çš„æè¿°ç¬¦è¿›è¡ŒEPOLL_CTL_MOD ä¿®æ”¹EPOLLOUTäº‹ä»¶æ—¶ï¼Œè¿”å›å¯å†™äº‹ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä»£ç ç¤ºä¾‹&#34;&gt;ä»£ç ç¤ºä¾‹&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;sys/epoll.h&amp;gt;
#include &amp;lt;string.h&amp;gt;

#define MAX_EVENTS 5
#define READ_SIZE 10

int main() {
    int running = 1, event_count, i;
    size_t bytes_read;
    char read_buffer[READ_SIZE + 1];
    struct epoll_event event, events[MAX_EVENTS];

    int epoll_fd = epoll_create1(0);
    if (epoll_fd == -1) {
        fprintf(stderr, &amp;quot;Failed to create epoll fd\n&amp;quot;);
        return 1;
    }

    event.events = EPOLLIN;
    event.data.fd = 0;

    if (epoll_ctl(epoll_fd, EPOLL_CTL_ADD, 0, &amp;amp;event) == -1) {
        fprintf(stderr, &amp;quot;Failed to add fd to epoll\n&amp;quot;);
        return 1;
    }

    while (running) {
        printf(&amp;quot;\nPolling for input...\n&amp;quot;);
        event_count = epoll_wait(epoll_fd, events, MAX_EVENTS, 30000);
        printf(&amp;quot;%d ready events\n&amp;quot;, event_count);
        for (i = 0; i &amp;lt; event_count; i++) {
            printf(&amp;quot;Reading fd &#39;%d&#39; -- &amp;quot;, events[i].data.fd);
            bytes_read = read(events[i].data.fd, read_buffer, READ_SIZE);
            printf(&amp;quot;%zd bytes read.\n&amp;quot;, bytes_read);
            read_buffer[bytes_read] = &#39;\0&#39;;
            printf(&amp;quot;Read &#39;%s&#39;\n&amp;quot;, read_buffer);

            if (!strncmp(read_buffer, &amp;quot;stop\n&amp;quot;, 5)) {
                running = 0;
            }
        }
    }

    if (close(epoll_fd)) {
        fprintf(stderr, &amp;quot;Failed to close epoll fd\n&amp;quot;);
        return 1;
    }

    return 0;
}
&lt;/code&gt;&lt;/pre&gt;
">epolläº‹ä»¶é©±åŠ¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://xly0713.github.io/post/nginx-yuan-ma-fen-xi-zhi-http-kuang-jia/"" data-c="
          &lt;p&gt;Nginxçš„httpåŠŸèƒ½å’Œæ¨¡å—ä½¿ç”¨å¹¿æ³›ï¼Œé‚£ä¹ˆNginxçš„httpæ¡†æ¶æ˜¯å¦‚ä½•åˆå§‹åŒ–çš„å‘¢ï¼Ÿhttpè¯·æ±‚çš„11ä¸ªå¤„ç†é˜¶æ®µåˆæ˜¯æ€ä¹ˆè®¾è®¡çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;httpæ¡†æ¶åˆå§‹åŒ–æµç¨‹å›¾&#34;&gt;httpæ¡†æ¶åˆå§‹åŒ–æµç¨‹å›¾&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://xly0713.github.io/post-images/1589099904999.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;ç»“åˆæµç¨‹ç®€å›¾å’Œä»£ç æè¿°æ€»ä½“æµç¨‹&#34;&gt;ç»“åˆæµç¨‹ç®€å›¾å’Œä»£ç æè¿°æ€»ä½“æµç¨‹&lt;/h2&gt;
&lt;p&gt;å½“é…ç½®æ–‡ä»¶nginx.confé…ç½®äº†http{...}å¹¶è¢«è§£æåˆ°æ—¶ï¼Œhttpæ¡†æ¶é€šè¿‡æ‰§è¡Œngx_http_blockå‡½æ•°å¼€å§‹åˆå§‹åŒ–ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;static char *
ngx_http_block(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
{
    char                        *rv;
    ngx_uint_t                   mi, m, s;
    ngx_conf_t                   pcf;
    ngx_http_module_t           *module;
    ngx_http_conf_ctx_t         *ctx;
    ngx_http_core_loc_conf_t    *clcf;
    ngx_http_core_srv_conf_t   **cscfp;
    ngx_http_core_main_conf_t   *cmcf;

    if (*(ngx_http_conf_ctx_t **) conf) {
        return &amp;quot;is duplicate&amp;quot;;
    }

    /* the main http context */

    ctx = ngx_pcalloc(cf-&amp;gt;pool, sizeof(ngx_http_conf_ctx_t));
    if (ctx == NULL) {
        return NGX_CONF_ERROR;
    }

    *(ngx_http_conf_ctx_t **) conf = ctx;

    /*åˆå§‹åŒ–æ‰€æœ‰HTTPæ¨¡å—çš„ctx_indexåºå·*/
    ngx_http_max_module = ngx_count_modules(cf-&amp;gt;cycle, NGX_HTTP_MODULE);

    /*åˆ†é…è§£æhttp{}å—ä¸‹mainçº§åˆ«é…ç½®é¡¹æ—¶å­˜æ”¾HTTPæ¨¡å—ç»“æ„ä½“æŒ‡é’ˆçš„3ä¸ªæ•°ç»„main_confã€srv_confã€loc_conf*/
    ctx-&amp;gt;main_conf = ngx_pcalloc(cf-&amp;gt;pool,
                                 sizeof(void *) * ngx_http_max_module);
    if (ctx-&amp;gt;main_conf == NULL) {
        return NGX_CONF_ERROR;
    }

    ctx-&amp;gt;srv_conf = ngx_pcalloc(cf-&amp;gt;pool, sizeof(void *) * ngx_http_max_module);
    if (ctx-&amp;gt;srv_conf == NULL) {
        return NGX_CONF_ERROR;
    }

    ctx-&amp;gt;loc_conf = ngx_pcalloc(cf-&amp;gt;pool, sizeof(void *) * ngx_http_max_module);
    if (ctx-&amp;gt;loc_conf == NULL) {
        return NGX_CONF_ERROR;
    }

    /*
     * å¤„ç†http{}å—å†…çš„mainçº§åˆ«é…ç½®æ—¶ï¼Œå¯¹æ¯ä¸ªHTTPæ¨¡å—ï¼Œéƒ½ä¼šè°ƒç”¨create_(main|srv|loc)_confç­‰3ä¸ªæ–¹æ³•
     */
    for (m = 0; cf-&amp;gt;cycle-&amp;gt;modules[m]; m++) {
        if (cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;type != NGX_HTTP_MODULE) {
            continue; //è·³è¿‡éhttpæ¨¡å—
        }

        module = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx;
        mi = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx_index;

        if (module-&amp;gt;create_main_conf) {
            ctx-&amp;gt;main_conf[mi] = module-&amp;gt;create_main_conf(cf); //mainçº§åˆ«
            if (ctx-&amp;gt;main_conf[mi] == NULL) {
                return NGX_CONF_ERROR;
            }
        }

        if (module-&amp;gt;create_srv_conf) {
            ctx-&amp;gt;srv_conf[mi] = module-&amp;gt;create_srv_conf(cf); //serverçº§åˆ«
            if (ctx-&amp;gt;srv_conf[mi] == NULL) {
                return NGX_CONF_ERROR;
            }
        }

        if (module-&amp;gt;create_loc_conf) {
            ctx-&amp;gt;loc_conf[mi] = module-&amp;gt;create_loc_conf(cf); //locationçº§åˆ«
            if (ctx-&amp;gt;loc_conf[mi] == NULL) {
                return NGX_CONF_ERROR;
            }
        }
    }

    pcf = *cf;
    cf-&amp;gt;ctx = ctx;

    for (m = 0; cf-&amp;gt;cycle-&amp;gt;modules[m]; m++) {
        if (cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;type != NGX_HTTP_MODULE) {
            continue;
        }

        module = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx;

        if (module-&amp;gt;preconfiguration) {
            if (module-&amp;gt;preconfiguration(cf) != NGX_OK) {
                return NGX_CONF_ERROR;
            }
        }
    }

    /* è§£æhttp{} mainé…ç½® */
    cf-&amp;gt;module_type = NGX_HTTP_MODULE;
    cf-&amp;gt;cmd_type = NGX_HTTP_MAIN_CONF;
    rv = ngx_conf_parse(cf, NULL); //è§£æå†…éƒ¨é…ç½®

    if (rv != NGX_CONF_OK) {
        goto failed;
    }

    cmcf = ctx-&amp;gt;main_conf[ngx_http_core_module.ctx_index];
    cscfp = cmcf-&amp;gt;servers.elts;

    for (m = 0; cf-&amp;gt;cycle-&amp;gt;modules[m]; m++) {
        if (cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;type != NGX_HTTP_MODULE) {
            continue;
        }

        module = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx;
        mi = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx_index;

        //è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„init_main_confæ–¹æ³•ï¼Œä¿å­˜mainçº§åˆ«é…ç½®
        if (module-&amp;gt;init_main_conf) {
            rv = module-&amp;gt;init_main_conf(cf, ctx-&amp;gt;main_conf[mi]);
            if (rv != NGX_CONF_OK) {
                goto failed;
            }
        }

        //åˆå¹¶ngx_modules[m]æ¨¡å—mainã€srvã€locé…ç½®
        rv = ngx_http_merge_servers(cf, cmcf, module, mi);
        if (rv != NGX_CONF_OK) {
            goto failed;
        }
    }

    /* æ„é€ locationç»„æˆçš„é™æ€äºŒå‰å¹³è¡¡æŸ¥æ‰¾æ ‘ */
    for (s = 0; s &amp;lt; cmcf-&amp;gt;servers.nelts; s++) {

        clcf = cscfp[s]-&amp;gt;ctx-&amp;gt;loc_conf[ngx_http_core_module.ctx_index];

        //å°†ngx_http_core_loc_conf_tç»„æˆçš„åŒå‘é“¾è¡¨æŒ‰ç…§locationåŒ¹é…å­—ç¬¦ä¸²è¿›è¡Œæ’åº
        if (ngx_http_init_locations(cf, cscfp[s], clcf) != NGX_OK) {
            return NGX_CONF_ERROR;
        }

        //æ ¹æ®å·²ç»æ’åºè¿‡çš„çš„åŒå‘é“¾è¡¨ï¼Œæ„å»ºé™æ€çš„äºŒå‰æŸ¥æ‰¾æ ‘
        if (ngx_http_init_static_location_trees(cf, clcf) != NGX_OK) {
            return NGX_CONF_ERROR;
        }
    }

    /* åˆå§‹åŒ–å¯æ·»åŠ å¤„ç†æ–¹æ³•çš„HTTPé˜¶æ®µçš„åŠ¨æ€æ•°ç»„ */
    if (ngx_http_init_phases(cf, cmcf) != NGX_OK) {
        return NGX_CONF_ERROR;
    }

    if (ngx_http_init_headers_in_hash(cf, cmcf) != NGX_OK) {
        return NGX_CONF_ERROR;
    }

    /* è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„postconfigurationæ–¹æ³•ï¼Œä½¿ä¹‹å¯ä»¥ä»‹å…¥HTTPè¯·æ±‚å¤„ç†é˜¶æ®µ */
    for (m = 0; cf-&amp;gt;cycle-&amp;gt;modules[m]; m++) {
        if (cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;type != NGX_HTTP_MODULE) {
            continue;
        }

        module = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx;

        if (module-&amp;gt;postconfiguration) {
            if (module-&amp;gt;postconfiguration(cf) != NGX_OK) {
                return NGX_CONF_ERROR;
            }
        }
    }

    if (ngx_http_variables_init_vars(cf) != NGX_OK) {
        return NGX_CONF_ERROR;
    }

    /*
     * http{}&#39;s cf-&amp;gt;ctx was needed while the configuration merging
     * and in postconfiguration process
     */

    *cf = pcf;

    //æ ¹æ®å„ä¸ªHTTPæ¨¡å—ä»‹å…¥çš„å¤„ç†æ–¹æ³•æ„é€ å‡ºphase_engine_handlersæ•°ç»„
    if (ngx_http_init_phase_handlers(cf, cmcf) != NGX_OK) {
        return NGX_CONF_ERROR;
    }


    //æ„é€ ç›‘å¬ç«¯å£ä¸serveré—´çš„å…³è”å…³ç³»ï¼Œè®¾ç½®æ–°è¿æ¥äº‹ä»¶çš„å›è°ƒæ–¹æ³•
    if (ngx_http_optimize_servers(cf, cmcf, cmcf-&amp;gt;ports) != NGX_OK) {
        return NGX_CONF_ERROR;
    }

    return NGX_CONF_OK;

failed:

    *cf = pcf;

    return rv;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åˆå§‹åŒ–æ‰€æœ‰httpæ¨¡å—çš„ctx_indexåºå·&#34;&gt;åˆå§‹åŒ–æ‰€æœ‰HTTPæ¨¡å—çš„ctx_indexåºå·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ctx_indexè¡¨ç¤ºæ¨¡å—åœ¨åŒç±»å‹æ¨¡å—ä¸­çš„ç´¢å¼•ï¼Œæ¯”å¦‚ngx_http_core_moduleæ˜¯HTTPæ¨¡å—ï¼ˆNGX_HTTP_MODULEï¼‰çš„é¦–ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆè¯¥æ¨¡å—çš„ctx_indexä¸º0ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åˆ†é…è§£æhttpå—ä¸‹mainçº§åˆ«é…ç½®é¡¹æ—¶å­˜æ”¾httpæ¨¡å—ç»“æ„ä½“æŒ‡é’ˆçš„3ä¸ªæ•°ç»„&#34;&gt;åˆ†é…è§£æhttp{}å—ä¸‹mainçº§åˆ«é…ç½®é¡¹æ—¶å­˜æ”¾HTTPæ¨¡å—ç»“æ„ä½“æŒ‡é’ˆçš„3ä¸ªæ•°ç»„&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†é…main_confæ•°ç»„ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨mainçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_main_conf_tç»“æ„ä½“&lt;/li&gt;
&lt;li&gt;åˆ†é…srv_confæ•°ç»„ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨mainçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_srv_conf_tç»“æ„ä½“&lt;/li&gt;
&lt;li&gt;åˆ†é…loc_confæ•°ç»„ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨mainçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_loc_conf_tç»“æ„ä½“&lt;/li&gt;
&lt;li&gt;å¦å¤–ï¼Œå¿…é¡»åŒæ—¶åˆ›å»º3ä¸ªæ•°ç»„ã€‚å› ä¸ºå¯¹äºHTTPæ¨¡å—æ¥è¯´ï¼ŒæŸä¸ªæŒ‡ä»¤æœ‰å¯èƒ½åŒæ—¶å‡ºç°åœ¨mainã€srvã€locçº§åˆ«ã€‚å®é™…åº”ç”¨é…ç½®é¡¹æ—¶ï¼Œå…·ä½“ä»¥é‚£ä¸ªçº§åˆ«çš„é…ç½®é¡¹ä¸ºå‡†ï¼Œéœ€è¦åˆå¹¶å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¾æ¬¡è°ƒç”¨æ‰€æœ‰httpæ¨¡å—çš„create_mainsrvloc_confå…±3ä¸ªæ–¹æ³•&#34;&gt;ä¾æ¬¡è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„create_(main|srv|loc)_confå…±3ä¸ªæ–¹æ³•&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„è¿™3ä¸ªå›è°ƒæ–¹æ³•ï¼Œå¦‚æœå®ç°ï¼Œåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨create_main_confï¼Œåˆ†é…æ¯ä¸ªHTTPæ¨¡å—mainçº§åˆ«çš„xx_main_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼&lt;/li&gt;
&lt;li&gt;è°ƒç”¨create_srv_confï¼Œåˆ†é…æ¯ä¸ªHTTPæ¨¡å—mainçº§åˆ«çš„xx_srv_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼&lt;/li&gt;
&lt;li&gt;è°ƒç”¨create_loc_confï¼Œåˆ†é…æ¯ä¸ªHTTPæ¨¡å—mainçº§åˆ«çš„xx_loc_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è°ƒç”¨æ‰€æœ‰httpæ¨¡å—çš„preconfigurationæ–¹æ³•&#34;&gt;è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„preconfigurationæ–¹æ³•&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„&lt;code&gt;preconfiguration&lt;/code&gt;å›è°ƒæ–¹æ³•ï¼Œå¦‚æœå®ç°ï¼Œåˆ™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨preconfigurationæ–¹æ³•, ä¸€èˆ¬ç”¨äºæ·»åŠ å˜é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è§£æhttpå—ä¸‹çš„æ‰€æœ‰mainçº§åˆ«é…ç½®é¡¹&#34;&gt;è§£æhttp{}å—ä¸‹çš„æ‰€æœ‰mainçº§åˆ«é…ç½®é¡¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;äº¤ç”±confæ¨¡å—è§£æhttp{}å—ä¸‹çš„é…ç½®
&lt;ul&gt;
&lt;li&gt;ç‰¹åˆ«çš„ï¼Œå¦‚æœå†…éƒ¨ç¢°åˆ°server{}å—æ—¶ï¼Œåˆ™ä¼šåˆ†é…srv_confã€loc_confæ•°ç»„åˆ†åˆ«ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨serverçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_srv_conf_tã€xx_loc_conf_tç»“æ„ä½“ã€‚ç„¶åè°ƒç”¨create_srv_confã€create_loc_confåˆ†é…æ¯ä¸ªHTTPæ¨¡å—åœ¨serverçº§åˆ«çš„xx_(srv|loc)_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼
&lt;ul&gt;
&lt;li&gt;ç‰¹åˆ«çš„ï¼Œå¦‚æœå†…éƒ¨ç¢°åˆ°location{}å—æ—¶ï¼Œåˆ™ä¼šåˆ†é…loc_confæ•°ç»„åˆ†åˆ«ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨locationçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_loc_conf_tç»“æ„ä½“ã€‚ç„¶åè°ƒç”¨create_loc_confåˆ†é…æ¯ä¸ªHTTPæ¨¡å—åœ¨locationçº§åˆ«çš„xx_loc_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼&lt;/li&gt;
&lt;li&gt;location{}ä¸‹çš„é…ç½®è§£æå®Œï¼Œåˆ™å„ä¸ªHTTPæ¨¡å—åœ¨locationçº§åˆ«çš„xxx_loc_conf_tç»“æ„ä½“èµ‹å€¼å®Œæˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;server{}ä¸‹çš„é…ç½®è§£æå®Œï¼Œåˆ™å„ä¸ªHTTPæ¨¡å—åœ¨serverçº§åˆ«çš„xx_(srv|loc)_conf_tç»“æ„ä½“èµ‹å€¼å®Œæˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è°ƒç”¨æ‰€æœ‰httpæ¨¡å—çš„init_main_confæ–¹æ³•&#34;&gt;è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„init_main_confæ–¹æ³•&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„init_main_confå›è°ƒæ–¹æ³•, å¦‚æœå®ç°ï¼Œåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®è§£æå®Œæˆåï¼Œè°ƒç”¨init_main_confæ–¹æ³•ï¼Œæœ€ç»ˆç¡®å®šå¹¶ä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨mainçº§åˆ«çš„xx_main_conf_té…ç½®ç»“æ„ä½“&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åˆå¹¶main-srv-locçº§åˆ«ä¸‹server-locationç›¸å…³çš„é…ç½®é¡¹&#34;&gt;åˆå¹¶mainã€srvã€locçº§åˆ«ä¸‹serverã€locationç›¸å…³çš„é…ç½®é¡¹&lt;/h3&gt;
&lt;p&gt;å¯¹æ¯ä¸€server{}è€Œè¨€ï¼Œæ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„merge_srv_confå’Œmerge_loc_confå›è°ƒæ–¹æ³•, å¦‚æœå®ç°ï¼Œåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨merge_srv_confå’Œmerge_loc_confæ–¹æ³•ï¼Œæœ€ç»ˆç¡®å®šå¹¶ä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨serverçº§åˆ«çš„xx_(srv|loc)_conf_té…ç½®ç»“æ„ä½“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºæ¯ä¸€ä¸ªlocation{}è€Œè¨€ï¼Œæ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„merge_loc_confå›è°ƒæ–¹æ³•, å¦‚æœå®ç°, åˆ™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨merge_loc_confæ–¹æ³•ï¼Œæœ€ç»ˆç¡®å®šå¹¶ä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨locationçº§åˆ«çš„xx_loc_conf_té…ç½®ç»“æ„ä½“&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ„é€ locationç»„æˆçš„é™æ€äºŒå‰å¹³è¡¡æŸ¥æ‰¾æ ‘&#34;&gt;æ„é€ locationç»„æˆçš„é™æ€äºŒå‰å¹³è¡¡æŸ¥æ‰¾æ ‘&lt;/h3&gt;
&lt;p&gt;å¯¹äºæ¯ä¸€ä¸ªserverè€Œè¨€ï¼Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†ngx_http_core_loc_conf_tç»„æˆçš„åŒå‘é“¾è¡¨æŒ‰ç…§locationåŒ¹é…å­—ç¬¦ä¸²è¿›è¡Œæ’åº&lt;/li&gt;
&lt;li&gt;æ ¹æ®å·²ç»æ’åºè¿‡çš„çš„åŒå‘é“¾è¡¨ï¼Œæ„å»ºé™æ€çš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚è¿™æ ·å¤„ç†è¯·æ±‚æ—¶å¯ä»¥åŠ é€Ÿæ‰¾åˆ°location&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åˆå§‹åŒ–å¯æ·»åŠ å¤„ç†æ–¹æ³•çš„httpé˜¶æ®µçš„åŠ¨æ€æ•°ç»„&#34;&gt;åˆå§‹åŒ–å¯æ·»åŠ å¤„ç†æ–¹æ³•çš„HTTPé˜¶æ®µçš„åŠ¨æ€æ•°ç»„&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;httpè¯·æ±‚å¤„ç†çš„11ä¸ªé˜¶æ®µï¼Œåˆ†é…æ•°ç»„ï¼Œç”¨äºåç»­æ·»åŠ æ¨¡å—è‡ªå®šä¹‰çš„handleræ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è°ƒç”¨æ‰€æœ‰httpæ¨¡å—çš„postconfigurationæ–¹æ³•ä½¿ä¹‹å¯ä»¥ä»‹å…¥httpé˜¶æ®µ&#34;&gt;è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„postconfigurationæ–¹æ³•ä½¿ä¹‹å¯ä»¥ä»‹å…¥HTTPé˜¶æ®µ&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„&lt;code&gt;postconfiguration&lt;/code&gt;æ–¹æ³•ï¼Œå¦‚æœå®ç°ï¼Œåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨postconfigurationï¼Œå°†handleræ–¹æ³•æ·»åŠ åˆ°ä¸Šä¸€æ­¥å¸¸è§çš„æŸä¸ªé˜¶æ®µ(å“ªä¸ªé˜¶æ®µç”±æ¨¡å—è‡ªè¡Œå†³å®šï¼Œä½†åªæœ‰7ä¸ªé˜¶æ®µå¯ä»¥ä»‹å…¥)çš„æ•°ç»„ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ ¹æ®å„ä¸ªhttpæ¨¡å—ä»‹å…¥çš„å¤„ç†æ–¹æ³•æ„é€ å‡ºphase_engine_handlersæ•°ç»„&#34;&gt;æ ¹æ®å„ä¸ªHTTPæ¨¡å—ä»‹å…¥çš„å¤„ç†æ–¹æ³•æ„é€ å‡ºphase_engine_handlersæ•°ç»„&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ®å‰ä¸¤æ­¥æ„é€ çš„çš„åŠ¨æ€æ•°ç»„ï¼Œè°ƒç”¨&lt;code&gt;ngx_http_init_phase_handlers&lt;/code&gt;å‡½æ•°æ„é€ å‡ºphase_engine_handlersæ•°ç»„&lt;/li&gt;
&lt;li&gt;ç‰¹åˆ«çš„ï¼Œæœ‰å››ä¸ªé˜¶æ®µä¸å…è®¸ä»‹å…¥æˆ–è€…ä»‹å…¥æ— æ•ˆï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;code&gt;NGX_HTTP_FIND_CONFIG_PHASE&lt;/code&gt;ã€&lt;br&gt;
&lt;code&gt;NGX_HTTP_POST_REWRITE_PHASE&lt;/code&gt;ã€&lt;code&gt;NGX_HTTP_POST_ACCESS_PHASE&lt;/code&gt;ã€&lt;br&gt;
&lt;code&gt;NGX_HTTP_PRECONTENT_PHASE&lt;/code&gt;(æ—§çš„Nginxçš„try_filesé˜¶æ®µ)&lt;/li&gt;
&lt;li&gt;ç‰¹åˆ«çš„ï¼Œ&lt;code&gt;NGX_HTTP_CONTENT_PHASE&lt;/code&gt;é˜¶æ®µï¼Œé™¤äº†å¸¸è§„çš„postconfigurationä»‹å…¥æ–¹å¼(è¿™ç§æ–¹å¼å½±å“æ‰€æœ‰çš„location)ã€‚å¦å¤–å¯ä»¥ç›´æ¥ä»¥ngx_command_tæŒ‡å®šlocationçš„handleræ–¹å¼ä»‹å…¥ï¼Œåªå¯¹locationæœ‰è¯¥æŒ‡ä»¤çš„locationç”Ÿæ•ˆ&lt;/li&gt;
&lt;li&gt;ç‰¹åˆ«çš„,  è®°å½•httpæ—¥å¿—ï¼ˆæœ€åä¸€ä¸ªé˜¶æ®µlogï¼‰ç‰¹æ®Šå¤„ç†ï¼Œå¹¶ä¸ä¼šå‡ºç°åœ¨phase_engine_handlersæ•°ç»„ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ„é€ serverè™šæ‹Ÿä¸»æœºæ„æˆçš„æ”¯æŒé€šé…ç¬¦çš„æ•£åˆ—è¡¨&#34;&gt;æ„é€ serverè™šæ‹Ÿä¸»æœºæ„æˆçš„æ”¯æŒé€šé…ç¬¦çš„æ•£åˆ—è¡¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ngx_http_server_names&lt;/code&gt;å°†serverè™šæ‹Ÿä¸»æœºå’Œå¯¹åº”çš„ngx_http_core_srv_conf_tç»“æ„ä½“æŒ‡é’ˆå“ˆå¸ŒåŒ–å…³è”èµ·æ¥ï¼Œè¿™æ ·å¤„ç†è¯·æ±‚æ—¶å¯ä»¥å¿«é€ŸåŒ¹é…server&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ„é€ ç›‘å¬ç«¯å£ä¸serveré—´çš„å…³è”å…³ç³»å¹¶è®¾ç½®æ–°è¿æ¥äº‹ä»¶çš„å›è°ƒæ–¹æ³•&#34;&gt;æ„é€ ç›‘å¬ç«¯å£ä¸serveré—´çš„å…³è”å…³ç³»ï¼Œå¹¶è®¾ç½®æ–°è¿æ¥äº‹ä»¶çš„å›è°ƒæ–¹æ³•&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å°†ç›‘å¬ç«¯å£&lt;code&gt;ngx_http_conf_port_t&lt;/code&gt;å’Œaddråœ°å€&lt;code&gt;ngx_http_conf_addr_t&lt;/code&gt;å…³è”&lt;/li&gt;
&lt;li&gt;è¿›ä¸€æ­¥ï¼Œå°†&lt;code&gt;ngx_http_conf_addr_t&lt;/code&gt;å’Œserverè™šæ‹Ÿä¸»æœºå…³è”ã€‚è¯¥ç»“æ„ä½“æœ‰3ä¸ªå“ˆå¸Œè¡¨ç»“æ„å­—æ®µï¼Œ&lt;br&gt;
åˆ†åˆ«ç”¨äºç´¢å¼•å®Œå…¨åŒ¹é…çš„sever_nameã€é€šé…ç¬¦å‰ç½®ã€é€šé…ç¬¦åç½®çš„serverè™šæ‹Ÿä¸»æœºç»“æ„ä½“&lt;code&gt;ngx_http_core_srv_conf_t&lt;/code&gt;ç»“æ„ä½“æŒ‡é’ˆ&lt;/li&gt;
&lt;li&gt;è®¾ç½®æ–°è¿æ¥äº‹ä»¶çš„å›è°ƒæ–¹æ³•: &lt;code&gt;ngx_http_init_connection&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ&#34;&gt;httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ&lt;/h2&gt;
&lt;h3 id=&#34;æ„é€ phase_engine_handlersæ•°ç»„&#34;&gt;æ„é€ phase_engine_handlersæ•°ç»„&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ngx_http_init_phase_handlerså‡½æ•°åœ¨httpåˆå§‹åŒ–æ—¶è°ƒç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;//æ ¹æ®å„ä¸ªHTTPæ¨¡å—ä»‹å…¥çš„å¤„ç†æ–¹æ³•æ„é€ å‡ºphase_engine_handlersæ•°ç»„
static ngx_int_t
ngx_http_init_phase_handlers(ngx_conf_t *cf, ngx_http_core_main_conf_t *cmcf)
{
    ngx_int_t                   j;
    ngx_uint_t                  i, n;
    ngx_uint_t                  find_config_index, use_rewrite, use_access;
    ngx_http_handler_pt        *h;
    ngx_http_phase_handler_t   *ph;
    ngx_http_phase_handler_pt   checker;

    cmcf-&amp;gt;phase_engine.server_rewrite_index = (ngx_uint_t) -1;
    cmcf-&amp;gt;phase_engine.location_rewrite_index = (ngx_uint_t) -1;
    find_config_index = 0;
    use_rewrite = cmcf-&amp;gt;phases[NGX_HTTP_REWRITE_PHASE].handlers.nelts ? 1 : 0;
    use_access = cmcf-&amp;gt;phases[NGX_HTTP_ACCESS_PHASE].handlers.nelts ? 1 : 0;

    n = 1                  /* find config phase */
        + use_rewrite      /* post rewrite phase */
        + use_access;      /* post access phase */

    for (i = 0; i &amp;lt; NGX_HTTP_LOG_PHASE; i++) { //æ³¨æ„:ä¸åŒ…å«NGX_HTTP_LOG_PHASEé˜¶æ®µ,è¯¥é˜¶æ®µå¦è¡Œç‰¹æ®Šå¤„ç†
        n += cmcf-&amp;gt;phases[i].handlers.nelts; //ç´¯åŠ è®¡ç®—æ€»çš„HTTPé˜¶æ®µå¤„ç†æ–¹æ³•ä¸ªæ•°
    }

    ph = ngx_pcalloc(cf-&amp;gt;pool,
                     n * sizeof(ngx_http_phase_handler_t) + sizeof(void *));
    if (ph == NULL) {
        return NGX_ERROR;
    }

    cmcf-&amp;gt;phase_engine.handlers = ph;
    n = 0;

    for (i = 0; i &amp;lt; NGX_HTTP_LOG_PHASE; i++) { //æ³¨æ„: ä¸åŒ…å«NGX_HTTP_LOG_PHASEé˜¶æ®µ
        h = cmcf-&amp;gt;phases[i].handlers.elts;

        switch (i) {

        case NGX_HTTP_SERVER_REWRITE_PHASE:
            if (cmcf-&amp;gt;phase_engine.server_rewrite_index == (ngx_uint_t) -1) {
                cmcf-&amp;gt;phase_engine.server_rewrite_index = n;
            }
            checker = ngx_http_core_rewrite_phase;

            break;

        case NGX_HTTP_FIND_CONFIG_PHASE:
            find_config_index = n;

            ph-&amp;gt;checker = ngx_http_core_find_config_phase;
            n++;
            ph++;

            continue;

        case NGX_HTTP_REWRITE_PHASE:
            if (cmcf-&amp;gt;phase_engine.location_rewrite_index == (ngx_uint_t) -1) {
                cmcf-&amp;gt;phase_engine.location_rewrite_index = n;
            }
            checker = ngx_http_core_rewrite_phase;

            break;

        case NGX_HTTP_POST_REWRITE_PHASE:
            if (use_rewrite) {
                ph-&amp;gt;checker = ngx_http_core_post_rewrite_phase;
                ph-&amp;gt;next = find_config_index;
                n++;
                ph++;
            }

            continue;

        case NGX_HTTP_ACCESS_PHASE:
            checker = ngx_http_core_access_phase;
            n++;
            break;

        case NGX_HTTP_POST_ACCESS_PHASE:
            if (use_access) {
                ph-&amp;gt;checker = ngx_http_core_post_access_phase;
                ph-&amp;gt;next = n;
                ph++;
            }

            continue;

        case NGX_HTTP_CONTENT_PHASE:
            checker = ngx_http_core_content_phase;
            break;

        default: //NGX_HTTP_POST_READ_PHASEã€NGX_HTTP_PREACCESS_PHASEã€NGX_HTTP_PRECONTENT_PHASE
            checker = ngx_http_core_generic_phase;
        }

        n += cmcf-&amp;gt;phases[i].handlers.nelts; //è·³è¿‡æœ¬é˜¶æ®µçš„æ‰€æœ‰handler, ä¹Ÿå³ä¸‹ä¸€é˜¶æ®µçš„é¦–ä¸ªhandler

        //æ³¨æ„:æ¯ä¸ªHTTPå¤„ç†é˜¶æ®µä¸­æœ€ååŠ å…¥åˆ°handlers[]ä¸­çš„ä¼šé¦–å…ˆæ·»åŠ åˆ°cmcf-&amp;gt;phase_engine.handlers
        for (j = cmcf-&amp;gt;phases[i].handlers.nelts - 1; j &amp;gt;= 0; j--) {
            ph-&amp;gt;checker = checker;
            ph-&amp;gt;handler = h[j];
            ph-&amp;gt;next = n; //ä¸‹ä¸€é˜¶æ®µçš„é¦–ä¸ªhandleråºå·
            ph++;
        }
    }

    return NGX_OK;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;checkeræ–¹æ³•&#34;&gt;checkeræ–¹æ³•&lt;/h3&gt;
&lt;h4 id=&#34;ngx_http_core_generic_phase&#34;&gt;ngx_http_core_generic_phase&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/*
 * NGX_HTTP_(POST_READ | PREACCESS | PRECONTENT)_PHASEç­‰é˜¶æ®µçš„checkeræ–¹æ³•
 */
ngx_int_t
ngx_http_core_generic_phase(ngx_http_request_t *r, ngx_http_phase_handler_t *ph)
{
    ngx_int_t  rc;

    /*
     * generic phase checker,
     * used by the post read and pre-access phases
     */

    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,
                   &amp;quot;generic phase: %ui&amp;quot;, r-&amp;gt;phase_handler);

    //è°ƒç”¨HTTPæ¨¡å—æ·»åŠ çš„handlerå¤„ç†æ–¹æ³•(ç”±å„ä¸ªHTTPæ¨¡å—çš„postconfigurationé’©å­å‡½æ•°æ·»åŠ )
    rc = ph-&amp;gt;handler(r);

    if (rc == NGX_OK) {
        r-&amp;gt;phase_handler = ph-&amp;gt;next; //rcä¸ºNGX_OKæ—¶ï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µå°±è¡Œå¤„ç†, å½“å‰é˜¶æ®µå³ä½¿æœ‰å…¶ä»–å¤„ç†æ–¹æ³•ä¹Ÿä¼šè·³è¿‡
        return NGX_AGAIN;
    }

    if (rc == NGX_DECLINED) {
        r-&amp;gt;phase_handler++; //ä¸‹ä¸€ä¸ªå¤„ç†æ–¹æ³•ï¼Œå¯èƒ½ä»æ˜¯å½“å‰é˜¶æ®µï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸‹ä¸€ä¸ªé˜¶æ®µçš„é¦–ä¸ªå¤„ç†æ–¹æ³•
        return NGX_AGAIN;
    }

    if (rc == NGX_AGAIN || rc == NGX_DONE) {
        return NGX_OK; //ä¸æ›´æ”¹r-&amp;gt;phase_handlerçš„å€¼ï¼Œå½“å‰å¤„ç†æ–¹æ³•æœ‰æœºä¼šå†æ¬¡è¢«è°ƒç”¨ã€‚ä½†æ˜¯å¿…é¡»æŠŠæ§åˆ¶æƒäº¤è¿˜eventæ¨¡å—
    }

    /* rc == NGX_ERROR || rc == NGX_HTTP_...  */

    ngx_http_finalize_request(r, rc); //è¿”å›é”™è¯¯NGX_ERRORæˆ–è€…NGX_HTTP_å¼€å¤´çš„è¿”å›ç ï¼Œåˆ™ç»“æŸè¯·æ±‚

    return NGX_OK;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;ngx_http_core_rewrite_phase&#34;&gt;ngx_http_core_rewrite_phase&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/*
 * NGX_HTTP_(SERVER_REWRITE | REWRITE)_PHASEç­‰é˜¶æ®µçš„checkeræ–¹æ³•
 */
ngx_int_t
ngx_http_core_rewrite_phase(ngx_http_request_t *r, ngx_http_phase_handler_t *ph)
{
    ngx_int_t  rc;

    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,
                   &amp;quot;rewrite phase: %ui&amp;quot;, r-&amp;gt;phase_handler);

    rc = ph-&amp;gt;handler(r); //æ‰§è¡ŒæŒ‚è½½çš„handleræ–¹æ³•

    if (rc == NGX_DECLINED) {
        r-&amp;gt;phase_handler++; //å½“å‰å¤„ç†æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†æ–¹æ³•
        return NGX_AGAIN;
    }

    if (rc == NGX_DONE) {
        return NGX_OK; //ä¸æ›´æ”¹r-&amp;gt;phase_handlerçš„å€¼ï¼Œå½“å‰å¤„ç†æ–¹æ³•æœ‰æœºä¼šå†æ¬¡è¢«è°ƒç”¨ã€‚ä½†æ˜¯å¿…é¡»æŠŠæ§åˆ¶æƒäº¤è¿˜eventæ¨¡å—
    }

    /* NGX_OK, NGX_AGAIN, NGX_ERROR, NGX_HTTP_...  */

    ngx_http_finalize_request(r, rc); //ç»“æŸè¯·æ±‚

    return NGX_OK;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;ngx_http_core_find_config_phase&#34;&gt;ngx_http_core_find_config_phase&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/*
 * æ ¹æ®è¯·æ±‚çš„URIå¯»æ‰¾åŒ¹é…çš„locationè¡¨è¾¾å¼ï¼Œä¸å…è®¸ç”¨æˆ·æ¨¡å—ä»‹å…¥ã€‚å³ä½¿ä»‹å…¥ä¹Ÿæ— æ•ˆï¼Œå› ä¸ºå…¥å‚phæœªä½¿ç”¨
 */
ngx_int_t
ngx_http_core_find_config_phase(ngx_http_request_t *r,
    ngx_http_phase_handler_t *ph)
{
    u_char                    *p;
    size_t                     len;
    ngx_int_t                  rc;
    ngx_http_core_loc_conf_t  *clcf;

    r-&amp;gt;content_handler = NULL;
    r-&amp;gt;uri_changed = 0;

    rc = ngx_http_core_find_location(r);

    if (rc == NGX_ERROR) {
        ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);
        return NGX_OK;
    }

    clcf = ngx_http_get_module_loc_conf(r, ngx_http_core_module);

    if (!r-&amp;gt;internal &amp;amp;&amp;amp; clcf-&amp;gt;internal) {
        ngx_http_finalize_request(r, NGX_HTTP_NOT_FOUND);
        return NGX_OK;
    }

    ngx_log_debug2(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,
                   &amp;quot;using configuration \&amp;quot;%s%V\&amp;quot;&amp;quot;,
                   (clcf-&amp;gt;noname ? &amp;quot;*&amp;quot; : (clcf-&amp;gt;exact_match ? &amp;quot;=&amp;quot; : &amp;quot;&amp;quot;)),
                   &amp;amp;clcf-&amp;gt;name);

    ngx_http_update_location_config(r);

    ngx_log_debug2(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,
                   &amp;quot;http cl:%O max:%O&amp;quot;,
                   r-&amp;gt;headers_in.content_length_n, clcf-&amp;gt;client_max_body_size);

    if (r-&amp;gt;headers_in.content_length_n != -1
        &amp;amp;&amp;amp; !r-&amp;gt;discard_body
        &amp;amp;&amp;amp; clcf-&amp;gt;client_max_body_size
        &amp;amp;&amp;amp; clcf-&amp;gt;client_max_body_size &amp;lt; r-&amp;gt;headers_in.content_length_n)
    {
        ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0,
                      &amp;quot;client intended to send too large body: %O bytes&amp;quot;,
                      r-&amp;gt;headers_in.content_length_n);

        r-&amp;gt;expect_tested = 1;
        (void) ngx_http_discard_request_body(r);
        ngx_http_finalize_request(r, NGX_HTTP_REQUEST_ENTITY_TOO_LARGE);
        return NGX_OK;
    }

    if (rc == NGX_DONE) {
        ngx_http_clear_location(r);

        r-&amp;gt;headers_out.location = ngx_list_push(&amp;amp;r-&amp;gt;headers_out.headers);
        if (r-&amp;gt;headers_out.location == NULL) {
            ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);
            return NGX_OK;
        }

        r-&amp;gt;headers_out.location-&amp;gt;hash = 1;
        ngx_str_set(&amp;amp;r-&amp;gt;headers_out.location-&amp;gt;key, &amp;quot;Location&amp;quot;);

        if (r-&amp;gt;args.len == 0) {
            r-&amp;gt;headers_out.location-&amp;gt;value = clcf-&amp;gt;name;

        } else {
            len = clcf-&amp;gt;name.len + 1 + r-&amp;gt;args.len;
            p = ngx_pnalloc(r-&amp;gt;pool, len);

            if (p == NULL) {
                ngx_http_clear_location(r);
                ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);
                return NGX_OK;
            }

            r-&amp;gt;headers_out.location-&amp;gt;value.len = len;
            r-&amp;gt;headers_out.location-&amp;gt;value.data = p;

            p = ngx_cpymem(p, clcf-&amp;gt;name.data, clcf-&amp;gt;name.len);
            *p++ = &#39;?&#39;;
            ngx_memcpy(p, r-&amp;gt;args.data, r-&amp;gt;args.len);
        }

        ngx_http_finalize_request(r, NGX_HTTP_MOVED_PERMANENTLY);
        return NGX_OK;
    }

    r-&amp;gt;phase_handler++; //ä¸‹ä¸€é˜¶æ®µ
    return NGX_AGAIN;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;ngx_http_core_post_rewrite_phase&#34;&gt;ngx_http_core_post_rewrite_phase&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/*
 * NGX_HTTP_POST_REWRITE_PHASEé˜¶æ®µçš„checkeræ–¹æ³•
 */
ngx_int_t
ngx_http_core_post_rewrite_phase(ngx_http_request_t *r,
    ngx_http_phase_handler_t *ph)
{
    ngx_http_core_srv_conf_t  *cscf;

    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,
                   &amp;quot;post rewrite phase: %ui&amp;quot;, r-&amp;gt;phase_handler);

    if (!r-&amp;gt;uri_changed) {
        r-&amp;gt;phase_handler++;
        return NGX_AGAIN;
    }

    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,
                   &amp;quot;uri changes: %d&amp;quot;, r-&amp;gt;uri_changes);

    /*
     * gcc before 3.3 compiles the broken code for
     *     if (r-&amp;gt;uri_changes-- == 0)
     * if the r-&amp;gt;uri_changes is defined as
     *     unsigned  uri_changes:4
     */

    r-&amp;gt;uri_changes--;

    if (r-&amp;gt;uri_changes == 0) { //urlæ”¹å†™æ¬¡æ•°è¶…é™ï¼Œç»“æŸè¯·æ±‚
        ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0,
                      &amp;quot;rewrite or internal redirection cycle &amp;quot;
                      &amp;quot;while processing \&amp;quot;%V\&amp;quot;&amp;quot;, &amp;amp;r-&amp;gt;uri);

        ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);
        return NGX_OK;
    }

    r-&amp;gt;phase_handler = ph-&amp;gt;next;

    cscf = ngx_http_get_module_srv_conf(r, ngx_http_core_module);
    r-&amp;gt;loc_conf = cscf-&amp;gt;ctx-&amp;gt;loc_conf;

    return NGX_AGAIN;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;ngx_http_core_access_phase&#34;&gt;ngx_http_core_access_phase&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/*
 * NGX_HTTP_ACCESS_PHASEé˜¶æ®µçš„checkeræ–¹æ³•
 */
ngx_int_t
ngx_http_core_access_phase(ngx_http_request_t *r, ngx_http_phase_handler_t *ph)
{
    ngx_int_t                  rc;
    ngx_http_core_loc_conf_t  *clcf;

    if (r != r-&amp;gt;main) { //å­è¯·æ±‚
        r-&amp;gt;phase_handler = ph-&amp;gt;next; //è·³åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µ
        return NGX_AGAIN;
    }

    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,
                   &amp;quot;access phase: %ui&amp;quot;, r-&amp;gt;phase_handler);

    rc = ph-&amp;gt;handler(r); //æ‰§è¡Œæ¨¡å—æŒ‚è½½çš„handleræ–¹æ³•

    if (rc == NGX_DECLINED) {
        r-&amp;gt;phase_handler++; //ä¸‹ä¸€ä¸ªå¤„ç†æ–¹æ³•
        return NGX_AGAIN;
    }

    if (rc == NGX_AGAIN || rc == NGX_DONE) {
        return NGX_OK; //ä¸æ›´æ”¹r-&amp;gt;phase_handlerçš„å€¼ï¼Œå½“å‰å¤„ç†æ–¹æ³•æœ‰æœºä¼šå†æ¬¡è¢«è°ƒç”¨ã€‚ä½†æ˜¯å¿…é¡»æŠŠæ§åˆ¶æƒäº¤è¿˜eventæ¨¡å—
    }

    clcf = ngx_http_get_module_loc_conf(r, ngx_http_core_module);

    if (clcf-&amp;gt;satisfy == NGX_HTTP_SATISFY_ALL) {

        if (rc == NGX_OK) {
            r-&amp;gt;phase_handler++; //satisfy all, åˆ™æ‰§è¡Œä¸‹ä¸€ä¸ªhandleræ–¹æ³•
            return NGX_AGAIN;
        }

    } else { //satisfy any
        if (rc == NGX_OK) {
            r-&amp;gt;access_code = 0;

            if (r-&amp;gt;headers_out.www_authenticate) {
                r-&amp;gt;headers_out.www_authenticate-&amp;gt;hash = 0;
            }

            r-&amp;gt;phase_handler = ph-&amp;gt;next; //satisfy any, åˆ™è·³åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µ
            return NGX_AGAIN;
        }

        if (rc == NGX_HTTP_FORBIDDEN || rc == NGX_HTTP_UNAUTHORIZED) {
            if (r-&amp;gt;access_code != NGX_HTTP_UNAUTHORIZED) {
                r-&amp;gt;access_code = rc;
            }

            r-&amp;gt;phase_handler++; //ä¸‹ä¸€ä¸ªhandleræ–¹æ³•
            return NGX_AGAIN;
        }
    }

    /* rc == NGX_ERROR || rc == NGX_HTTP_...  */

    ngx_http_finalize_request(r, rc); //ç»“æŸè¯·æ±‚
    return NGX_OK;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;ngx_http_core_post_access_phase&#34;&gt;ngx_http_core_post_access_phase&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/*
 * NGX_HTTP_POST_ACCESS_PHASEé˜¶æ®µçš„checkeræ–¹æ³•, å…¥å‚phæœªä½¿ç”¨ï¼Œå³ä¸å…è®¸ä»‹å…¥
 */
ngx_int_t
ngx_http_core_post_access_phase(ngx_http_request_t *r,
    ngx_http_phase_handler_t *ph)
{
    ngx_int_t  access_code;

    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,
                   &amp;quot;post access phase: %ui&amp;quot;, r-&amp;gt;phase_handler);

    access_code = r-&amp;gt;access_code;

    if (access_code) { //access_codeé0ï¼Œè¡¨æ˜æ²¡æœ‰è®¿é—®æƒé™
        if (access_code == NGX_HTTP_FORBIDDEN) {
            ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0,
                          &amp;quot;access forbidden by rule&amp;quot;);
        }

        r-&amp;gt;access_code = 0;
        ngx_http_finalize_request(r, access_code);
        return NGX_OK;
    }

    r-&amp;gt;phase_handler++;
    return NGX_AGAIN;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;ngx_http_core_content_phase&#34;&gt;ngx_http_core_content_phase&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/*
 * NGX_HTTP_CONTENT_PHASEé˜¶æ®µçš„checkeræ–¹æ³•
 */
ngx_int_t
ngx_http_core_content_phase(ngx_http_request_t *r,
    ngx_http_phase_handler_t *ph)
{
    size_t     root;
    ngx_int_t  rc;
    ngx_str_t  path;

    if (r-&amp;gt;content_handler) { //ä»‹å…¥çš„ç‰¹æ®Šæ–¹å¼: æŸlocationç‰¹æœ‰çš„handleræ–¹æ³•, ä¸å½±å“å…¶ä»–location
        r-&amp;gt;write_event_handler = ngx_http_request_empty_handler;
        ngx_http_finalize_request(r, r-&amp;gt;content_handler(r));
        return NGX_OK;
    }

    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,
                   &amp;quot;content phase: %ui&amp;quot;, r-&amp;gt;phase_handler);

    rc = ph-&amp;gt;handler(r); //æ‰§è¡Œpostconfigurationé’©å­å‡½æ•°æ·»åŠ çš„handleræ–¹æ³•

    if (rc != NGX_DECLINED) {
        ngx_http_finalize_request(r, rc);
        return NGX_OK;
    }

    /* rc == NGX_DECLINED */

    ph++;

    if (ph-&amp;gt;checker) {
        r-&amp;gt;phase_handler++; //ä¸‹ä¸€ä¸ªhandleræ–¹æ³•
        return NGX_AGAIN;
    }

    /* no content handler was found */

    if (r-&amp;gt;uri.data[r-&amp;gt;uri.len - 1] == &#39;/&#39;) {

        if (ngx_http_map_uri_to_path(r, &amp;amp;path, &amp;amp;root, 0) != NULL) {
            ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0,
                          &amp;quot;directory index of \&amp;quot;%s\&amp;quot; is forbidden&amp;quot;, path.data);
        }

        ngx_http_finalize_request(r, NGX_HTTP_FORBIDDEN);
        return NGX_OK;
    }

    ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0, &amp;quot;no handler found&amp;quot;);

    ngx_http_finalize_request(r, NGX_HTTP_NOT_FOUND); //404
    return NGX_OK;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å¤„ç†è¯·æ±‚ç»è¿‡10ä¸ªé˜¶æ®µ&#34;&gt;å¤„ç†è¯·æ±‚ç»è¿‡10ä¸ªé˜¶æ®µ&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;/*
 * 10ä¸ªé˜¶æ®µå¤„ç†HTTPè¯·æ±‚
 */
void
ngx_http_core_run_phases(ngx_http_request_t *r)
{
    ngx_int_t                   rc;
    ngx_http_phase_handler_t   *ph;
    ngx_http_core_main_conf_t  *cmcf;

    cmcf = ngx_http_get_module_main_conf(r, ngx_http_core_module);

    ph = cmcf-&amp;gt;phase_engine.handlers;

    while (ph[r-&amp;gt;phase_handler].checker) {

        rc = ph[r-&amp;gt;phase_handler].checker(r, &amp;amp;ph[r-&amp;gt;phase_handler]);

        if (rc == NGX_OK) {
            return;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;è®°å½•httpæ—¥å¿—é˜¶æ®µç‰¹æ®Šå¤„ç†&#34;&gt;è®°å½•httpæ—¥å¿—é˜¶æ®µç‰¹æ®Šå¤„ç†&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;/*
 * è®°å½•è®¿é—®æ—¥å¿—ã€‚logé˜¶æ®µçš„handleré“¾å¹¶ä¸æ˜¯åœ¨ngx_http_core_run_phaseså‡½æ•°ä¸­æ‰§è¡Œ, å®ƒåªéœ€åœ¨è¯·æ±‚å¤„ç†é€»è¾‘ç»“æŸåæ‰æ‰§è¡Œä¸€æ¬¡
 */
static void
ngx_http_log_request(ngx_http_request_t *r)
{
    ngx_uint_t                  i, n;
    ngx_http_handler_pt        *log_handler;
    ngx_http_core_main_conf_t  *cmcf;

    cmcf = ngx_http_get_module_main_conf(r, ngx_http_core_module);

    log_handler = cmcf-&amp;gt;phases[NGX_HTTP_LOG_PHASE].handlers.elts;
    n = cmcf-&amp;gt;phases[NGX_HTTP_LOG_PHASE].handlers.nelts;

    for (i = 0; i &amp;lt; n; i++) {
        log_handler[i](r);
    }
}
&lt;/code&gt;&lt;/pre&gt;
">Nginxæºç åˆ†æä¹‹--httpæ¡†æ¶</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://xly0713.github.io/post/zsh-ti-dai-bash/"" data-c="
          &lt;p&gt;zshæ›¿æ¢bashï¼Œå¯ä»¥è®©å‘½ä»¤è¡Œæ“ä½œæ›´é«˜æ•ˆã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;å®‰è£…zsh&#34;&gt;å®‰è£…zsh&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;yum install zsh -y
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å®‰è£…oh-my-zsh&#34;&gt;å®‰è£…oh-my-zsh&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sh -c &amp;quot;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å®‰è£…zsh-autosuggestionsæ’ä»¶&#34;&gt;å®‰è£…zsh-autosuggestionsæ’ä»¶&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ä¿®æ”¹~zshrcæ–‡ä»¶&#34;&gt;ä¿®æ”¹~/.zshrcæ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;æ‰¾åˆ°pluginså˜é‡ï¼Œå¢åŠ zsh-autosuggestionsï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;plugins=(zsh-autosuggestions)
&lt;/code&gt;&lt;/pre&gt;
">zshæ›¿ä»£bash</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://xly0713.github.io/post/ats-ru-men/"" data-c="
          &lt;p&gt;æœ¬æ–‡æ˜¯å¯¹ATSçš„å®‰è£…ã€é…ç½®ã€æ—¥å¿—ç­‰ç›¸å…³åŸºç¡€çŸ¥è¯†çš„æ•´ç†ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;å®‰è£…-ä»¥trafficserver-805ç‰ˆæœ¬ä¸ºä¾‹&#34;&gt;å®‰è£… ï¼ˆä»¥trafficserver-8.0.5ç‰ˆæœ¬ä¸ºä¾‹ï¼‰&lt;/h2&gt;
&lt;h3 id=&#34;ä¸‹è½½æºä»£ç å¹¶è§£å‹&#34;&gt;ä¸‹è½½æºä»£ç å¹¶è§£å‹&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;yum -y install bzip2 wget
wget https://mirror.bit.edu.cn/apache/trafficserver/trafficserver-8.0.5.tar.bz2
tar xf trafficserver-8.0.5.tar.bz2
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å‡†å¤‡c17ç¼–è¯‘ç¯å¢ƒ&#34;&gt;å‡†å¤‡c++17ç¼–è¯‘ç¯å¢ƒ&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;yum -y install centos-release-scl
yum -y install yum-utils
yum-config-manager --enable rhel-server-rhscl-7-rpms
yum -y install devtoolset-7

scl enable devtoolset-7 zsh
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å®‰è£…tcl-dev-package&#34;&gt;å®‰è£…TCL dev package&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;yum -y install tcl-devel
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å®‰è£…openssl-devel&#34;&gt;å®‰è£…openssl-devel&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;yum -y install openssl-devel
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å®‰è£…lua-devel&#34;&gt;å®‰è£…lua-devel&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;yum -y install lua-devel
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å®‰è£…ncurses-devel&#34;&gt;å®‰è£…ncurses-devel&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;yum -y install ncurses-devel
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ç”Ÿæˆmakefile&#34;&gt;ç”ŸæˆMakefile&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;./configure --prefix=/opt/ats
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ„å»º-æµ‹è¯•-å®‰è£…&#34;&gt;æ„å»ºã€æµ‹è¯•ã€å®‰è£…&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;make
make test
make install
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ±‡æ€»å®‰è£…æ­¥éª¤&#34;&gt;æ±‡æ€»å®‰è£…æ­¥éª¤&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;yum -y install bzip2 wget tcl-devel openssl-devel lua-devel  ncurses-devel 
yum -y install centos-release-scl yum-utils
yum-config-manager --enable rhel-server-rhscl-7-rpms
yum -y install devtoolset-7
scl enable devtoolset-7 zsh

./configure --prefix=/opt/ats
make
make test
make install
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;é…ç½®&#34;&gt;é…ç½®&lt;/h2&gt;
&lt;h3 id=&#34;æ ¸å¿ƒé…ç½®æ–‡ä»¶recordsconfig&#34;&gt;æ ¸å¿ƒé…ç½®æ–‡ä»¶records.config&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æš‚ç•¥ï¼Œå¾…è¡¥å……&lt;/li&gt;
&lt;li&gt;ç‰¹åˆ«çš„ï¼Œå¯ä»¥é…ç½®å¯ç”¨UIæ–¹ä¾¿æŸ¥çœ‹ATSè¿è¡Œæ—¶å…³é”®ä¿¡æ¯ã€æ£€ç´¢å’Œåˆ é™¤ç¼“å­˜ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åå‘ä»£ç†å›æºæ˜ å°„é…ç½®æ–‡ä»¶remapconfig&#34;&gt;åå‘ä»£ç†å›æºæ˜ å°„é…ç½®æ–‡ä»¶remap.config&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æš‚ç•¥ï¼Œå¾…è¡¥å……&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¼“å­˜ç›¸å…³é…ç½®æ–‡ä»¶cacheconfig&#34;&gt;ç¼“å­˜ç›¸å…³é…ç½®æ–‡ä»¶cache.config&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æš‚ç•¥ï¼Œå¾…è¡¥å……&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å­˜å‚¨é…ç½®storageconfig&#34;&gt;å­˜å‚¨é…ç½®storage.config&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æš‚ç•¥ï¼Œå¾…è¡¥å……&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ—¥å¿—&#34;&gt;æ—¥å¿—&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨records.configä¸­é…ç½®æ—¥å¿—è·¯å¾„ã€åˆ†å‰²æ–¹å¼ç­‰&lt;/li&gt;
&lt;li&gt;squidé£æ ¼çš„æ—¥å¿—ï¼Œä½¿ç”¨traffic_logcatæŸ¥çœ‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ’ä»¶&#34;&gt;æ’ä»¶&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/portl4t/ts-lua&#34;&gt;luaæ’ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.trafficserver.apache.org/en/8.0.x/admin-guide/plugins/index.en.html&#34;&gt;å®˜æ–¹æ’ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.trafficserver.apache.org/en/8.0.x/developer-guide/plugins/index.en.html&#34;&gt;æ’ä»¶å¼€å‘æŒ‡å—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
">ATSå…¥é—¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://xly0713.github.io/post/nginx-yuan-ma-xue-xi/"" data-c="
          &lt;p&gt;Nginxä½œä¸ºé«˜æ€§èƒ½çš„webæœåŠ¡å™¨ï¼Œå®ƒæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;å†…å­˜æ± çš„ä¼˜ç‚¹&#34;&gt;å†…å­˜æ± çš„ä¼˜ç‚¹&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;poolåŒ–å¤„ç†ï¼Œé¿å…å¤šæ¬¡å‘ç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œå‡å°‘ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢ï¼Œæé«˜å†…å­˜åˆ†é…æ•ˆç‡;&lt;/li&gt;
&lt;li&gt;å†…å­˜ç»Ÿä¸€åˆ†é…å’Œå›æ”¶ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼›&lt;/li&gt;
&lt;li&gt;æ•´å—åˆ†é…ï¼Œé¿å…å†…å­˜è¿‡äºç¢ç‰‡åŒ–;&lt;/li&gt;
&lt;li&gt;å†…å­˜å¯¹é½å¤„ç†ï¼Œå‡å°‘CPUè¯»å–å†…å­˜æ¬¡æ•°ï¼Œæé«˜å¯»å€æ•ˆç‡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å†…å­˜æ± ç›¸å…³çš„æ•°æ®ç»“æ„&#34;&gt;å†…å­˜æ± ç›¸å…³çš„æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;h3 id=&#34;ç»“æ„ä½“ç¤ºæ„å›¾&#34;&gt;ç»“æ„ä½“ç¤ºæ„å›¾&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://xly0713.github.io/post-images/1587183416580.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;æ•°æ®ç»“æ„å®šä¹‰&#34;&gt;æ•°æ®ç»“æ„å®šä¹‰&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;typedef struct ngx_pool_s            ngx_pool_t;
typedef struct ngx_pool_large_s  ngx_pool_large_t;

struct ngx_pool_s { //å†…å­˜æ± å¤´éƒ¨ç»“æ„
    ngx_pool_data_t       d;        //å†…å­˜æ± çš„æ•°æ®åŒºï¼Œå³çœŸæ­£åˆ†é…å†…å­˜çš„åŒºåŸŸ
    size_t                max;      //æ¯æ¬¡å¯åˆ†é…æœ€å¤§å†…å­˜ï¼Œç”¨äºåˆ¤å®šæ˜¯èµ°å¤§å†…å­˜åˆ†é…è¿˜æ˜¯å°å†…å­˜åˆ†é…é€»è¾‘
    ngx_pool_t           *current;  //æŒ‡å‘å½“å‰å†…å­˜æ± å°å—å†…å­˜å¯ç”¨çš„é¦–ä¸ªèŠ‚ç‚¹
    ngx_chain_t          *chain;    //ç¼“å†²åŒºé“¾è¡¨
    ngx_pool_large_t     *large;    //å†…å­˜å—å¤§äºmaxå†…å­˜å—çš„é“¾è¡¨
    ngx_pool_cleanup_t   *cleanup;  //é”€æ¯å†…å­˜æ± å›è°ƒå‡½æ•°
    ngx_log_t            *log;      //é”™è¯¯æ—¥å¿—æŒ‡é’ˆ
};

typedef struct {
    u_char               *last;     //å½“å‰å†…å­˜å—å·²ä½¿ç”¨åˆ°æ­¤å¤„ï¼Œä¸‹ä¸€æ¬¡ä½¿ç”¨ä»æ­¤å¤„å¼€å§‹
    u_char               *end;      //å†…å­˜å—ç»“æŸä½ç½®
    ngx_pool_t           *next;     //å†…å­˜æ± æœ‰å¾ˆå¤šå†…å­˜å—ï¼Œé€šè¿‡nextæŒ‡é’ˆç»„æˆé“¾è¡¨
    ngx_uint_t            failed;   //å†…å­˜å—åˆ†é…å¤±è´¥æ¬¡æ•°
} ngx_pool_data_t; //å°å†…å­˜å—(é“¾è¡¨)

//å¤§å†…å­˜å—(é“¾è¡¨)
struct ngx_pool_large_s {
    ngx_pool_large_t     *next;  //ä¸‹ä¸€æ•°æ®å—åœ°å€
    void                 *alloc; //å½“å‰æ•°æ®å—åœ°å€
};
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å†…å­˜æ± ä¸»è¦å‡½æ•°&#34;&gt;å†…å­˜æ± ä¸»è¦å‡½æ•°&lt;/h2&gt;
&lt;h3 id=&#34;æ–°å»ºå†…å­˜æ± &#34;&gt;æ–°å»ºå†…å­˜æ± &lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;/*
 * æ–°å»ºä¸€ä¸ªå†…å­˜æ± 
 */
ngx_pool_t *
ngx_create_pool(size_t size, ngx_log_t *log)
{
    ngx_pool_t  *p;

    //è°ƒç”¨ç³»ç»Ÿå†…å­˜åˆ†é…å‡½æ•°ï¼Œåˆ†é…ä¸€å—å †å†…å­˜ï¼Œä¸”åšå¯¹é½å¤„ç†
    p = ngx_memalign(NGX_POOL_ALIGNMENT, size, log);
    if (p == NULL) {
        return NULL;
    }

    p-&amp;gt;d.last = (u_char *) p + sizeof(ngx_pool_t);
    p-&amp;gt;d.end = (u_char *) p + size;
    p-&amp;gt;d.next = NULL;
    p-&amp;gt;d.failed = 0;

    size = size - sizeof(ngx_pool_t);
    //maxæœ€å¤§ä¸ºpagesize-1(æ¯”å¦‚:x86æ—¶ä¸º4095), å³ï¼šæ— è®ºå°å—å†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œè¶…è¿‡pagesize-1å¤§å°çš„å†…å­˜å‡èµ°largeå—åˆ†é…
    p-&amp;gt;max = (size &amp;lt; NGX_MAX_ALLOC_FROM_POOL) ? size : NGX_MAX_ALLOC_FROM_POOL;

    p-&amp;gt;current = p;
    p-&amp;gt;chain = NULL;
    p-&amp;gt;large = NULL;
    p-&amp;gt;cleanup = NULL;
    p-&amp;gt;log = log;

    return p;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ä»å†…å­˜æ± ç”³è¯·å†…å­˜&#34;&gt;ä»å†…å­˜æ± ç”³è¯·å†…å­˜&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆå¯¹é½å†åˆ†é…å†…å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;/*
 * ä»å†…å­˜æ± ä¸­ç”³è¯·ä¸€å—å†…å­˜
 * ï¼ˆ1ï¼‰å¦‚æœç”³è¯·çš„å†…å­˜å°äºå®šä¹‰çš„maxï¼Œåˆ™ä»å†…å­˜æ± ä¸­åˆ†é…å†…å­˜ï¼Œéœ€å…ˆå¯¹é½å†åˆ†é…
 * ï¼ˆ2ï¼‰å¦åˆ™åˆ†é…å¤§å—å†…å­˜æŒ‚è½½åˆ°largeæŒ‡é’ˆä¸Š
 */
void *
ngx_palloc(ngx_pool_t *pool, size_t size)
{
#if !(NGX_DEBUG_PALLOC)
    if (size &amp;lt;= pool-&amp;gt;max) {
        return ngx_palloc_small(pool, size, 1); //å°å—å†…å­˜(å…ˆå¯¹é½)
    }
#endif

    return ngx_palloc_large(pool, size);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆå¯¹é½å†åˆ†é…å†…å­˜, å¹¶å¡«å……0&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;/*
 * ä»å†…å­˜æ± ä¸­ç”³è¯·å†…å­˜ï¼Œå¹¶å¡«å……0
 */
void *
ngx_pcalloc(ngx_pool_t *pool, size_t size)
{
    void *p;

    p = ngx_palloc(pool, size);
    if (p) {
        ngx_memzero(p, size);
    }

    return p;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ç”¨å¯¹é½åˆ†é…å†…å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;/*
 * ä»å†…å­˜æ± ä¸­ç”³è¯·ä¸€å—å†…å­˜ ï¼ˆå°å—å†…å­˜æ— éœ€å…ˆå¯¹é½ï¼‰
 */
void *
ngx_pnalloc(ngx_pool_t *pool, size_t size)
{
#if !(NGX_DEBUG_PALLOC)
    if (size &amp;lt;= pool-&amp;gt;max) {
        return ngx_palloc_small(pool, size, 0); //å°å—å†…å­˜ï¼ˆæ— éœ€å…ˆå¯¹é½ï¼‰
    }
#endif

    return ngx_palloc_large(pool, size);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ä»å†…å­˜æ± ç”³è¯·å†…å­˜å°å—å†…å­˜&#34;&gt;ä»å†…å­˜æ± ç”³è¯·å†…å­˜å°å—å†…å­˜&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;/*
 * åˆ†é…å°å—å†…å­˜
 * 1. å¾ªç¯éå†å†…å­˜å—ngx_pool_data_té“¾è¡¨
 * 2. å¦‚æœå½“å‰å†…å­˜å—å‰©ä½™å¤§å°æ»¡è¶³ç”³è¯·çš„å†…å­˜å¤§å°ï¼Œåˆ™ç§»åŠ¨ç›¸åº”æŒ‡é’ˆï¼Œè¿”å›åˆ†é…çš„å†…å­˜æŒ‡é’ˆ
 * 3. å¦åˆ™ï¼Œç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå†…å­˜å—
 * 4. å¦‚æœæ‰€æœ‰å†…å­˜å—éƒ½æ²¡èƒ½æ»¡è¶³ç”³è¯·çš„å†…å­˜å¤§å°ï¼Œåˆ™é‡æ–°ç”³è¯·ä¸€å—å†…å­˜å—æŒ‚è½½åˆ°é“¾è¡¨ä¸Šï¼Œå¹¶è¿”å›åˆ†é…çš„å†…å­˜åœ°å€
 */
static ngx_inline void *
ngx_palloc_small(ngx_pool_t *pool, size_t size, ngx_uint_t align)
{
    u_char      *m;
    ngx_pool_t  *p;

    p = pool-&amp;gt;current;

    do {
        m = p-&amp;gt;d.last; //æœ€åä½¿ç”¨ä½ç½®

        if (align) {
            m = ngx_align_ptr(m, NGX_ALIGNMENT); //å…ˆå†…å­˜å¯¹é½, å‡å°‘CPUè¯»å–å†…å­˜æ¬¡æ•°
        }

        if ((size_t) (p-&amp;gt;d.end - m) &amp;gt;= size) { //å½“å‰å†…å­˜å—å‰©ä½™ç©ºé—´è¶³å¤Ÿ
            p-&amp;gt;d.last = m + size; //æœ€åä½¿ç”¨ä½ç½®æ›´æ–°ï¼Œå‰©ä½™ç©ºé—´å˜å°

            return m;
        }

        p = p-&amp;gt;d.next;

    } while (p);

    //ç°æœ‰å°å—å†…å­˜å‡æ— æ³•åˆ†é…ï¼Œåˆ™æ–°å»ºå†…å­˜å—åå†åˆ†é…
    return ngx_palloc_block(pool, size);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ–°å»ºå°å†…å­˜å—å†åˆ†é…&#34;&gt;æ–°å»ºå°å†…å­˜å—å†åˆ†é…&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;/*
 * å†æ¬¡ç”³è¯·å°å—å†…å­˜ï¼Œå¹¶æŒ‚è½½åˆ°å°å—å†…å­˜é“¾è¡¨ä¸Šï¼Œå¹¶è¿”å›å½“æ¬¡ç”³è¯·çš„å†…å­˜æŒ‡é’ˆ
*/
static void *
ngx_palloc_block(ngx_pool_t *pool, size_t size)
{
    u_char      *m;
    size_t       psize;
    ngx_pool_t  *p, *new;

    psize = (size_t) (pool-&amp;gt;d.end - (u_char *) pool);

    m = ngx_memalign(NGX_POOL_ALIGNMENT, psize, pool-&amp;gt;log);
    if (m == NULL) {
        return NULL;
    }

    new = (ngx_pool_t *) m;

    new-&amp;gt;d.end = m + psize;
    new-&amp;gt;d.next = NULL;
    new-&amp;gt;d.failed = 0;

    m += sizeof(ngx_pool_data_t);
    m = ngx_align_ptr(m, NGX_ALIGNMENT);
    new-&amp;gt;d.last = m + size;

    for (p = pool-&amp;gt;current; p-&amp;gt;d.next; p = p-&amp;gt;d.next) {
        //è°ƒæ•´å„ä¸ªå†…å­˜å—åˆ†é…å¤±è´¥æ¬¡æ•°ï¼Œå¦‚æœå¤±è´¥æ¬¡æ•°å¤§äº4ï¼Œåˆ™æ­¤å—å†…å­˜èŠ‚ç‚¹ä¸å†ä½¿ç”¨
        if (p-&amp;gt;d.failed++ &amp;gt; 4) {
            pool-&amp;gt;current = p-&amp;gt;d.next;
        }
    }

    p-&amp;gt;d.next = new;

    return m;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åˆ†é…å¤§å†…å­˜&#34;&gt;åˆ†é…å¤§å†…å­˜&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;/*
 * åˆ†é…å¤§å†…å­˜å—
 */
static void *
ngx_palloc_large(ngx_pool_t *pool, size_t size)
{
    void              *p;
    ngx_uint_t         n;
    ngx_pool_large_t  *large;

    p = ngx_alloc(size, pool-&amp;gt;log); //å‘ç³»ç»Ÿç”³è¯·sizeå¤§å°å †å†…å­˜
    if (p == NULL) {
        return NULL;
    }

    n = 0;

    //æŸ¥æ‰¾ä¸€ä¸ªç©ºçš„largeåŒºï¼Œå¦‚æœæœ‰ï¼Œåˆ™å°†åˆ†é…çš„ç©ºé—´päº¤ç”±å®ƒç®¡ç†ï¼ˆæœ€å¤š3æ¬¡ï¼‰
    for (large = pool-&amp;gt;large; large; large = large-&amp;gt;next) {
        if (large-&amp;gt;alloc == NULL) { //ngx_pfreeå‡½æ•°ä¼šäº§ç”Ÿç©ºçš„largeåŒº
            large-&amp;gt;alloc = p;
            return p;
        }

        if (n++ &amp;gt; 3) { //è¶…è¿‡ä¸€å®šæ¬¡æ•°ï¼Œæ”¾å¼ƒæŸ¥æ‰¾ç©ºçš„largeåŒº
            break;
        }
    }

    //åˆ›å»ºä¸€ä¸ªæ–°çš„largeèŠ‚ç‚¹
    large = ngx_palloc_small(pool, sizeof(ngx_pool_large_t), 1);
    if (large == NULL) {
        ngx_free(p);
        return NULL;
    }

    //æ–°åˆ†é…çš„ç©ºé—´päº¤ç”±æ–°å»ºçš„largeèŠ‚ç‚¹ç®¡ç†ï¼Œå¹¶ä¸”æ’å…¥åˆ°largeé“¾è¡¨å¤´éƒ¨
    large-&amp;gt;alloc = p;
    large-&amp;gt;next = pool-&amp;gt;large;
    pool-&amp;gt;large = large;

    return p;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é”€æ¯å†…å­˜æ± &#34;&gt;é”€æ¯å†…å­˜æ± &lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;/*
 * é”€æ¯å†…å­˜æ± 
 */
void
ngx_destroy_pool(ngx_pool_t *pool)
{
    ngx_pool_t          *p, *n;
    ngx_pool_large_t    *l;
    ngx_pool_cleanup_t  *c;

    for (c = pool-&amp;gt;cleanup; c; c = c-&amp;gt;next) {
        if (c-&amp;gt;handler) {
            ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool-&amp;gt;log, 0,
                           &amp;quot;run cleanup: %p&amp;quot;, c);
            c-&amp;gt;handler(c-&amp;gt;data);
        }
    }

#if (NGX_DEBUG)

    /*
     * we could allocate the pool-&amp;gt;log from this pool
     * so we cannot use this log while free()ing the pool
     */

    for (l = pool-&amp;gt;large; l; l = l-&amp;gt;next) {
        ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool-&amp;gt;log, 0, &amp;quot;free: %p&amp;quot;, l-&amp;gt;alloc);
    }

    for (p = pool, n = pool-&amp;gt;d.next; /* void */; p = n, n = n-&amp;gt;d.next) {
        ngx_log_debug2(NGX_LOG_DEBUG_ALLOC, pool-&amp;gt;log, 0,
                       &amp;quot;free: %p, unused: %uz&amp;quot;, p, p-&amp;gt;d.end - p-&amp;gt;d.last);

        if (n == NULL) {
            break;
        }
    }

#endif

    //é‡Šæ”¾å¤§å†…å­˜å—ï¼ˆé“¾è¡¨ï¼‰
    for (l = pool-&amp;gt;large; l; l = l-&amp;gt;next) {
        if (l-&amp;gt;alloc) {
            ngx_free(l-&amp;gt;alloc);
        }
    }

    //é‡Šæ”¾å°å†…å­˜å— (é“¾è¡¨)
    for (p = pool, n = pool-&amp;gt;d.next; /* void */; p = n, n = n-&amp;gt;d.next) {
        ngx_free(p);

        if (n == NULL) {
            break;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é‡ç½®å†…å­˜æ± &#34;&gt;é‡ç½®å†…å­˜æ± &lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;/*
 * é‡ç½®å†…å­˜æ± 
 * 1. é‡Šæ”¾å¤§å—å†…å­˜
 * 2. é‡ç½®å¯å¼€å§‹åˆ†é…ä½ç½®æŒ‡é’ˆã€åˆ†é…å¤±è´¥æ¬¡æ•°ä¸º0ã€å¯ç”¨å°å†…å­˜å—currentæŒ‡é’ˆæŒ‡å‘é¦–ä¸ªå†…å­˜å—
 */
void
ngx_reset_pool(ngx_pool_t *pool)
{
    ngx_pool_t        *p;
    ngx_pool_large_t  *l;

    for (l = pool-&amp;gt;large; l; l = l-&amp;gt;next) { //éå†å¤§å—å†…å­˜é“¾è¡¨ï¼Œé‡Šæ”¾å†…å­˜
        if (l-&amp;gt;alloc) {
            ngx_free(l-&amp;gt;alloc);
        }
    }

    for (p = pool; p; p = p-&amp;gt;d.next) {
        p-&amp;gt;d.last = (u_char *) p + sizeof(ngx_pool_t); //æ¢å¤è‡³åˆå§‹ä¸ºä½ç½®
        p-&amp;gt;d.failed = 0; //åˆ†é…å¤±è´¥æ¬¡æ•°é‡ç½®ä¸º0
    }

    pool-&amp;gt;current = pool; //currentæŒ‡å‘é¦–ä¸ªå†…å­˜å—
    pool-&amp;gt;chain = NULL;
    pool-&amp;gt;large = NULL;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å›æ”¶å¤§å—å†…å­˜é“¾è¡¨ä¸Šçš„æŸä¸ªèŠ‚ç‚¹å†…å­˜&#34;&gt;å›æ”¶å¤§å—å†…å­˜é“¾è¡¨ä¸Šçš„æŸä¸ªèŠ‚ç‚¹å†…å­˜&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;/*
 * å›æ”¶å¤§å—å†…å­˜é“¾è¡¨ä¸Šçš„æŸä¸ªèŠ‚ç‚¹å†…å­˜
 */
ngx_int_t
ngx_pfree(ngx_pool_t *pool, void *p)
{
    ngx_pool_large_t  *l;

    for (l = pool-&amp;gt;large; l; l = l-&amp;gt;next) {
        if (p == l-&amp;gt;alloc) {
            ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool-&amp;gt;log, 0,
                           &amp;quot;free: %p&amp;quot;, l-&amp;gt;alloc);
            ngx_free(l-&amp;gt;alloc);
            l-&amp;gt;alloc = NULL;

            return NGX_OK;
        }
    }

    return NGX_DECLINED;
}
&lt;/code&gt;&lt;/pre&gt;
">Nginxæºç åˆ†æä¹‹--å†…å­˜æ± </a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://xly0713.github.io/post/gperftools-fen-xi-nginx/"" data-c="
          &lt;h2 id=&#34;å®‰è£…ä¾èµ–&#34;&gt;å®‰è£…ä¾èµ–&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;yum install libunwind-devel graphviz-devel ghostscript automake libtool -y&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¼–è¯‘gpreftools&#34;&gt;ç¼–è¯‘gpreftools&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æºä»£ç ï¼šhttps://github.com/gperftools/gperftools/archive/gperftools-2.7.tar.gz&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘å®‰è£…
&lt;ul&gt;
&lt;li&gt;./autogen.sh&lt;/li&gt;
&lt;li&gt;./configure&lt;/li&gt;
&lt;li&gt;make &amp;amp;&amp;amp; make install&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¯¼å‡ºLD_LIBRARY_PATH
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;export LD_LIBRARY_PATH=&amp;quot;$LD_LIBRARY_PATH:/usr/local/lib&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;nginxä½¿ç”¨tcmallocå’Œå¯ç”¨google_perftools_moduleæ¨¡å—&#34;&gt;nginxä½¿ç”¨tcmallocå’Œå¯ç”¨google_perftools_moduleæ¨¡å—&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--with-ld-opt=-ltcmalloc --with-google_perftools_module&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
">gperftoolsåˆ†æNginx</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://xly0713.github.io/post/tcp-xie-yi/"" data-c="
          &lt;p&gt;æœ¬æ–‡æ˜¯å¯¹tcpåè®®åŸºç¡€çŸ¥è¯†çš„æ•´ç†ä»‹ç»ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;tcpå»ºè¿-æ–­è¿&#34;&gt;tcpå»ºè¿ã€æ–­è¿&lt;/h2&gt;
&lt;h3 id=&#34;ç¤ºæ„å›¾&#34;&gt;ç¤ºæ„å›¾&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://xly0713.github.io/post-images/1586241639078.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é˜²æ­¢å¤±æ•ˆçš„è¿æ¥è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ã€‚&lt;/li&gt;
&lt;li&gt;å…·ä½“æè¿°ï¼šå¦‚æœclientå‘é€çš„è¿æ¥è¯·æ±‚SYNåŒ…åœ¨ç½‘ç»œä¸­æ»ç•™äº†è¾ƒé•¿æ—¶é—´ï¼Œserveræœ€ç»ˆä»ä¼šæ”¶åˆ°å¹¶å‘å›è¿æ¥ç¡®è®¤SYN+ACKã€‚è€Œclientç­‰å¾…ä¸€ä¸ªè¶…æ—¶æ—¶é—´åï¼Œè®¤ä¸ºåˆšæ‰æ»ç•™çš„è¿æ¥è¯·æ±‚åŒ…ä¸¢å¤±äº†ï¼Œåˆ™ä¼šé‡æ–°å‘é€SYNåŒ…å‘èµ·è¿æ¥è¯·æ±‚ã€‚å¦‚æœä¸è¿›è¡Œç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆserveræ”¶åˆ°æ»ç•™çš„SYNåŒ…å°±æ‰“å¼€çš„è¿æ¥æ˜¯æ— æ•ˆçš„ï¼›å¦‚æœæœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆclientä¼šå¿½ç•¥serverå¯¹æ»ç•™çš„SYNåŒ…çš„å“åº”SYN+ACKï¼Œä¸å›å¤ACKåŒ…ï¼Œserveræ”¶ä¸åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹ACKåŒ…å°±ä¸ä¼šæ–°å»ºè¿æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;tcpé¢å‘è¿æ¥ä»€ä¹ˆå«ä¹‰&#34;&gt;tcpé¢å‘è¿æ¥ä»€ä¹ˆå«ä¹‰ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†åœ¨clientå’Œserveré—´ç»´æŠ¤è¿æ¥ï¼Œéœ€å»ºç«‹ä¸€å®šçš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤åŒæ–¹çš„äº¤äº’çŠ¶æ€ï¼Œç”¨è¿™æ ·çš„æ•°æ®ç»“æ„æ¥ä¿è¯é¢å‘è¿æ¥çš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸€ç«¯å‘é€FINåŒ…è¯·æ±‚é‡Šæ”¾è¿æ¥ï¼Œå¯¹ç«¯æ”¶åˆ°è¿™ä¸ªFINæŠ¥æ–‡åè¿›å…¥äº†&lt;code&gt;CLOSE_WAIT&lt;/code&gt;çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œä»ç„¶å¯ä»¥å‘å¯¹æ–¹å‘é€æœªå‘é€å®Œæ¯•çš„æ•°æ®ï¼Œæ•°æ®å‘é€å®Œæ¯•åä¹Ÿè¦å‘å¯¹ç«¯å‘é€FINæŠ¥æ–‡é‡Šæ”¾è¿æ¥ï¼Œå¿˜äº†å‘FINåŒ…(è°ƒç”¨close())ä¼šå¯¼è‡´bugã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒTCPæ˜¯å…¨åŒå·¥ä¼ è¾“ï¼Œä¸¤ç«¯éƒ½å¿…é¡»å‘é€FINåŒ…ï¼Œæ‰èƒ½å®Œå…¨æ–­å¼€è¿æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;time_waitçŠ¶æ€&#34;&gt;TIME_WAITçŠ¶æ€&lt;/h3&gt;
&lt;p&gt;ä¸»åŠ¨å‘é€FINåŒ…çš„ä¸€ç«¯ï¼Œåœ¨æ”¶åˆ°å¯¹ç«¯çš„FINæŠ¥æ–‡åè¿›å…¥&lt;code&gt;TIME_WAIT&lt;/code&gt;çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¸€èˆ¬è¦ä¿æŒä¸€ä¸ªè¾ƒé•¿çš„æ—¶é—´2MSLã€‚åŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿æœ€åä¸€ä¸ªåº”ç­”FINçš„æŠ¥æ–‡ACKèƒ½å¤Ÿåˆ°è¾¾ã€‚å› ä¸ºå¦‚æœå¯¹ç«¯æ²¡æœ‰æ”¶åˆ°ACKåº”ç­”ï¼Œåˆ™ä¼šé‡å‘FINåŒ…ã€‚&lt;/li&gt;
&lt;li&gt;è®©å½“å‰è¿æ¥åœ¨ç½‘ç»œä¸­å¯èƒ½çš„æ‰€æœ‰æŠ¥æ–‡è¾¾åˆ°ç”Ÿå­˜æœŸä¸Šé™åæ¶ˆå¤±ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸ä¼šæ”¶åˆ°æ—§çš„è¿æ¥çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸‰æ¬¡æ¡æ‰‹å†…æ ¸å®ç°åŸç†ç¤ºæ„å›¾&#34;&gt;ä¸‰æ¬¡æ¡æ‰‹å†…æ ¸å®ç°åŸç†ç¤ºæ„å›¾&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://xly0713.github.io/post-images/1586239797212.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;é˜Ÿåˆ—é•¿åº¦é…ç½®&#34;&gt;é˜Ÿåˆ—é•¿åº¦é…ç½®&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;SYNé˜Ÿåˆ—é•¿åº¦é…ç½®: &lt;code&gt;net.ipv4.tcp_max_syn_backlog = 8192 #SYN_RCVDçŠ¶æ€è¿æ¥çš„æœ€å¤§ä¸ªæ•°&lt;/code&gt;;&lt;/li&gt;
&lt;li&gt;ACCEPTé˜Ÿåˆ—é•¿åº¦ï¼š
&lt;ul&gt;
&lt;li&gt;ç³»ç»Ÿå…¨å±€ï¼š &lt;code&gt;net.core.somaxconn = 262144 #ç³»ç»Ÿå…¨å±€ACCPETé˜Ÿåˆ—æœ€å¤§é•¿åº¦çš„é…ç½®&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åº”ç”¨å±‚: socket API listenä¼ å‚æ§åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;synæ”»å‡»&#34;&gt;SYNæ”»å‡»&lt;/h3&gt;
&lt;p&gt;æ”»å‡»è€…è¿…é€Ÿä¼ªé€ ä¸åŒIPåœ°å€çš„SYNæŠ¥æ–‡ï¼Œå¿«é€Ÿå æ»¡SYNé˜Ÿåˆ—ï¼Œä½¿å¾—æ­£å¸¸çš„SYNåŒ…æ— æ³•åŠ å…¥é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åº”å¯¹synæ”»å‡»çš„å‚æ•°&#34;&gt;åº”å¯¹SYNæ”»å‡»çš„å‚æ•°&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;net.core.netdev_max_backlog = 262144 #æ¥æ”¶è‡ªç½‘å¡ã€ä½†æ˜¯æœªè¢«å†…æ ¸åè®®æ ˆå¤„ç†çš„IPæŠ¥æ–‡é˜Ÿåˆ—é•¿åº¦&lt;/code&gt;&lt;br&gt;
&lt;code&gt;net.ipv4.tcp_max_syn_backlog = 8192 #SYN_RCVDçŠ¶æ€(åŠ)è¿æ¥çš„æœ€å¤§ä¸ªæ•°&lt;/code&gt;&lt;br&gt;
&lt;code&gt;net.ipv4.tcp_abort_on_overflow = 1 #è®¾ç½®ä¸º1æ—¶è¡¨ç¤º: é˜Ÿåˆ—æ»¡åˆ™å“åº”RSTåŒ…ï¼Œä¸¢å¼ƒè¿æ¥&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;tcp_syncookies&#34;&gt;tcp_syncookies&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;net.ipv4.tcp_syncookies = 1 #å¯ç”¨tcp cookie, ä½¿å¾—SYNé˜Ÿåˆ—æ»¡ä»èƒ½å»ºç«‹è¿æ¥&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ§åˆ¶tcpä¸‰æ¬¡æ¡æ‰‹çš„å‚æ•°&#34;&gt;æ§åˆ¶TCPä¸‰æ¬¡æ¡æ‰‹çš„å‚æ•°&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;SYN_SENTçŠ¶æ€&lt;br&gt;
&lt;code&gt;net.ip4.tcp_syn_retries = 6 #ä¸»åŠ¨å»ºç«‹è¿æ¥ï¼Œå‘é€SYNçš„é‡è¯•æ¬¡æ•°&lt;/code&gt;&lt;br&gt;
&lt;code&gt;net.ipv4.ip_local_port_range = 32768 60999 #å»ºç«‹è¿æ¥æ—¶çš„æœ¬åœ°ç«¯å£å¯é€‰èŒƒå›´&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SYN_RCVDçŠ¶æ€&lt;br&gt;
&lt;code&gt;net.ipv4.tcp_max_syn_backlog = 8192 #SYN_RCVDçŠ¶æ€(åŠ)è¿æ¥çš„æœ€å¤§ä¸ªæ•°&lt;/code&gt;&lt;br&gt;
&lt;code&gt;net.ipv4.tcp_synack_retries = 3 #è¢«åŠ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå‘é€SYN/ACKçš„é‡è¯•æ¬¡æ•°&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;tfotcp-fast-open&#34;&gt;TFO(TCP Fast Open)&lt;/h2&gt;
&lt;p&gt;é…ç½®: &lt;code&gt;net.ipv4.tcp_fastopen&lt;/code&gt;ã€‚ï¼ˆ&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå†…æ ¸ç‰ˆæœ¬è¦æ±‚åœ¨Linux 3.7ä»¥ä¸Šï¼‰&lt;br&gt;
å¯é€‰å€¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0: å…³é—­(é»˜è®¤)&lt;/li&gt;
&lt;li&gt;1: ä½œä¸ºå®¢æˆ·ç«¯æ—¶å¯ä»¥ä½¿ç”¨TFO&lt;/li&gt;
&lt;li&gt;2: ä½œä¸ºæœåŠ¡ç«¯æ—¶å¯ä»¥ä½¿ç”¨TFO&lt;/li&gt;
&lt;li&gt;3: éƒ½å¯ä»¥ä½¿ç”¨TFOï¼Œæ— è®ºæ˜¯ä½œä¸ºæœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¤ºæ„å›¾-2&#34;&gt;ç¤ºæ„å›¾&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://xly0713.github.io/post-images/1586580242109.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">TCPåè®®åŸºç¡€</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://xly0713.github.io/post/dns/"" data-c="
          &lt;p&gt;æœ¬æ–‡æ˜¯å¯¹DNSåè®®çš„ç®€å•æ•´ç†ä»‹ç»ã€‚&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;dnsæ˜¯ä»€ä¹ˆ&#34;&gt;DNSæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;DNSæ˜¯äº’è”ç½‘ä¸–ç•Œçš„åœ°å€è–„ï¼Œç±»ä¼¼äºç”µè¯æœ¬ï¼Œä¸»è¦æä¾›å°†åŸŸåæ˜ å°„åˆ°IPåœ°å€çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;dnsçš„æ ‘çŠ¶å±‚æ¬¡ç»“æ„&#34;&gt;DNSçš„æ ‘çŠ¶å±‚æ¬¡ç»“æ„&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€å±‚: æ ¹DNSæœåŠ¡å™¨ï¼Œè´Ÿè´£è¿”å›é¡¶çº§DNS(TLD)æœåŠ¡å™¨çš„IPåœ°å€ã€‚ç›®å‰å…¨ä¸–ç•Œæœ‰13å°æœåŠ¡èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒå±‚: TLDæœåŠ¡å™¨ï¼Œè´Ÿè´£è¿”å›æƒå¨DNSæœåŠ¡å™¨çš„IPåœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰å±‚: æƒå¨DNSæœåŠ¡å™¨ï¼Œè´Ÿè´£è¿”å›ç›¸åº”ä¸»æœºæˆ–åŸŸåçš„IPåœ°å€ã€‚&lt;br&gt;
&lt;img src=&#34;https://xly0713.github.io/post-images/1586003718190.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;dnsçš„è§£ææµç¨‹&#34;&gt;DNSçš„è§£ææµç¨‹&lt;/h2&gt;
&lt;p&gt;åœ¨æœªå‘½ä¸­ç¼“å­˜çš„æƒ…å†µä¸‹ï¼ŒDNSå®ŒæˆåŸŸåçš„è§£æéœ€è¦ç»è¿‡å¦‚ä¸‹æ­¥éª¤:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥â€œexample.comâ€, æŸ¥è¯¢ç”±æœ¬åœ°DNSæœåŠ¡(&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;)è§£æå™¨æ¥æ”¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;æŸ¥è¯¢&lt;strong&gt;æ ¹DNSåŸŸåæœåŠ¡å™¨&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ ¹DNSæœåŠ¡å™¨&lt;/strong&gt;ä½¿ç”¨&lt;strong&gt;é¡¶çº§DNS(TLD)æœåŠ¡å™¨&lt;/strong&gt;(ä¾‹å¦‚.comæˆ–.net)çš„åœ°å€å“åº”ç»™&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;ã€‚å¦‚ï¼šâ€œexample.comâ€ï¼Œåˆ™è¿”å›.com TLDçš„IPåœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;å‘.com&lt;strong&gt;é¡¶çº§DNS(TLD)æœåŠ¡å™¨&lt;/strong&gt;å‘å‡ºè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¡¶çº§DNS(TLD)æœåŠ¡å™¨&lt;/strong&gt;å“åº”&lt;strong&gt;æƒå¨DNSæœåŠ¡å™¨&lt;/strong&gt;çš„IPåœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;å‘&lt;strong&gt;æƒå¨DNSæœåŠ¡å™¨&lt;/strong&gt;ç¿»å‡ºè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒå¨DNSæœåŠ¡å™¨&lt;/strong&gt;å“åº”example.comçš„IPåœ°å€ç»™&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€’å½’DNSæœåŠ¡å™¨&lt;/strong&gt;å°†example.comçš„IPåœ°å€å“åº”ç»™æµè§ˆå™¨ã€‚ï¼ˆ&lt;em&gt;DNSè§£æå®Œæˆ&lt;/em&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;æµè§ˆå™¨å‘example.comçš„IPåœ°å€å‘å‡ºHTTPè¯·æ±‚...&lt;br&gt;
&lt;img src=&#34;https://xly0713.github.io/post-images/1586005095657.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;dnsç¼“å­˜&#34;&gt;DNSç¼“å­˜&lt;/h2&gt;
&lt;p&gt;åœ¨æœªå‘½ä¸­ç¼“å­˜çš„æƒ…å½¢ä¸‹ï¼ŒDNSè§£æçš„æµç¨‹æ˜¯å¤æ‚ä¸”è€—æ—¶çš„ã€‚DNSæ•°æ®å¯ä»¥è¢«ç¼“å­˜åœ¨å¤šä¸ªä½ç½®ï¼Œæ¯ä¸ªä½ç½®å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…(è®°å½•ç”Ÿå­˜æ—¶é—´TTL)ç¼“å­˜DNSæ•°æ®è®°å½•:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµè§ˆå™¨DNSç¼“å­˜&lt;/li&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿçº§DNSç¼“å­˜&lt;/li&gt;
&lt;li&gt;é€’å½’DNSæœåŠ¡å™¨çº§åˆ«ç¼“å­˜ã€‚&lt;em&gt;å¦‚æœåŸŸåç¼“å­˜æœªå‘½ä¸­ï¼Œä½†æ˜¯å‘½ä¸­äº†è¯¥åŸŸåçš„NSè®°å½•ï¼Œåˆ™è·³è¿‡è¯·æ±‚æ ¹å’ŒTLDæœåŠ¡å™¨ï¼›å¦‚æœæ²¡æœ‰NSè®°å½•ï¼Œä½†æ˜¯å‘½ä¸­äº†TLDçš„è®°å½•ï¼Œåˆ™è·³è¿‡è¯·æ±‚æ ¹æœåŠ¡å™¨ï¼›å¦‚æœæ²¡æœ‰å‘½ä¸­TLDçš„è®°å½•ï¼Œåˆ™è¦å®Œæ•´èµ°å®Œè¿­ä»£è®¿é—®æ ¹DNSæœåŠ¡å™¨åˆ°æƒå¨æœåŠ¡å™¨è¿™ä¸€å…¨æµç¨‹äº†ã€‚&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;dnsè®°å½•ç±»å‹&#34;&gt;DNSè®°å½•ç±»å‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¸¸è§ç±»å‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;Aè®°å½•: åŸŸåæ˜ å°„çš„IPv4åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;CNAMEè®°å½•ï¼šåŸŸååˆ«åæ˜ å°„ï¼Œå°†åŸŸåæŒ‡å‘å¦å¤–ä¸€ä¸ªåŸŸåã€‚&lt;/li&gt;
&lt;li&gt;NSè®°å½•ï¼šåŸŸåæ˜ å°„çš„æƒå¨æœåŠ¡å™¨è®°å½•ã€‚&lt;/li&gt;
&lt;li&gt;AAAAè®°å½•ï¼šåŸŸåæ˜ å°„çš„IPv6åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;MXè®°å½•ï¼šåŸŸåæ˜ å°„çš„é‚®ç®±æœåŠ¡å™¨åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;TXTè®°å½•ï¼šå…è®¸ç®¡ç†å‘˜åœ¨è®°å½•ä¸­å­˜å‚¨æ–‡æœ¬ã€‚&lt;/li&gt;
&lt;li&gt;SOAè®°å½•ï¼šå­˜å‚¨æœ‰å…³åŸŸçš„ç®¡ç†å‘˜ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;SRVè®°å½•ï¼šæŒ‡å®šç‰¹å®šæœåŠ¡çš„ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;PTRè®°å½•ï¼šåœ¨åå‘æŸ¥è¯¢ä¸­æä¾›åŸŸåã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;dnsåè®®æŠ¥æ–‡æ ¼å¼&#34;&gt;DNSåè®®æŠ¥æ–‡æ ¼å¼&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;https://jocent.me/2017/06/18/dns-protocol-principle.html&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;èƒ¶æ°´è®°å½•glue-record&#34;&gt;èƒ¶æ°´è®°å½•(Glue record)&lt;/h2&gt;
&lt;p&gt;å½“ç»™&lt;strong&gt;åŸŸåA&lt;/strong&gt;é…ç½®NSè®°å½•æ—¶ï¼Œå¦‚æœNSè®°å½•ä¸º&lt;strong&gt;åŸŸåA&lt;/strong&gt;çš„å­åŸŸåï¼Œåˆ™å¿…é¡»é…ç½®NSè®°å½•çš„Aè®°å½•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šå¸¸éœ€è¦åœ¨åŸŸåæä¾›å•†å“ªé‡Œç”³è¯·ä¸¤ä¸ªåŸŸåï¼Œè€Œä¸å»ºè®®é‡‡ç”¨èƒ¶æ°´è®°å½•æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;å‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/7d69ec2976c7&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;dnsä¼˜ç§€çš„goå¼€æºé¡¹ç›®&#34;&gt;DNSä¼˜ç§€çš„goå¼€æºé¡¹ç›®&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;https://github.com/miekg/dns&lt;/li&gt;
&lt;li&gt;https://github.com/abh/geodns ï¼ˆä½¿ç”¨miekg/dnsï¼‰&lt;/li&gt;
&lt;/ul&gt;
">DNSåè®®åŸºç¡€</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://xly0713.github.io/post/about/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å…³äºæœ¬ç«™&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/h2&gt;
&lt;p&gt;æœ¬ç«™ä¸»è¦ç”¨æ¥è®°å½•ä¸€äº›æŠ€æœ¯ï¼Œå¸®åŠ©è‡ªå·±æ•´ç†é›¶ç¢çš„çŸ¥è¯†ï¼Œå¸Œæœ›å¯¹ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚æ¬¢è¿&lt;a href=&#34;/atom.xml&#34;&gt;RSS&lt;/a&gt;è®¢é˜…æœ¬ç«™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åšä¸»æ˜¯è°&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/h2&gt;
&lt;p&gt;åšä¸»æ˜¯ä¸€ååå°ç ”å‘æ”»åŸç‹®ï¼Œå…³æ³¨äº‘è®¡ç®—ç›¸å…³é¢†åŸŸï¼Œç›®å‰ä¸“æ³¨äºCDNæŠ€æœ¯å’Œç›´æ’­æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è”ç³»æˆ‘å‘€&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é‚®ä»¶: xly880713@gmail.com&lt;/li&gt;
&lt;/ul&gt;
">å…³äº</a>
      </div>
      
    </div>
  </div>
</div>
<script>
  // var escape = "[{&#34;content&#34;:&#34;&lt;p&gt;å½“å‰Linuxç³»ç»Ÿä¸‹ï¼ŒNginxä¼šé»˜è®¤ä½¿ç”¨epollä½œä¸ºäº‹ä»¶é©±åŠ¨æœºåˆ¶ã€‚æœ¬æ–‡å¯¹epollåšä¸ªç®€å•ä»‹ç»ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;äº‹ä»¶é©±åŠ¨\&#34;&gt;äº‹ä»¶é©±åŠ¨&lt;/h2&gt;\n&lt;p&gt;äº‹ä»¶é©±åŠ¨åˆç§°ä½œIOå¤šè·¯å¤ç”¨ï¼Œepollæ˜¯Linuxå†…æ ¸å®ç°ä¸€ç§IOå¤šè·¯å¤ç”¨æœºåˆ¶&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;IOï¼š åœ¨Linuxç³»ç»Ÿä¸‹ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ã€‚æ–‡ä»¶å¯è¯»/å¯å†™å³ç§°ä½œIOï¼Œæ¯”å¦‚ï¼šæ™®é€šæ–‡ä»¶ã€socketå¥—æ¥å­—ã€è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„ç®¡é“pipeï¼Œéƒ½æ˜¯å¯ä»¥IOçš„å¯¹è±¡ã€‚Linuxç³»ç»Ÿç»Ÿä¸€ç”¨æ–‡ä»¶æè¿°ç¬¦fdè¡¨ç¤ºã€‚&lt;/li&gt;\n&lt;li&gt;äº‹ä»¶ï¼š\n&lt;ul&gt;\n&lt;li&gt;å¯è¯»äº‹ä»¶ï¼šå½“fdå…³è”çš„å†…æ ¸è¯»ç¼“å†²åŒºå¯è¯»æ—¶ï¼Œåˆ™è§¦å‘å¯è¯»äº‹ä»¶ ï¼ˆå¯å†™ï¼šå†…æ ¸ç¼“å†²åŒºéç©ºï¼‰&lt;/li&gt;\n&lt;li&gt;å¯å†™äº‹ä»¶ï¼šå½“fdå…³è”çš„å†…ç§‘å†™ç¼“å†²åŒºå¯å†™æ—¶ï¼Œåˆ™è§¦å‘å¯å†™äº‹ä»¶   (å¯è¯»ï¼šå†…æ ¸ç¼“å†²åŒºä¸æ»¡)&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;äº‹ä»¶é€šçŸ¥æ–¹å¼\n&lt;ul&gt;\n&lt;li&gt;ä¸»åŠ¨é€šçŸ¥ï¼šä»…å½“æœ‰fdæœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå†…æ ¸ä¸»åŠ¨é€šçŸ¥ä¸Šå±‚åº”ç”¨æœ‰äº‹ä»¶å‘ç”Ÿçš„fdé›†åˆ&lt;/li&gt;\n&lt;li&gt;è¢«åŠ¨é€šçŸ¥ï¼šä¸Šå±‚åº”ç”¨å‘å†…æ ¸è½®è¯¢æ£€æŸ¥fdé›†åˆä¸­çš„fdæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿ&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;epoll-apiä»‹ç»\&#34;&gt;epoll APIä»‹ç»&lt;/h2&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://xly0713.github.io/post-images/1589288969778.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;epoll_create\&#34;&gt;epoll_create&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;åŸå‹ï¼šint epoll_create(int size)\n&lt;ul&gt;\n&lt;li&gt;åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªepollå®ä¾‹ï¼Œå†…æ ¸ä¼šè¿”å›ä¸€ä¸ªè¡¨ç¤ºepollå®ä¾‹çš„fd&lt;/li&gt;\n&lt;li&gt;å…¥å‚\n&lt;ul&gt;\n&lt;li&gt;size: åŸæœ¬è¡¨ç¤ºæ‰€è¦ç›‘è§†fdçš„æœ€å¤šä¸ªæ•°ã€‚ç°åœ¨Linuxç‰ˆä¸­æ— æ„ä¹‰ï¼Œåªè¦ä¼ å€¼å¤§äº0çš„æ•´æ•°å³å¯&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;è¿”å›å€¼: epollå®ä¾‹çš„fd&lt;/li&gt;\n&lt;li&gt;è¯´æ˜ï¼šè°ƒç”¨è¯¥APIï¼Œå†…æ ¸ä¼šäº§ç”Ÿä¸€ä¸ªepollå®ä¾‹æ•°æ®ç»“æ„ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;epoll_ctl\&#34;&gt;epoll_ctl&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;åŸå‹: int epoll_ctl(int epfdï¼Œ int opï¼Œ int fdï¼Œ struct epoll_event *event)\n&lt;ul&gt;\n&lt;li&gt;åŠŸèƒ½ï¼šæ·»åŠ /åˆ é™¤/ä¿®æ”¹è¦ç›‘å¬çš„äº‹ä»¶&lt;/li&gt;\n&lt;li&gt;å…¥å‚\n&lt;ul&gt;\n&lt;li&gt;epfd: å³epoll_createåˆ›å»ºçš„epollå®ä¾‹æè¿°ç¬¦&lt;/li&gt;\n&lt;li&gt;op: æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹\n&lt;ul&gt;\n&lt;li&gt;EPOLL_CTL_ADD: æ·»åŠ ä¸€ä¸ªéœ€è¦ç›‘è§†çš„fd&lt;/li&gt;\n&lt;li&gt;EPOLL_CTL_DEL: åˆ é™¤ä¸€ä¸ªfd&lt;/li&gt;\n&lt;li&gt;EPOLL_CTL_MOD: ä¿®æ”¹ä¸€ä¸ªfd&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;fd: IOå¯¹è±¡æè¿°ç¬¦&lt;/li&gt;\n&lt;li&gt;eventç»“æ„ä½“&lt;pre&gt;&lt;code&gt;struct epoll_event {\n    __uint32_t events;\n    epoll_data_t data;\n};\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;eventså­—æ®µï¼šæ„Ÿå…´è¶£çš„äº‹ä»¶æè¿°ï¼Œå¯å¤šé€‰\n&lt;ul&gt;\n&lt;li&gt;EPOLLINï¼šfdå¤„äºå¯è¯»çŠ¶æ€&lt;/li&gt;\n&lt;li&gt;EPOLLOUTï¼šfdå¤„äºå¯å†™çŠ¶æ€&lt;/li&gt;\n&lt;li&gt;EPOLLETï¼šé€šçŸ¥æ¨¡å¼ä¸ºè¾¹ç¼˜è§¦å‘æ¨¡å¼ï¼Œç›¸å¯¹äºæ°´å¹³è§¦å‘æ¨¡å¼è€Œè¨€&lt;/li&gt;\n&lt;li&gt;EPOLLONESHOTï¼šç¬¬ä¸€æ¬¡è¿›è¡Œé€šçŸ¥ï¼Œä¹‹åä¸å†æ£€æµ‹&lt;/li&gt;\n&lt;li&gt;EPOLLHUPï¼š æœ¬ç«¯äº§ç”Ÿä¸€ä¸ªæŒ‚æ–­äº‹ä»¶ï¼Œé»˜è®¤æ£€æµ‹äº‹ä»¶&lt;/li&gt;\n&lt;li&gt;EPOLLDHUPï¼šå¯¹ç«¯äº§ç”Ÿä¸€ä¸ªæŒ‚æ–­äº‹ä»¶&lt;/li&gt;\n&lt;li&gt;EPOLLPRIï¼šç”±å¸¦å¤–æ•°æ®è§¦å‘&lt;/li&gt;\n&lt;li&gt;EPOLLERRï¼šäº§ç”Ÿé”™è¯¯æ—¶è§¦å‘ï¼Œé»˜è®¤æ£€æµ‹äº‹ä»¶&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;dataå­—æ®µï¼šæ˜¯ä¸€ä¸ªunionç»“æ„&lt;pre&gt;&lt;code&gt;typedef union epoll_data {\n    void *ptr;\n    int fd;\n    __uint32_t u32;\n    __uint64_t u64;\n};\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;å¦‚æœä¸éœ€è¦é¢å¤–çš„ä¿¡æ¯ï¼Œåªéœ€ç®€å•çš„èµ‹å€¼: &lt;code&gt;epoll_data.fd = fd&lt;/code&gt;&lt;/li&gt;\n&lt;li&gt;å¦‚æœéœ€è¦é¢å¤–ä¿¡æ¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨&lt;code&gt;void *ptr&lt;/code&gt;, è¿™æ ·epoll_waitè¿”å›æ—¶å¯ä»¥ä½¿ç”¨&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;è¿”å›å€¼: å¦‚æœè¿”å›-1è¡¨ç¤ºè°ƒç”¨å¤±è´¥&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;epoll_wait\&#34;&gt;epoll_wait&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;åŸå‹ï¼šint epoll_wait(int epfdï¼Œ struct epoll_event *eventsï¼Œ int maxeventsï¼Œ int timeout)\n&lt;ul&gt;\n&lt;li&gt;åŠŸèƒ½ï¼šé˜»å¡ç­‰å¾…å·²æ³¨å†Œçš„äº‹ä»¶å‘ç”Ÿï¼Œè¿”å›äº‹ä»¶çš„æ•°ç›®ï¼Œå¹¶å°†è§¦å‘çš„äº‹ä»¶å†™å…¥eventsæ•°ç»„ä¸­&lt;/li&gt;\n&lt;li&gt;å…¥å‚ï¼š\n&lt;ul&gt;\n&lt;li&gt;epfd: å³epoll_createåˆ›å»ºçš„epollå®ä¾‹æè¿°ç¬¦&lt;/li&gt;\n&lt;li&gt;eventsï¼šç”¨æ¥è®°å½•è¢«è§¦å‘çš„äº‹ä»¶æ•°ç»„ï¼Œå…¶å¤§å°åº”è¯¥å’Œmaxeventsä¸€è‡´&lt;/li&gt;\n&lt;li&gt;maxevents: è¿”å›çš„eventsçš„æœ€å¤§ä¸ªæ•°&lt;/li&gt;\n&lt;li&gt;timeout: é˜»å¡è¶…æ—¶(ä»¥msä¸ºå•ä½)\n&lt;ul&gt;\n&lt;li&gt;å¦‚æœä¼ å‚-1ï¼Œ åˆ™è°ƒç”¨ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿæˆ–æ•è·å…¶ä»–ä¿¡å·&lt;/li&gt;\n&lt;li&gt;å¦‚æœä¼ å‚0ï¼Œåˆ™éé˜»å¡æ£€æµ‹æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæ— è®ºæœ‰äº‹ä»¶è¿˜æ˜¯æ²¡äº‹ä»¶ï¼Œè°ƒç”¨ç«‹å³è¿”å›&lt;/li&gt;\n&lt;li&gt;å¦‚æœä¼ å‚å¤§äº0ï¼Œ åˆ™æœ€å¤šç­‰å¾…timeoutæ—¶é—´è¿”å›ï¼Œå¦‚æœç­‰å¾…æœŸé—´æœ‰äº‹ä»¶å‘ç”Ÿåˆ™ç«‹å³è¿”å›&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘\&#34;&gt;æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘&lt;/h2&gt;\n&lt;h3 id=\&#34;æ°´å¹³è§¦å‘\&#34;&gt;æ°´å¹³è§¦å‘&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;åªè¦ç¼“å†²åŒºæœ‰æ•°æ®ï¼Œåˆ™è¿”å›å¯è¯»äº‹ä»¶&lt;/li&gt;\n&lt;li&gt;åªè¦ç¼“å†²åŒºè¿˜ä¸æ»¡ï¼Œåˆ™è¿”å›å¯å†™äº‹ä»¶&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;è¾¹ç¼˜è§¦å‘\&#34;&gt;è¾¹ç¼˜è§¦å‘&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;å¯è¯»äº‹ä»¶&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;å½“ç¼“å†²åŒºæ•°æ®ä¸ºç©ºå˜ä¸ºéç©ºæ—¶ï¼Œåˆ™è¿”å›å¯è¯»äº‹ä»¶&lt;/li&gt;\n&lt;li&gt;å½“ç¼“å†²åŒºæ¥æ”¶åˆ°æ–°æ•°æ®æ—¶ï¼Œå³ç¼“å†²åŒºå¾…è¯»æ•°æ®å˜å¤šæ—¶ï¼Œè¿”å›å¯è¯»äº‹ä»¶&lt;/li&gt;\n&lt;li&gt;å½“ç¼“å†²åŒºæœ‰æ•°æ®å¯è¯»ï¼Œä¸”åº”ç”¨è¿›ç¨‹å¯¹ç›¸åº”çš„æè¿°ç¬¦è¿›è¡ŒEPOLL_CTL_MOD ä¿®æ”¹EPOLLINäº‹ä»¶æ—¶ï¼Œè¿”å›å¯è¯»äº‹ä»¶&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;å¯å†™äº‹ä»¶&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;å½“ç¼“å†²åŒºç”±ä¸å¯å†™å˜ä¸ºå¯å†™æ—¶ï¼Œåˆ™è¿”å›å¯å†™äº‹ä»¶&lt;/li&gt;\n&lt;li&gt;å½“æœ‰æ—§æ•°æ®è¢«å‘é€èµ°ï¼Œå³ç¼“å†²åŒºä¸­çš„å†…å®¹å˜å°‘çš„æ—¶å€™ï¼Œè¿”å›å¯å†™äº‹ä»¶&lt;/li&gt;\n&lt;li&gt;å½“ç¼“å†²åŒºæœ‰ç©ºé—´å¯å†™ï¼Œä¸”åº”ç”¨è¿›ç¨‹å¯¹ç›¸åº”çš„æè¿°ç¬¦è¿›è¡ŒEPOLL_CTL_MOD ä¿®æ”¹EPOLLOUTäº‹ä»¶æ—¶ï¼Œè¿”å›å¯å†™äº‹ä»¶&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;ä»£ç ç¤ºä¾‹\&#34;&gt;ä»£ç ç¤ºä¾‹&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;\n#include &amp;lt;unistd.h&amp;gt;\n#include &amp;lt;sys/epoll.h&amp;gt;\n#include &amp;lt;string.h&amp;gt;\n\n#define MAX_EVENTS 5\n#define READ_SIZE 10\n\nint main() {\n    int running = 1, event_count, i;\n    size_t bytes_read;\n    char read_buffer[READ_SIZE + 1];\n    struct epoll_event event, events[MAX_EVENTS];\n\n    int epoll_fd = epoll_create1(0);\n    if (epoll_fd == -1) {\n        fprintf(stderr, &amp;quot;Failed to create epoll fd\\n&amp;quot;);\n        return 1;\n    }\n\n    event.events = EPOLLIN;\n    event.data.fd = 0;\n\n    if (epoll_ctl(epoll_fd, EPOLL_CTL_ADD, 0, &amp;amp;event) == -1) {\n        fprintf(stderr, &amp;quot;Failed to add fd to epoll\\n&amp;quot;);\n        return 1;\n    }\n\n    while (running) {\n        printf(&amp;quot;\\nPolling for input...\\n&amp;quot;);\n        event_count = epoll_wait(epoll_fd, events, MAX_EVENTS, 30000);\n        printf(&amp;quot;%d ready events\\n&amp;quot;, event_count);\n        for (i = 0; i &amp;lt; event_count; i++) {\n            printf(&amp;quot;Reading fd &#39;%d&#39; -- &amp;quot;, events[i].data.fd);\n            bytes_read = read(events[i].data.fd, read_buffer, READ_SIZE);\n            printf(&amp;quot;%zd bytes read.\\n&amp;quot;, bytes_read);\n            read_buffer[bytes_read] = &#39;\\0&#39;;\n            printf(&amp;quot;Read &#39;%s&#39;\\n&amp;quot;, read_buffer);\n\n            if (!strncmp(read_buffer, &amp;quot;stop\\n&amp;quot;, 5)) {\n                running = 0;\n            }\n        }\n    }\n\n    if (close(epoll_fd)) {\n        fprintf(stderr, &amp;quot;Failed to close epoll fd\\n&amp;quot;);\n        return 1;\n    }\n\n    return 0;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;epoll-shi-jian-qu-dong&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;å½“å‰Linuxç³»ç»Ÿä¸‹ï¼ŒNginxä¼šé»˜è®¤ä½¿ç”¨epollä½œä¸ºäº‹ä»¶é©±åŠ¨æœºåˆ¶ã€‚æœ¬æ–‡å¯¹epollåšä¸ªç®€å•ä»‹ç»ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;epolläº‹ä»¶é©±åŠ¨&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;xFfSPpftD&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/xFfSPpftD/&#34;}],&#34;date&#34;:&#34;2020-05-12 20:57:22&#34;,&#34;dateFormat&#34;:&#34;2020-05-12&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://xly0713.github.io/post/epoll-shi-jian-qu-dong/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;6 min read&#34;,&#34;time&#34;:304000,&#34;words&#34;:1257,&#34;minutes&#34;:6},&#34;description&#34;:&#34;å½“å‰Linuxç³»ç»Ÿä¸‹ï¼ŒNginxä¼šé»˜è®¤ä½¿ç”¨epollä½œä¸ºäº‹ä»¶é©±åŠ¨æœºåˆ¶ã€‚æœ¬æ–‡å¯¹epollåšä¸ªç®€å•ä»‹ç»ã€‚\n\näº‹ä»¶é©±åŠ¨\näº‹ä»¶é©±åŠ¨åˆç§°ä½œIOå¤šè·¯å¤ç”¨ï¼Œepollæ˜¯Linuxå†…æ ¸å®ç°ä¸€ç§IOå¤šè·¯å¤ç”¨æœºåˆ¶\n\nIOï¼š åœ¨Linuxç³»ç»Ÿä¸‹ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ã€‚æ–‡ä»¶...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8\&#34;&gt;äº‹ä»¶é©±åŠ¨&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#epoll-api%E4%BB%8B%E7%BB%8D\&#34;&gt;epoll APIä»‹ç»&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#epoll_create\&#34;&gt;epoll_create&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#epoll_ctl\&#34;&gt;epoll_ctl&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#epoll_wait\&#34;&gt;epoll_wait&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B0%B4%E5%B9%B3%E8%A7%A6%E5%8F%91%E5%92%8C%E8%BE%B9%E7%BC%98%E8%A7%A6%E5%8F%91\&#34;&gt;æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B0%B4%E5%B9%B3%E8%A7%A6%E5%8F%91\&#34;&gt;æ°´å¹³è§¦å‘&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%BE%B9%E7%BC%98%E8%A7%A6%E5%8F%91\&#34;&gt;è¾¹ç¼˜è§¦å‘&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B\&#34;&gt;ä»£ç ç¤ºä¾‹&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;Nginxçš„httpåŠŸèƒ½å’Œæ¨¡å—ä½¿ç”¨å¹¿æ³›ï¼Œé‚£ä¹ˆNginxçš„httpæ¡†æ¶æ˜¯å¦‚ä½•åˆå§‹åŒ–çš„å‘¢ï¼Ÿhttpè¯·æ±‚çš„11ä¸ªå¤„ç†é˜¶æ®µåˆæ˜¯æ€ä¹ˆè®¾è®¡çš„å‘¢ï¼Ÿ&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;httpæ¡†æ¶åˆå§‹åŒ–æµç¨‹å›¾\&#34;&gt;httpæ¡†æ¶åˆå§‹åŒ–æµç¨‹å›¾&lt;/h2&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://xly0713.github.io/post-images/1589099904999.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;ç»“åˆæµç¨‹ç®€å›¾å’Œä»£ç æè¿°æ€»ä½“æµç¨‹\&#34;&gt;ç»“åˆæµç¨‹ç®€å›¾å’Œä»£ç æè¿°æ€»ä½“æµç¨‹&lt;/h2&gt;\n&lt;p&gt;å½“é…ç½®æ–‡ä»¶nginx.confé…ç½®äº†http{...}å¹¶è¢«è§£æåˆ°æ—¶ï¼Œhttpæ¡†æ¶é€šè¿‡æ‰§è¡Œngx_http_blockå‡½æ•°å¼€å§‹åˆå§‹åŒ–ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;static char *\nngx_http_block(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)\n{\n    char                        *rv;\n    ngx_uint_t                   mi, m, s;\n    ngx_conf_t                   pcf;\n    ngx_http_module_t           *module;\n    ngx_http_conf_ctx_t         *ctx;\n    ngx_http_core_loc_conf_t    *clcf;\n    ngx_http_core_srv_conf_t   **cscfp;\n    ngx_http_core_main_conf_t   *cmcf;\n\n    if (*(ngx_http_conf_ctx_t **) conf) {\n        return &amp;quot;is duplicate&amp;quot;;\n    }\n\n    /* the main http context */\n\n    ctx = ngx_pcalloc(cf-&amp;gt;pool, sizeof(ngx_http_conf_ctx_t));\n    if (ctx == NULL) {\n        return NGX_CONF_ERROR;\n    }\n\n    *(ngx_http_conf_ctx_t **) conf = ctx;\n\n    /*åˆå§‹åŒ–æ‰€æœ‰HTTPæ¨¡å—çš„ctx_indexåºå·*/\n    ngx_http_max_module = ngx_count_modules(cf-&amp;gt;cycle, NGX_HTTP_MODULE);\n\n    /*åˆ†é…è§£æhttp{}å—ä¸‹mainçº§åˆ«é…ç½®é¡¹æ—¶å­˜æ”¾HTTPæ¨¡å—ç»“æ„ä½“æŒ‡é’ˆçš„3ä¸ªæ•°ç»„main_confã€srv_confã€loc_conf*/\n    ctx-&amp;gt;main_conf = ngx_pcalloc(cf-&amp;gt;pool,\n                                 sizeof(void *) * ngx_http_max_module);\n    if (ctx-&amp;gt;main_conf == NULL) {\n        return NGX_CONF_ERROR;\n    }\n\n    ctx-&amp;gt;srv_conf = ngx_pcalloc(cf-&amp;gt;pool, sizeof(void *) * ngx_http_max_module);\n    if (ctx-&amp;gt;srv_conf == NULL) {\n        return NGX_CONF_ERROR;\n    }\n\n    ctx-&amp;gt;loc_conf = ngx_pcalloc(cf-&amp;gt;pool, sizeof(void *) * ngx_http_max_module);\n    if (ctx-&amp;gt;loc_conf == NULL) {\n        return NGX_CONF_ERROR;\n    }\n\n    /*\n     * å¤„ç†http{}å—å†…çš„mainçº§åˆ«é…ç½®æ—¶ï¼Œå¯¹æ¯ä¸ªHTTPæ¨¡å—ï¼Œéƒ½ä¼šè°ƒç”¨create_(main|srv|loc)_confç­‰3ä¸ªæ–¹æ³•\n     */\n    for (m = 0; cf-&amp;gt;cycle-&amp;gt;modules[m]; m++) {\n        if (cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;type != NGX_HTTP_MODULE) {\n            continue; //è·³è¿‡éhttpæ¨¡å—\n        }\n\n        module = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx;\n        mi = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx_index;\n\n        if (module-&amp;gt;create_main_conf) {\n            ctx-&amp;gt;main_conf[mi] = module-&amp;gt;create_main_conf(cf); //mainçº§åˆ«\n            if (ctx-&amp;gt;main_conf[mi] == NULL) {\n                return NGX_CONF_ERROR;\n            }\n        }\n\n        if (module-&amp;gt;create_srv_conf) {\n            ctx-&amp;gt;srv_conf[mi] = module-&amp;gt;create_srv_conf(cf); //serverçº§åˆ«\n            if (ctx-&amp;gt;srv_conf[mi] == NULL) {\n                return NGX_CONF_ERROR;\n            }\n        }\n\n        if (module-&amp;gt;create_loc_conf) {\n            ctx-&amp;gt;loc_conf[mi] = module-&amp;gt;create_loc_conf(cf); //locationçº§åˆ«\n            if (ctx-&amp;gt;loc_conf[mi] == NULL) {\n                return NGX_CONF_ERROR;\n            }\n        }\n    }\n\n    pcf = *cf;\n    cf-&amp;gt;ctx = ctx;\n\n    for (m = 0; cf-&amp;gt;cycle-&amp;gt;modules[m]; m++) {\n        if (cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;type != NGX_HTTP_MODULE) {\n            continue;\n        }\n\n        module = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx;\n\n        if (module-&amp;gt;preconfiguration) {\n            if (module-&amp;gt;preconfiguration(cf) != NGX_OK) {\n                return NGX_CONF_ERROR;\n            }\n        }\n    }\n\n    /* è§£æhttp{} mainé…ç½® */\n    cf-&amp;gt;module_type = NGX_HTTP_MODULE;\n    cf-&amp;gt;cmd_type = NGX_HTTP_MAIN_CONF;\n    rv = ngx_conf_parse(cf, NULL); //è§£æå†…éƒ¨é…ç½®\n\n    if (rv != NGX_CONF_OK) {\n        goto failed;\n    }\n\n    cmcf = ctx-&amp;gt;main_conf[ngx_http_core_module.ctx_index];\n    cscfp = cmcf-&amp;gt;servers.elts;\n\n    for (m = 0; cf-&amp;gt;cycle-&amp;gt;modules[m]; m++) {\n        if (cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;type != NGX_HTTP_MODULE) {\n            continue;\n        }\n\n        module = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx;\n        mi = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx_index;\n\n        //è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„init_main_confæ–¹æ³•ï¼Œä¿å­˜mainçº§åˆ«é…ç½®\n        if (module-&amp;gt;init_main_conf) {\n            rv = module-&amp;gt;init_main_conf(cf, ctx-&amp;gt;main_conf[mi]);\n            if (rv != NGX_CONF_OK) {\n                goto failed;\n            }\n        }\n\n        //åˆå¹¶ngx_modules[m]æ¨¡å—mainã€srvã€locé…ç½®\n        rv = ngx_http_merge_servers(cf, cmcf, module, mi);\n        if (rv != NGX_CONF_OK) {\n            goto failed;\n        }\n    }\n\n    /* æ„é€ locationç»„æˆçš„é™æ€äºŒå‰å¹³è¡¡æŸ¥æ‰¾æ ‘ */\n    for (s = 0; s &amp;lt; cmcf-&amp;gt;servers.nelts; s++) {\n\n        clcf = cscfp[s]-&amp;gt;ctx-&amp;gt;loc_conf[ngx_http_core_module.ctx_index];\n\n        //å°†ngx_http_core_loc_conf_tç»„æˆçš„åŒå‘é“¾è¡¨æŒ‰ç…§locationåŒ¹é…å­—ç¬¦ä¸²è¿›è¡Œæ’åº\n        if (ngx_http_init_locations(cf, cscfp[s], clcf) != NGX_OK) {\n            return NGX_CONF_ERROR;\n        }\n\n        //æ ¹æ®å·²ç»æ’åºè¿‡çš„çš„åŒå‘é“¾è¡¨ï¼Œæ„å»ºé™æ€çš„äºŒå‰æŸ¥æ‰¾æ ‘\n        if (ngx_http_init_static_location_trees(cf, clcf) != NGX_OK) {\n            return NGX_CONF_ERROR;\n        }\n    }\n\n    /* åˆå§‹åŒ–å¯æ·»åŠ å¤„ç†æ–¹æ³•çš„HTTPé˜¶æ®µçš„åŠ¨æ€æ•°ç»„ */\n    if (ngx_http_init_phases(cf, cmcf) != NGX_OK) {\n        return NGX_CONF_ERROR;\n    }\n\n    if (ngx_http_init_headers_in_hash(cf, cmcf) != NGX_OK) {\n        return NGX_CONF_ERROR;\n    }\n\n    /* è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„postconfigurationæ–¹æ³•ï¼Œä½¿ä¹‹å¯ä»¥ä»‹å…¥HTTPè¯·æ±‚å¤„ç†é˜¶æ®µ */\n    for (m = 0; cf-&amp;gt;cycle-&amp;gt;modules[m]; m++) {\n        if (cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;type != NGX_HTTP_MODULE) {\n            continue;\n        }\n\n        module = cf-&amp;gt;cycle-&amp;gt;modules[m]-&amp;gt;ctx;\n\n        if (module-&amp;gt;postconfiguration) {\n            if (module-&amp;gt;postconfiguration(cf) != NGX_OK) {\n                return NGX_CONF_ERROR;\n            }\n        }\n    }\n\n    if (ngx_http_variables_init_vars(cf) != NGX_OK) {\n        return NGX_CONF_ERROR;\n    }\n\n    /*\n     * http{}&#39;s cf-&amp;gt;ctx was needed while the configuration merging\n     * and in postconfiguration process\n     */\n\n    *cf = pcf;\n\n    //æ ¹æ®å„ä¸ªHTTPæ¨¡å—ä»‹å…¥çš„å¤„ç†æ–¹æ³•æ„é€ å‡ºphase_engine_handlersæ•°ç»„\n    if (ngx_http_init_phase_handlers(cf, cmcf) != NGX_OK) {\n        return NGX_CONF_ERROR;\n    }\n\n\n    //æ„é€ ç›‘å¬ç«¯å£ä¸serveré—´çš„å…³è”å…³ç³»ï¼Œè®¾ç½®æ–°è¿æ¥äº‹ä»¶çš„å›è°ƒæ–¹æ³•\n    if (ngx_http_optimize_servers(cf, cmcf, cmcf-&amp;gt;ports) != NGX_OK) {\n        return NGX_CONF_ERROR;\n    }\n\n    return NGX_CONF_OK;\n\nfailed:\n\n    *cf = pcf;\n\n    return rv;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;åˆå§‹åŒ–æ‰€æœ‰httpæ¨¡å—çš„ctx_indexåºå·\&#34;&gt;åˆå§‹åŒ–æ‰€æœ‰HTTPæ¨¡å—çš„ctx_indexåºå·&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;ctx_indexè¡¨ç¤ºæ¨¡å—åœ¨åŒç±»å‹æ¨¡å—ä¸­çš„ç´¢å¼•ï¼Œæ¯”å¦‚ngx_http_core_moduleæ˜¯HTTPæ¨¡å—ï¼ˆNGX_HTTP_MODULEï¼‰çš„é¦–ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆè¯¥æ¨¡å—çš„ctx_indexä¸º0ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;åˆ†é…è§£æhttpå—ä¸‹mainçº§åˆ«é…ç½®é¡¹æ—¶å­˜æ”¾httpæ¨¡å—ç»“æ„ä½“æŒ‡é’ˆçš„3ä¸ªæ•°ç»„\&#34;&gt;åˆ†é…è§£æhttp{}å—ä¸‹mainçº§åˆ«é…ç½®é¡¹æ—¶å­˜æ”¾HTTPæ¨¡å—ç»“æ„ä½“æŒ‡é’ˆçš„3ä¸ªæ•°ç»„&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;åˆ†é…main_confæ•°ç»„ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨mainçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_main_conf_tç»“æ„ä½“&lt;/li&gt;\n&lt;li&gt;åˆ†é…srv_confæ•°ç»„ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨mainçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_srv_conf_tç»“æ„ä½“&lt;/li&gt;\n&lt;li&gt;åˆ†é…loc_confæ•°ç»„ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨mainçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_loc_conf_tç»“æ„ä½“&lt;/li&gt;\n&lt;li&gt;å¦å¤–ï¼Œå¿…é¡»åŒæ—¶åˆ›å»º3ä¸ªæ•°ç»„ã€‚å› ä¸ºå¯¹äºHTTPæ¨¡å—æ¥è¯´ï¼ŒæŸä¸ªæŒ‡ä»¤æœ‰å¯èƒ½åŒæ—¶å‡ºç°åœ¨mainã€srvã€locçº§åˆ«ã€‚å®é™…åº”ç”¨é…ç½®é¡¹æ—¶ï¼Œå…·ä½“ä»¥é‚£ä¸ªçº§åˆ«çš„é…ç½®é¡¹ä¸ºå‡†ï¼Œéœ€è¦åˆå¹¶å¤„ç†ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;ä¾æ¬¡è°ƒç”¨æ‰€æœ‰httpæ¨¡å—çš„create_mainsrvloc_confå…±3ä¸ªæ–¹æ³•\&#34;&gt;ä¾æ¬¡è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„create_(main|srv|loc)_confå…±3ä¸ªæ–¹æ³•&lt;/h3&gt;\n&lt;p&gt;æ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„è¿™3ä¸ªå›è°ƒæ–¹æ³•ï¼Œå¦‚æœå®ç°ï¼Œåˆ™ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;è°ƒç”¨create_main_confï¼Œåˆ†é…æ¯ä¸ªHTTPæ¨¡å—mainçº§åˆ«çš„xx_main_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼&lt;/li&gt;\n&lt;li&gt;è°ƒç”¨create_srv_confï¼Œåˆ†é…æ¯ä¸ªHTTPæ¨¡å—mainçº§åˆ«çš„xx_srv_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼&lt;/li&gt;\n&lt;li&gt;è°ƒç”¨create_loc_confï¼Œåˆ†é…æ¯ä¸ªHTTPæ¨¡å—mainçº§åˆ«çš„xx_loc_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;è°ƒç”¨æ‰€æœ‰httpæ¨¡å—çš„preconfigurationæ–¹æ³•\&#34;&gt;è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„preconfigurationæ–¹æ³•&lt;/h3&gt;\n&lt;p&gt;æ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„&lt;code&gt;preconfiguration&lt;/code&gt;å›è°ƒæ–¹æ³•ï¼Œå¦‚æœå®ç°ï¼Œåˆ™:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;è°ƒç”¨preconfigurationæ–¹æ³•, ä¸€èˆ¬ç”¨äºæ·»åŠ å˜é‡&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;è§£æhttpå—ä¸‹çš„æ‰€æœ‰mainçº§åˆ«é…ç½®é¡¹\&#34;&gt;è§£æhttp{}å—ä¸‹çš„æ‰€æœ‰mainçº§åˆ«é…ç½®é¡¹&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;äº¤ç”±confæ¨¡å—è§£æhttp{}å—ä¸‹çš„é…ç½®\n&lt;ul&gt;\n&lt;li&gt;ç‰¹åˆ«çš„ï¼Œå¦‚æœå†…éƒ¨ç¢°åˆ°server{}å—æ—¶ï¼Œåˆ™ä¼šåˆ†é…srv_confã€loc_confæ•°ç»„åˆ†åˆ«ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨serverçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_srv_conf_tã€xx_loc_conf_tç»“æ„ä½“ã€‚ç„¶åè°ƒç”¨create_srv_confã€create_loc_confåˆ†é…æ¯ä¸ªHTTPæ¨¡å—åœ¨serverçº§åˆ«çš„xx_(srv|loc)_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼\n&lt;ul&gt;\n&lt;li&gt;ç‰¹åˆ«çš„ï¼Œå¦‚æœå†…éƒ¨ç¢°åˆ°location{}å—æ—¶ï¼Œåˆ™ä¼šåˆ†é…loc_confæ•°ç»„åˆ†åˆ«ç”¨äºä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨locationçº§åˆ«å¯èƒ½åˆ›å»ºçš„xx_loc_conf_tç»“æ„ä½“ã€‚ç„¶åè°ƒç”¨create_loc_confåˆ†é…æ¯ä¸ªHTTPæ¨¡å—åœ¨locationçº§åˆ«çš„xx_loc_conf_tç»“æ„ä½“å†…å­˜ï¼Œå¹¶å¯¹å­—æ®µèµ‹åˆå§‹å€¼&lt;/li&gt;\n&lt;li&gt;location{}ä¸‹çš„é…ç½®è§£æå®Œï¼Œåˆ™å„ä¸ªHTTPæ¨¡å—åœ¨locationçº§åˆ«çš„xxx_loc_conf_tç»“æ„ä½“èµ‹å€¼å®Œæˆ&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;server{}ä¸‹çš„é…ç½®è§£æå®Œï¼Œåˆ™å„ä¸ªHTTPæ¨¡å—åœ¨serverçº§åˆ«çš„xx_(srv|loc)_conf_tç»“æ„ä½“èµ‹å€¼å®Œæˆ&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;è°ƒç”¨æ‰€æœ‰httpæ¨¡å—çš„init_main_confæ–¹æ³•\&#34;&gt;è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„init_main_confæ–¹æ³•&lt;/h3&gt;\n&lt;p&gt;æ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„init_main_confå›è°ƒæ–¹æ³•, å¦‚æœå®ç°ï¼Œåˆ™ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;é…ç½®è§£æå®Œæˆåï¼Œè°ƒç”¨init_main_confæ–¹æ³•ï¼Œæœ€ç»ˆç¡®å®šå¹¶ä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨mainçº§åˆ«çš„xx_main_conf_té…ç½®ç»“æ„ä½“&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;åˆå¹¶main-srv-locçº§åˆ«ä¸‹server-locationç›¸å…³çš„é…ç½®é¡¹\&#34;&gt;åˆå¹¶mainã€srvã€locçº§åˆ«ä¸‹serverã€locationç›¸å…³çš„é…ç½®é¡¹&lt;/h3&gt;\n&lt;p&gt;å¯¹æ¯ä¸€server{}è€Œè¨€ï¼Œæ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„merge_srv_confå’Œmerge_loc_confå›è°ƒæ–¹æ³•, å¦‚æœå®ç°ï¼Œåˆ™ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;è°ƒç”¨merge_srv_confå’Œmerge_loc_confæ–¹æ³•ï¼Œæœ€ç»ˆç¡®å®šå¹¶ä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨serverçº§åˆ«çš„xx_(srv|loc)_conf_té…ç½®ç»“æ„ä½“&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;å¯¹äºæ¯ä¸€ä¸ªlocation{}è€Œè¨€ï¼Œæ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„merge_loc_confå›è°ƒæ–¹æ³•, å¦‚æœå®ç°, åˆ™:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;è°ƒç”¨merge_loc_confæ–¹æ³•ï¼Œæœ€ç»ˆç¡®å®šå¹¶ä¿å­˜å„ä¸ªHTTPæ¨¡å—åœ¨locationçº§åˆ«çš„xx_loc_conf_té…ç½®ç»“æ„ä½“&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;æ„é€ locationç»„æˆçš„é™æ€äºŒå‰å¹³è¡¡æŸ¥æ‰¾æ ‘\&#34;&gt;æ„é€ locationç»„æˆçš„é™æ€äºŒå‰å¹³è¡¡æŸ¥æ‰¾æ ‘&lt;/h3&gt;\n&lt;p&gt;å¯¹äºæ¯ä¸€ä¸ªserverè€Œè¨€ï¼Œ&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;å°†ngx_http_core_loc_conf_tç»„æˆçš„åŒå‘é“¾è¡¨æŒ‰ç…§locationåŒ¹é…å­—ç¬¦ä¸²è¿›è¡Œæ’åº&lt;/li&gt;\n&lt;li&gt;æ ¹æ®å·²ç»æ’åºè¿‡çš„çš„åŒå‘é“¾è¡¨ï¼Œæ„å»ºé™æ€çš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚è¿™æ ·å¤„ç†è¯·æ±‚æ—¶å¯ä»¥åŠ é€Ÿæ‰¾åˆ°location&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;åˆå§‹åŒ–å¯æ·»åŠ å¤„ç†æ–¹æ³•çš„httpé˜¶æ®µçš„åŠ¨æ€æ•°ç»„\&#34;&gt;åˆå§‹åŒ–å¯æ·»åŠ å¤„ç†æ–¹æ³•çš„HTTPé˜¶æ®µçš„åŠ¨æ€æ•°ç»„&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;httpè¯·æ±‚å¤„ç†çš„11ä¸ªé˜¶æ®µï¼Œåˆ†é…æ•°ç»„ï¼Œç”¨äºåç»­æ·»åŠ æ¨¡å—è‡ªå®šä¹‰çš„handleræ–¹æ³•&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;è°ƒç”¨æ‰€æœ‰httpæ¨¡å—çš„postconfigurationæ–¹æ³•ä½¿ä¹‹å¯ä»¥ä»‹å…¥httpé˜¶æ®µ\&#34;&gt;è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„postconfigurationæ–¹æ³•ä½¿ä¹‹å¯ä»¥ä»‹å…¥HTTPé˜¶æ®µ&lt;/h3&gt;\n&lt;p&gt;æ¯ä¸ªHTTPæ¨¡å—å¯ä»¥å®ç°æ¨¡å—ä¸Šä¸‹æ–‡&lt;code&gt;ngx_http_module_t&lt;/code&gt;çš„&lt;code&gt;postconfiguration&lt;/code&gt;æ–¹æ³•ï¼Œå¦‚æœå®ç°ï¼Œåˆ™ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;è°ƒç”¨postconfigurationï¼Œå°†handleræ–¹æ³•æ·»åŠ åˆ°ä¸Šä¸€æ­¥å¸¸è§çš„æŸä¸ªé˜¶æ®µ(å“ªä¸ªé˜¶æ®µç”±æ¨¡å—è‡ªè¡Œå†³å®šï¼Œä½†åªæœ‰7ä¸ªé˜¶æ®µå¯ä»¥ä»‹å…¥)çš„æ•°ç»„ä¸­&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;æ ¹æ®å„ä¸ªhttpæ¨¡å—ä»‹å…¥çš„å¤„ç†æ–¹æ³•æ„é€ å‡ºphase_engine_handlersæ•°ç»„\&#34;&gt;æ ¹æ®å„ä¸ªHTTPæ¨¡å—ä»‹å…¥çš„å¤„ç†æ–¹æ³•æ„é€ å‡ºphase_engine_handlersæ•°ç»„&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;æ ¹æ®å‰ä¸¤æ­¥æ„é€ çš„çš„åŠ¨æ€æ•°ç»„ï¼Œè°ƒç”¨&lt;code&gt;ngx_http_init_phase_handlers&lt;/code&gt;å‡½æ•°æ„é€ å‡ºphase_engine_handlersæ•°ç»„&lt;/li&gt;\n&lt;li&gt;ç‰¹åˆ«çš„ï¼Œæœ‰å››ä¸ªé˜¶æ®µä¸å…è®¸ä»‹å…¥æˆ–è€…ä»‹å…¥æ— æ•ˆï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;code&gt;NGX_HTTP_FIND_CONFIG_PHASE&lt;/code&gt;ã€&lt;br&gt;\n&lt;code&gt;NGX_HTTP_POST_REWRITE_PHASE&lt;/code&gt;ã€&lt;code&gt;NGX_HTTP_POST_ACCESS_PHASE&lt;/code&gt;ã€&lt;br&gt;\n&lt;code&gt;NGX_HTTP_PRECONTENT_PHASE&lt;/code&gt;(æ—§çš„Nginxçš„try_filesé˜¶æ®µ)&lt;/li&gt;\n&lt;li&gt;ç‰¹åˆ«çš„ï¼Œ&lt;code&gt;NGX_HTTP_CONTENT_PHASE&lt;/code&gt;é˜¶æ®µï¼Œé™¤äº†å¸¸è§„çš„postconfigurationä»‹å…¥æ–¹å¼(è¿™ç§æ–¹å¼å½±å“æ‰€æœ‰çš„location)ã€‚å¦å¤–å¯ä»¥ç›´æ¥ä»¥ngx_command_tæŒ‡å®šlocationçš„handleræ–¹å¼ä»‹å…¥ï¼Œåªå¯¹locationæœ‰è¯¥æŒ‡ä»¤çš„locationç”Ÿæ•ˆ&lt;/li&gt;\n&lt;li&gt;ç‰¹åˆ«çš„,  è®°å½•httpæ—¥å¿—ï¼ˆæœ€åä¸€ä¸ªé˜¶æ®µlogï¼‰ç‰¹æ®Šå¤„ç†ï¼Œå¹¶ä¸ä¼šå‡ºç°åœ¨phase_engine_handlersæ•°ç»„ä¸­&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;æ„é€ serverè™šæ‹Ÿä¸»æœºæ„æˆçš„æ”¯æŒé€šé…ç¬¦çš„æ•£åˆ—è¡¨\&#34;&gt;æ„é€ serverè™šæ‹Ÿä¸»æœºæ„æˆçš„æ”¯æŒé€šé…ç¬¦çš„æ•£åˆ—è¡¨&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;ngx_http_server_names&lt;/code&gt;å°†serverè™šæ‹Ÿä¸»æœºå’Œå¯¹åº”çš„ngx_http_core_srv_conf_tç»“æ„ä½“æŒ‡é’ˆå“ˆå¸ŒåŒ–å…³è”èµ·æ¥ï¼Œè¿™æ ·å¤„ç†è¯·æ±‚æ—¶å¯ä»¥å¿«é€ŸåŒ¹é…server&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;æ„é€ ç›‘å¬ç«¯å£ä¸serveré—´çš„å…³è”å…³ç³»å¹¶è®¾ç½®æ–°è¿æ¥äº‹ä»¶çš„å›è°ƒæ–¹æ³•\&#34;&gt;æ„é€ ç›‘å¬ç«¯å£ä¸serveré—´çš„å…³è”å…³ç³»ï¼Œå¹¶è®¾ç½®æ–°è¿æ¥äº‹ä»¶çš„å›è°ƒæ–¹æ³•&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;å°†ç›‘å¬ç«¯å£&lt;code&gt;ngx_http_conf_port_t&lt;/code&gt;å’Œaddråœ°å€&lt;code&gt;ngx_http_conf_addr_t&lt;/code&gt;å…³è”&lt;/li&gt;\n&lt;li&gt;è¿›ä¸€æ­¥ï¼Œå°†&lt;code&gt;ngx_http_conf_addr_t&lt;/code&gt;å’Œserverè™šæ‹Ÿä¸»æœºå…³è”ã€‚è¯¥ç»“æ„ä½“æœ‰3ä¸ªå“ˆå¸Œè¡¨ç»“æ„å­—æ®µï¼Œ&lt;br&gt;\nåˆ†åˆ«ç”¨äºç´¢å¼•å®Œå…¨åŒ¹é…çš„sever_nameã€é€šé…ç¬¦å‰ç½®ã€é€šé…ç¬¦åç½®çš„serverè™šæ‹Ÿä¸»æœºç»“æ„ä½“&lt;code&gt;ngx_http_core_srv_conf_t&lt;/code&gt;ç»“æ„ä½“æŒ‡é’ˆ&lt;/li&gt;\n&lt;li&gt;è®¾ç½®æ–°è¿æ¥äº‹ä»¶çš„å›è°ƒæ–¹æ³•: &lt;code&gt;ngx_http_init_connection&lt;/code&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ\&#34;&gt;httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ&lt;/h2&gt;\n&lt;h3 id=\&#34;æ„é€ phase_engine_handlersæ•°ç»„\&#34;&gt;æ„é€ phase_engine_handlersæ•°ç»„&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;ngx_http_init_phase_handlerså‡½æ•°åœ¨httpåˆå§‹åŒ–æ—¶è°ƒç”¨&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;//æ ¹æ®å„ä¸ªHTTPæ¨¡å—ä»‹å…¥çš„å¤„ç†æ–¹æ³•æ„é€ å‡ºphase_engine_handlersæ•°ç»„\nstatic ngx_int_t\nngx_http_init_phase_handlers(ngx_conf_t *cf, ngx_http_core_main_conf_t *cmcf)\n{\n    ngx_int_t                   j;\n    ngx_uint_t                  i, n;\n    ngx_uint_t                  find_config_index, use_rewrite, use_access;\n    ngx_http_handler_pt        *h;\n    ngx_http_phase_handler_t   *ph;\n    ngx_http_phase_handler_pt   checker;\n\n    cmcf-&amp;gt;phase_engine.server_rewrite_index = (ngx_uint_t) -1;\n    cmcf-&amp;gt;phase_engine.location_rewrite_index = (ngx_uint_t) -1;\n    find_config_index = 0;\n    use_rewrite = cmcf-&amp;gt;phases[NGX_HTTP_REWRITE_PHASE].handlers.nelts ? 1 : 0;\n    use_access = cmcf-&amp;gt;phases[NGX_HTTP_ACCESS_PHASE].handlers.nelts ? 1 : 0;\n\n    n = 1                  /* find config phase */\n        + use_rewrite      /* post rewrite phase */\n        + use_access;      /* post access phase */\n\n    for (i = 0; i &amp;lt; NGX_HTTP_LOG_PHASE; i++) { //æ³¨æ„:ä¸åŒ…å«NGX_HTTP_LOG_PHASEé˜¶æ®µ,è¯¥é˜¶æ®µå¦è¡Œç‰¹æ®Šå¤„ç†\n        n += cmcf-&amp;gt;phases[i].handlers.nelts; //ç´¯åŠ è®¡ç®—æ€»çš„HTTPé˜¶æ®µå¤„ç†æ–¹æ³•ä¸ªæ•°\n    }\n\n    ph = ngx_pcalloc(cf-&amp;gt;pool,\n                     n * sizeof(ngx_http_phase_handler_t) + sizeof(void *));\n    if (ph == NULL) {\n        return NGX_ERROR;\n    }\n\n    cmcf-&amp;gt;phase_engine.handlers = ph;\n    n = 0;\n\n    for (i = 0; i &amp;lt; NGX_HTTP_LOG_PHASE; i++) { //æ³¨æ„: ä¸åŒ…å«NGX_HTTP_LOG_PHASEé˜¶æ®µ\n        h = cmcf-&amp;gt;phases[i].handlers.elts;\n\n        switch (i) {\n\n        case NGX_HTTP_SERVER_REWRITE_PHASE:\n            if (cmcf-&amp;gt;phase_engine.server_rewrite_index == (ngx_uint_t) -1) {\n                cmcf-&amp;gt;phase_engine.server_rewrite_index = n;\n            }\n            checker = ngx_http_core_rewrite_phase;\n\n            break;\n\n        case NGX_HTTP_FIND_CONFIG_PHASE:\n            find_config_index = n;\n\n            ph-&amp;gt;checker = ngx_http_core_find_config_phase;\n            n++;\n            ph++;\n\n            continue;\n\n        case NGX_HTTP_REWRITE_PHASE:\n            if (cmcf-&amp;gt;phase_engine.location_rewrite_index == (ngx_uint_t) -1) {\n                cmcf-&amp;gt;phase_engine.location_rewrite_index = n;\n            }\n            checker = ngx_http_core_rewrite_phase;\n\n            break;\n\n        case NGX_HTTP_POST_REWRITE_PHASE:\n            if (use_rewrite) {\n                ph-&amp;gt;checker = ngx_http_core_post_rewrite_phase;\n                ph-&amp;gt;next = find_config_index;\n                n++;\n                ph++;\n            }\n\n            continue;\n\n        case NGX_HTTP_ACCESS_PHASE:\n            checker = ngx_http_core_access_phase;\n            n++;\n            break;\n\n        case NGX_HTTP_POST_ACCESS_PHASE:\n            if (use_access) {\n                ph-&amp;gt;checker = ngx_http_core_post_access_phase;\n                ph-&amp;gt;next = n;\n                ph++;\n            }\n\n            continue;\n\n        case NGX_HTTP_CONTENT_PHASE:\n            checker = ngx_http_core_content_phase;\n            break;\n\n        default: //NGX_HTTP_POST_READ_PHASEã€NGX_HTTP_PREACCESS_PHASEã€NGX_HTTP_PRECONTENT_PHASE\n            checker = ngx_http_core_generic_phase;\n        }\n\n        n += cmcf-&amp;gt;phases[i].handlers.nelts; //è·³è¿‡æœ¬é˜¶æ®µçš„æ‰€æœ‰handler, ä¹Ÿå³ä¸‹ä¸€é˜¶æ®µçš„é¦–ä¸ªhandler\n\n        //æ³¨æ„:æ¯ä¸ªHTTPå¤„ç†é˜¶æ®µä¸­æœ€ååŠ å…¥åˆ°handlers[]ä¸­çš„ä¼šé¦–å…ˆæ·»åŠ åˆ°cmcf-&amp;gt;phase_engine.handlers\n        for (j = cmcf-&amp;gt;phases[i].handlers.nelts - 1; j &amp;gt;= 0; j--) {\n            ph-&amp;gt;checker = checker;\n            ph-&amp;gt;handler = h[j];\n            ph-&amp;gt;next = n; //ä¸‹ä¸€é˜¶æ®µçš„é¦–ä¸ªhandleråºå·\n            ph++;\n        }\n    }\n\n    return NGX_OK;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;checkeræ–¹æ³•\&#34;&gt;checkeræ–¹æ³•&lt;/h3&gt;\n&lt;h4 id=\&#34;ngx_http_core_generic_phase\&#34;&gt;ngx_http_core_generic_phase&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * NGX_HTTP_(POST_READ | PREACCESS | PRECONTENT)_PHASEç­‰é˜¶æ®µçš„checkeræ–¹æ³•\n */\nngx_int_t\nngx_http_core_generic_phase(ngx_http_request_t *r, ngx_http_phase_handler_t *ph)\n{\n    ngx_int_t  rc;\n\n    /*\n     * generic phase checker,\n     * used by the post read and pre-access phases\n     */\n\n    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,\n                   &amp;quot;generic phase: %ui&amp;quot;, r-&amp;gt;phase_handler);\n\n    //è°ƒç”¨HTTPæ¨¡å—æ·»åŠ çš„handlerå¤„ç†æ–¹æ³•(ç”±å„ä¸ªHTTPæ¨¡å—çš„postconfigurationé’©å­å‡½æ•°æ·»åŠ )\n    rc = ph-&amp;gt;handler(r);\n\n    if (rc == NGX_OK) {\n        r-&amp;gt;phase_handler = ph-&amp;gt;next; //rcä¸ºNGX_OKæ—¶ï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µå°±è¡Œå¤„ç†, å½“å‰é˜¶æ®µå³ä½¿æœ‰å…¶ä»–å¤„ç†æ–¹æ³•ä¹Ÿä¼šè·³è¿‡\n        return NGX_AGAIN;\n    }\n\n    if (rc == NGX_DECLINED) {\n        r-&amp;gt;phase_handler++; //ä¸‹ä¸€ä¸ªå¤„ç†æ–¹æ³•ï¼Œå¯èƒ½ä»æ˜¯å½“å‰é˜¶æ®µï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸‹ä¸€ä¸ªé˜¶æ®µçš„é¦–ä¸ªå¤„ç†æ–¹æ³•\n        return NGX_AGAIN;\n    }\n\n    if (rc == NGX_AGAIN || rc == NGX_DONE) {\n        return NGX_OK; //ä¸æ›´æ”¹r-&amp;gt;phase_handlerçš„å€¼ï¼Œå½“å‰å¤„ç†æ–¹æ³•æœ‰æœºä¼šå†æ¬¡è¢«è°ƒç”¨ã€‚ä½†æ˜¯å¿…é¡»æŠŠæ§åˆ¶æƒäº¤è¿˜eventæ¨¡å—\n    }\n\n    /* rc == NGX_ERROR || rc == NGX_HTTP_...  */\n\n    ngx_http_finalize_request(r, rc); //è¿”å›é”™è¯¯NGX_ERRORæˆ–è€…NGX_HTTP_å¼€å¤´çš„è¿”å›ç ï¼Œåˆ™ç»“æŸè¯·æ±‚\n\n    return NGX_OK;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;ngx_http_core_rewrite_phase\&#34;&gt;ngx_http_core_rewrite_phase&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * NGX_HTTP_(SERVER_REWRITE | REWRITE)_PHASEç­‰é˜¶æ®µçš„checkeræ–¹æ³•\n */\nngx_int_t\nngx_http_core_rewrite_phase(ngx_http_request_t *r, ngx_http_phase_handler_t *ph)\n{\n    ngx_int_t  rc;\n\n    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,\n                   &amp;quot;rewrite phase: %ui&amp;quot;, r-&amp;gt;phase_handler);\n\n    rc = ph-&amp;gt;handler(r); //æ‰§è¡ŒæŒ‚è½½çš„handleræ–¹æ³•\n\n    if (rc == NGX_DECLINED) {\n        r-&amp;gt;phase_handler++; //å½“å‰å¤„ç†æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†æ–¹æ³•\n        return NGX_AGAIN;\n    }\n\n    if (rc == NGX_DONE) {\n        return NGX_OK; //ä¸æ›´æ”¹r-&amp;gt;phase_handlerçš„å€¼ï¼Œå½“å‰å¤„ç†æ–¹æ³•æœ‰æœºä¼šå†æ¬¡è¢«è°ƒç”¨ã€‚ä½†æ˜¯å¿…é¡»æŠŠæ§åˆ¶æƒäº¤è¿˜eventæ¨¡å—\n    }\n\n    /* NGX_OK, NGX_AGAIN, NGX_ERROR, NGX_HTTP_...  */\n\n    ngx_http_finalize_request(r, rc); //ç»“æŸè¯·æ±‚\n\n    return NGX_OK;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;ngx_http_core_find_config_phase\&#34;&gt;ngx_http_core_find_config_phase&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * æ ¹æ®è¯·æ±‚çš„URIå¯»æ‰¾åŒ¹é…çš„locationè¡¨è¾¾å¼ï¼Œä¸å…è®¸ç”¨æˆ·æ¨¡å—ä»‹å…¥ã€‚å³ä½¿ä»‹å…¥ä¹Ÿæ— æ•ˆï¼Œå› ä¸ºå…¥å‚phæœªä½¿ç”¨\n */\nngx_int_t\nngx_http_core_find_config_phase(ngx_http_request_t *r,\n    ngx_http_phase_handler_t *ph)\n{\n    u_char                    *p;\n    size_t                     len;\n    ngx_int_t                  rc;\n    ngx_http_core_loc_conf_t  *clcf;\n\n    r-&amp;gt;content_handler = NULL;\n    r-&amp;gt;uri_changed = 0;\n\n    rc = ngx_http_core_find_location(r);\n\n    if (rc == NGX_ERROR) {\n        ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);\n        return NGX_OK;\n    }\n\n    clcf = ngx_http_get_module_loc_conf(r, ngx_http_core_module);\n\n    if (!r-&amp;gt;internal &amp;amp;&amp;amp; clcf-&amp;gt;internal) {\n        ngx_http_finalize_request(r, NGX_HTTP_NOT_FOUND);\n        return NGX_OK;\n    }\n\n    ngx_log_debug2(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,\n                   &amp;quot;using configuration \\&amp;quot;%s%V\\&amp;quot;&amp;quot;,\n                   (clcf-&amp;gt;noname ? &amp;quot;*&amp;quot; : (clcf-&amp;gt;exact_match ? &amp;quot;=&amp;quot; : &amp;quot;&amp;quot;)),\n                   &amp;amp;clcf-&amp;gt;name);\n\n    ngx_http_update_location_config(r);\n\n    ngx_log_debug2(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,\n                   &amp;quot;http cl:%O max:%O&amp;quot;,\n                   r-&amp;gt;headers_in.content_length_n, clcf-&amp;gt;client_max_body_size);\n\n    if (r-&amp;gt;headers_in.content_length_n != -1\n        &amp;amp;&amp;amp; !r-&amp;gt;discard_body\n        &amp;amp;&amp;amp; clcf-&amp;gt;client_max_body_size\n        &amp;amp;&amp;amp; clcf-&amp;gt;client_max_body_size &amp;lt; r-&amp;gt;headers_in.content_length_n)\n    {\n        ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0,\n                      &amp;quot;client intended to send too large body: %O bytes&amp;quot;,\n                      r-&amp;gt;headers_in.content_length_n);\n\n        r-&amp;gt;expect_tested = 1;\n        (void) ngx_http_discard_request_body(r);\n        ngx_http_finalize_request(r, NGX_HTTP_REQUEST_ENTITY_TOO_LARGE);\n        return NGX_OK;\n    }\n\n    if (rc == NGX_DONE) {\n        ngx_http_clear_location(r);\n\n        r-&amp;gt;headers_out.location = ngx_list_push(&amp;amp;r-&amp;gt;headers_out.headers);\n        if (r-&amp;gt;headers_out.location == NULL) {\n            ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);\n            return NGX_OK;\n        }\n\n        r-&amp;gt;headers_out.location-&amp;gt;hash = 1;\n        ngx_str_set(&amp;amp;r-&amp;gt;headers_out.location-&amp;gt;key, &amp;quot;Location&amp;quot;);\n\n        if (r-&amp;gt;args.len == 0) {\n            r-&amp;gt;headers_out.location-&amp;gt;value = clcf-&amp;gt;name;\n\n        } else {\n            len = clcf-&amp;gt;name.len + 1 + r-&amp;gt;args.len;\n            p = ngx_pnalloc(r-&amp;gt;pool, len);\n\n            if (p == NULL) {\n                ngx_http_clear_location(r);\n                ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);\n                return NGX_OK;\n            }\n\n            r-&amp;gt;headers_out.location-&amp;gt;value.len = len;\n            r-&amp;gt;headers_out.location-&amp;gt;value.data = p;\n\n            p = ngx_cpymem(p, clcf-&amp;gt;name.data, clcf-&amp;gt;name.len);\n            *p++ = &#39;?&#39;;\n            ngx_memcpy(p, r-&amp;gt;args.data, r-&amp;gt;args.len);\n        }\n\n        ngx_http_finalize_request(r, NGX_HTTP_MOVED_PERMANENTLY);\n        return NGX_OK;\n    }\n\n    r-&amp;gt;phase_handler++; //ä¸‹ä¸€é˜¶æ®µ\n    return NGX_AGAIN;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;ngx_http_core_post_rewrite_phase\&#34;&gt;ngx_http_core_post_rewrite_phase&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * NGX_HTTP_POST_REWRITE_PHASEé˜¶æ®µçš„checkeræ–¹æ³•\n */\nngx_int_t\nngx_http_core_post_rewrite_phase(ngx_http_request_t *r,\n    ngx_http_phase_handler_t *ph)\n{\n    ngx_http_core_srv_conf_t  *cscf;\n\n    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,\n                   &amp;quot;post rewrite phase: %ui&amp;quot;, r-&amp;gt;phase_handler);\n\n    if (!r-&amp;gt;uri_changed) {\n        r-&amp;gt;phase_handler++;\n        return NGX_AGAIN;\n    }\n\n    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,\n                   &amp;quot;uri changes: %d&amp;quot;, r-&amp;gt;uri_changes);\n\n    /*\n     * gcc before 3.3 compiles the broken code for\n     *     if (r-&amp;gt;uri_changes-- == 0)\n     * if the r-&amp;gt;uri_changes is defined as\n     *     unsigned  uri_changes:4\n     */\n\n    r-&amp;gt;uri_changes--;\n\n    if (r-&amp;gt;uri_changes == 0) { //urlæ”¹å†™æ¬¡æ•°è¶…é™ï¼Œç»“æŸè¯·æ±‚\n        ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0,\n                      &amp;quot;rewrite or internal redirection cycle &amp;quot;\n                      &amp;quot;while processing \\&amp;quot;%V\\&amp;quot;&amp;quot;, &amp;amp;r-&amp;gt;uri);\n\n        ngx_http_finalize_request(r, NGX_HTTP_INTERNAL_SERVER_ERROR);\n        return NGX_OK;\n    }\n\n    r-&amp;gt;phase_handler = ph-&amp;gt;next;\n\n    cscf = ngx_http_get_module_srv_conf(r, ngx_http_core_module);\n    r-&amp;gt;loc_conf = cscf-&amp;gt;ctx-&amp;gt;loc_conf;\n\n    return NGX_AGAIN;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;ngx_http_core_access_phase\&#34;&gt;ngx_http_core_access_phase&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * NGX_HTTP_ACCESS_PHASEé˜¶æ®µçš„checkeræ–¹æ³•\n */\nngx_int_t\nngx_http_core_access_phase(ngx_http_request_t *r, ngx_http_phase_handler_t *ph)\n{\n    ngx_int_t                  rc;\n    ngx_http_core_loc_conf_t  *clcf;\n\n    if (r != r-&amp;gt;main) { //å­è¯·æ±‚\n        r-&amp;gt;phase_handler = ph-&amp;gt;next; //è·³åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µ\n        return NGX_AGAIN;\n    }\n\n    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,\n                   &amp;quot;access phase: %ui&amp;quot;, r-&amp;gt;phase_handler);\n\n    rc = ph-&amp;gt;handler(r); //æ‰§è¡Œæ¨¡å—æŒ‚è½½çš„handleræ–¹æ³•\n\n    if (rc == NGX_DECLINED) {\n        r-&amp;gt;phase_handler++; //ä¸‹ä¸€ä¸ªå¤„ç†æ–¹æ³•\n        return NGX_AGAIN;\n    }\n\n    if (rc == NGX_AGAIN || rc == NGX_DONE) {\n        return NGX_OK; //ä¸æ›´æ”¹r-&amp;gt;phase_handlerçš„å€¼ï¼Œå½“å‰å¤„ç†æ–¹æ³•æœ‰æœºä¼šå†æ¬¡è¢«è°ƒç”¨ã€‚ä½†æ˜¯å¿…é¡»æŠŠæ§åˆ¶æƒäº¤è¿˜eventæ¨¡å—\n    }\n\n    clcf = ngx_http_get_module_loc_conf(r, ngx_http_core_module);\n\n    if (clcf-&amp;gt;satisfy == NGX_HTTP_SATISFY_ALL) {\n\n        if (rc == NGX_OK) {\n            r-&amp;gt;phase_handler++; //satisfy all, åˆ™æ‰§è¡Œä¸‹ä¸€ä¸ªhandleræ–¹æ³•\n            return NGX_AGAIN;\n        }\n\n    } else { //satisfy any\n        if (rc == NGX_OK) {\n            r-&amp;gt;access_code = 0;\n\n            if (r-&amp;gt;headers_out.www_authenticate) {\n                r-&amp;gt;headers_out.www_authenticate-&amp;gt;hash = 0;\n            }\n\n            r-&amp;gt;phase_handler = ph-&amp;gt;next; //satisfy any, åˆ™è·³åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µ\n            return NGX_AGAIN;\n        }\n\n        if (rc == NGX_HTTP_FORBIDDEN || rc == NGX_HTTP_UNAUTHORIZED) {\n            if (r-&amp;gt;access_code != NGX_HTTP_UNAUTHORIZED) {\n                r-&amp;gt;access_code = rc;\n            }\n\n            r-&amp;gt;phase_handler++; //ä¸‹ä¸€ä¸ªhandleræ–¹æ³•\n            return NGX_AGAIN;\n        }\n    }\n\n    /* rc == NGX_ERROR || rc == NGX_HTTP_...  */\n\n    ngx_http_finalize_request(r, rc); //ç»“æŸè¯·æ±‚\n    return NGX_OK;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;ngx_http_core_post_access_phase\&#34;&gt;ngx_http_core_post_access_phase&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * NGX_HTTP_POST_ACCESS_PHASEé˜¶æ®µçš„checkeræ–¹æ³•, å…¥å‚phæœªä½¿ç”¨ï¼Œå³ä¸å…è®¸ä»‹å…¥\n */\nngx_int_t\nngx_http_core_post_access_phase(ngx_http_request_t *r,\n    ngx_http_phase_handler_t *ph)\n{\n    ngx_int_t  access_code;\n\n    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,\n                   &amp;quot;post access phase: %ui&amp;quot;, r-&amp;gt;phase_handler);\n\n    access_code = r-&amp;gt;access_code;\n\n    if (access_code) { //access_codeé0ï¼Œè¡¨æ˜æ²¡æœ‰è®¿é—®æƒé™\n        if (access_code == NGX_HTTP_FORBIDDEN) {\n            ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0,\n                          &amp;quot;access forbidden by rule&amp;quot;);\n        }\n\n        r-&amp;gt;access_code = 0;\n        ngx_http_finalize_request(r, access_code);\n        return NGX_OK;\n    }\n\n    r-&amp;gt;phase_handler++;\n    return NGX_AGAIN;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;ngx_http_core_content_phase\&#34;&gt;ngx_http_core_content_phase&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * NGX_HTTP_CONTENT_PHASEé˜¶æ®µçš„checkeræ–¹æ³•\n */\nngx_int_t\nngx_http_core_content_phase(ngx_http_request_t *r,\n    ngx_http_phase_handler_t *ph)\n{\n    size_t     root;\n    ngx_int_t  rc;\n    ngx_str_t  path;\n\n    if (r-&amp;gt;content_handler) { //ä»‹å…¥çš„ç‰¹æ®Šæ–¹å¼: æŸlocationç‰¹æœ‰çš„handleræ–¹æ³•, ä¸å½±å“å…¶ä»–location\n        r-&amp;gt;write_event_handler = ngx_http_request_empty_handler;\n        ngx_http_finalize_request(r, r-&amp;gt;content_handler(r));\n        return NGX_OK;\n    }\n\n    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r-&amp;gt;connection-&amp;gt;log, 0,\n                   &amp;quot;content phase: %ui&amp;quot;, r-&amp;gt;phase_handler);\n\n    rc = ph-&amp;gt;handler(r); //æ‰§è¡Œpostconfigurationé’©å­å‡½æ•°æ·»åŠ çš„handleræ–¹æ³•\n\n    if (rc != NGX_DECLINED) {\n        ngx_http_finalize_request(r, rc);\n        return NGX_OK;\n    }\n\n    /* rc == NGX_DECLINED */\n\n    ph++;\n\n    if (ph-&amp;gt;checker) {\n        r-&amp;gt;phase_handler++; //ä¸‹ä¸€ä¸ªhandleræ–¹æ³•\n        return NGX_AGAIN;\n    }\n\n    /* no content handler was found */\n\n    if (r-&amp;gt;uri.data[r-&amp;gt;uri.len - 1] == &#39;/&#39;) {\n\n        if (ngx_http_map_uri_to_path(r, &amp;amp;path, &amp;amp;root, 0) != NULL) {\n            ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0,\n                          &amp;quot;directory index of \\&amp;quot;%s\\&amp;quot; is forbidden&amp;quot;, path.data);\n        }\n\n        ngx_http_finalize_request(r, NGX_HTTP_FORBIDDEN);\n        return NGX_OK;\n    }\n\n    ngx_log_error(NGX_LOG_ERR, r-&amp;gt;connection-&amp;gt;log, 0, &amp;quot;no handler found&amp;quot;);\n\n    ngx_http_finalize_request(r, NGX_HTTP_NOT_FOUND); //404\n    return NGX_OK;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;å¤„ç†è¯·æ±‚ç»è¿‡10ä¸ªé˜¶æ®µ\&#34;&gt;å¤„ç†è¯·æ±‚ç»è¿‡10ä¸ªé˜¶æ®µ&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * 10ä¸ªé˜¶æ®µå¤„ç†HTTPè¯·æ±‚\n */\nvoid\nngx_http_core_run_phases(ngx_http_request_t *r)\n{\n    ngx_int_t                   rc;\n    ngx_http_phase_handler_t   *ph;\n    ngx_http_core_main_conf_t  *cmcf;\n\n    cmcf = ngx_http_get_module_main_conf(r, ngx_http_core_module);\n\n    ph = cmcf-&amp;gt;phase_engine.handlers;\n\n    while (ph[r-&amp;gt;phase_handler].checker) {\n\n        rc = ph[r-&amp;gt;phase_handler].checker(r, &amp;amp;ph[r-&amp;gt;phase_handler]);\n\n        if (rc == NGX_OK) {\n            return;\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;è®°å½•httpæ—¥å¿—é˜¶æ®µç‰¹æ®Šå¤„ç†\&#34;&gt;è®°å½•httpæ—¥å¿—é˜¶æ®µç‰¹æ®Šå¤„ç†&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * è®°å½•è®¿é—®æ—¥å¿—ã€‚logé˜¶æ®µçš„handleré“¾å¹¶ä¸æ˜¯åœ¨ngx_http_core_run_phaseså‡½æ•°ä¸­æ‰§è¡Œ, å®ƒåªéœ€åœ¨è¯·æ±‚å¤„ç†é€»è¾‘ç»“æŸåæ‰æ‰§è¡Œä¸€æ¬¡\n */\nstatic void\nngx_http_log_request(ngx_http_request_t *r)\n{\n    ngx_uint_t                  i, n;\n    ngx_http_handler_pt        *log_handler;\n    ngx_http_core_main_conf_t  *cmcf;\n\n    cmcf = ngx_http_get_module_main_conf(r, ngx_http_core_module);\n\n    log_handler = cmcf-&amp;gt;phases[NGX_HTTP_LOG_PHASE].handlers.elts;\n    n = cmcf-&amp;gt;phases[NGX_HTTP_LOG_PHASE].handlers.nelts;\n\n    for (i = 0; i &amp;lt; n; i++) {\n        log_handler[i](r);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;nginx-yuan-ma-fen-xi-zhi-http-kuang-jia&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;Nginxçš„httpåŠŸèƒ½å’Œæ¨¡å—ä½¿ç”¨å¹¿æ³›ï¼Œé‚£ä¹ˆNginxçš„httpæ¡†æ¶æ˜¯å¦‚ä½•åˆå§‹åŒ–çš„å‘¢ï¼Ÿhttpè¯·æ±‚çš„11ä¸ªå¤„ç†é˜¶æ®µåˆæ˜¯æ€ä¹ˆè®¾è®¡çš„å‘¢ï¼Ÿ&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Nginxæºç åˆ†æä¹‹--httpæ¡†æ¶&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Nginx&#34;,&#34;slug&#34;:&#34;ZUZBgmRmp&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/ZUZBgmRmp/&#34;},{&#34;name&#34;:&#34;æºç åˆ†æ&#34;,&#34;slug&#34;:&#34;1FH1KPhrG&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/1FH1KPhrG/&#34;}],&#34;date&#34;:&#34;2020-05-10 11:33:32&#34;,&#34;dateFormat&#34;:&#34;2020-05-10&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://xly0713.github.io/post/nginx-yuan-ma-fen-xi-zhi-http-kuang-jia/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;20 min read&#34;,&#34;time&#34;:1156000,&#34;words&#34;:4089,&#34;minutes&#34;:20},&#34;description&#34;:&#34;Nginxçš„httpåŠŸèƒ½å’Œæ¨¡å—ä½¿ç”¨å¹¿æ³›ï¼Œé‚£ä¹ˆNginxçš„httpæ¡†æ¶æ˜¯å¦‚ä½•åˆå§‹åŒ–çš„å‘¢ï¼Ÿhttpè¯·æ±‚çš„11ä¸ªå¤„ç†é˜¶æ®µåˆæ˜¯æ€ä¹ˆè®¾è®¡çš„å‘¢ï¼Ÿ\n\nhttpæ¡†æ¶åˆå§‹åŒ–æµç¨‹å›¾\n\nç»“åˆæµç¨‹ç®€å›¾å’Œä»£ç æè¿°æ€»ä½“æµç¨‹\nå½“é…ç½®æ–‡ä»¶nginx.confé…ç½®äº†http...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#http%E6%A1%86%E6%9E%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B%E5%9B%BE\&#34;&gt;httpæ¡†æ¶åˆå§‹åŒ–æµç¨‹å›¾&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BB%93%E5%90%88%E6%B5%81%E7%A8%8B%E7%AE%80%E5%9B%BE%E5%92%8C%E4%BB%A3%E7%A0%81%E6%8F%8F%E8%BF%B0%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B\&#34;&gt;ç»“åˆæµç¨‹ç®€å›¾å’Œä»£ç æè¿°æ€»ä½“æµç¨‹&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%89%80%E6%9C%89http%E6%A8%A1%E5%9D%97%E7%9A%84ctx_index%E5%BA%8F%E5%8F%B7\&#34;&gt;åˆå§‹åŒ–æ‰€æœ‰HTTPæ¨¡å—çš„ctx_indexåºå·&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%86%E9%85%8D%E8%A7%A3%E6%9E%90http%E5%9D%97%E4%B8%8Bmain%E7%BA%A7%E5%88%AB%E9%85%8D%E7%BD%AE%E9%A1%B9%E6%97%B6%E5%AD%98%E6%94%BEhttp%E6%A8%A1%E5%9D%97%E7%BB%93%E6%9E%84%E4%BD%93%E6%8C%87%E9%92%88%E7%9A%843%E4%B8%AA%E6%95%B0%E7%BB%84\&#34;&gt;åˆ†é…è§£æhttp{}å—ä¸‹mainçº§åˆ«é…ç½®é¡¹æ—¶å­˜æ”¾HTTPæ¨¡å—ç»“æ„ä½“æŒ‡é’ˆçš„3ä¸ªæ•°ç»„&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BE%9D%E6%AC%A1%E8%B0%83%E7%94%A8%E6%89%80%E6%9C%89http%E6%A8%A1%E5%9D%97%E7%9A%84create_mainsrvloc_conf%E5%85%B13%E4%B8%AA%E6%96%B9%E6%B3%95\&#34;&gt;ä¾æ¬¡è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„create_(main|srv|loc)_confå…±3ä¸ªæ–¹æ³•&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B0%83%E7%94%A8%E6%89%80%E6%9C%89http%E6%A8%A1%E5%9D%97%E7%9A%84preconfiguration%E6%96%B9%E6%B3%95\&#34;&gt;è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„preconfigurationæ–¹æ³•&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E6%9E%90http%E5%9D%97%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89main%E7%BA%A7%E5%88%AB%E9%85%8D%E7%BD%AE%E9%A1%B9\&#34;&gt;è§£æhttp{}å—ä¸‹çš„æ‰€æœ‰mainçº§åˆ«é…ç½®é¡¹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B0%83%E7%94%A8%E6%89%80%E6%9C%89http%E6%A8%A1%E5%9D%97%E7%9A%84init_main_conf%E6%96%B9%E6%B3%95\&#34;&gt;è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„init_main_confæ–¹æ³•&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%90%88%E5%B9%B6main-srv-loc%E7%BA%A7%E5%88%AB%E4%B8%8Bserver-location%E7%9B%B8%E5%85%B3%E7%9A%84%E9%85%8D%E7%BD%AE%E9%A1%B9\&#34;&gt;åˆå¹¶mainã€srvã€locçº§åˆ«ä¸‹serverã€locationç›¸å…³çš„é…ç½®é¡¹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9E%84%E9%80%A0location%E7%BB%84%E6%88%90%E7%9A%84%E9%9D%99%E6%80%81%E4%BA%8C%E5%8F%89%E5%B9%B3%E8%A1%A1%E6%9F%A5%E6%89%BE%E6%A0%91\&#34;&gt;æ„é€ locationç»„æˆçš„é™æ€äºŒå‰å¹³è¡¡æŸ¥æ‰¾æ ‘&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%AF%E6%B7%BB%E5%8A%A0%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95%E7%9A%84http%E9%98%B6%E6%AE%B5%E7%9A%84%E5%8A%A8%E6%80%81%E6%95%B0%E7%BB%84\&#34;&gt;åˆå§‹åŒ–å¯æ·»åŠ å¤„ç†æ–¹æ³•çš„HTTPé˜¶æ®µçš„åŠ¨æ€æ•°ç»„&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B0%83%E7%94%A8%E6%89%80%E6%9C%89http%E6%A8%A1%E5%9D%97%E7%9A%84postconfiguration%E6%96%B9%E6%B3%95%E4%BD%BF%E4%B9%8B%E5%8F%AF%E4%BB%A5%E4%BB%8B%E5%85%A5http%E9%98%B6%E6%AE%B5\&#34;&gt;è°ƒç”¨æ‰€æœ‰HTTPæ¨¡å—çš„postconfigurationæ–¹æ³•ä½¿ä¹‹å¯ä»¥ä»‹å…¥HTTPé˜¶æ®µ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%B9%E6%8D%AE%E5%90%84%E4%B8%AAhttp%E6%A8%A1%E5%9D%97%E4%BB%8B%E5%85%A5%E7%9A%84%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95%E6%9E%84%E9%80%A0%E5%87%BAphase_engine_handlers%E6%95%B0%E7%BB%84\&#34;&gt;æ ¹æ®å„ä¸ªHTTPæ¨¡å—ä»‹å…¥çš„å¤„ç†æ–¹æ³•æ„é€ å‡ºphase_engine_handlersæ•°ç»„&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9E%84%E9%80%A0server%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%9E%84%E6%88%90%E7%9A%84%E6%94%AF%E6%8C%81%E9%80%9A%E9%85%8D%E7%AC%A6%E7%9A%84%E6%95%A3%E5%88%97%E8%A1%A8\&#34;&gt;æ„é€ serverè™šæ‹Ÿä¸»æœºæ„æˆçš„æ”¯æŒé€šé…ç¬¦çš„æ•£åˆ—è¡¨&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9E%84%E9%80%A0%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3%E4%B8%8Eserver%E9%97%B4%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB%E5%B9%B6%E8%AE%BE%E7%BD%AE%E6%96%B0%E8%BF%9E%E6%8E%A5%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%9B%9E%E8%B0%83%E6%96%B9%E6%B3%95\&#34;&gt;æ„é€ ç›‘å¬ç«¯å£ä¸serveré—´çš„å…³è”å…³ç³»ï¼Œå¹¶è®¾ç½®æ–°è¿æ¥äº‹ä»¶çš„å›è°ƒæ–¹æ³•&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#http%E8%AF%B7%E6%B1%82%E7%9A%8411%E4%B8%AA%E9%98%B6%E6%AE%B5\&#34;&gt;httpè¯·æ±‚çš„11ä¸ªé˜¶æ®µ&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9E%84%E9%80%A0phase_engine_handlers%E6%95%B0%E7%BB%84\&#34;&gt;æ„é€ phase_engine_handlersæ•°ç»„&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#checker%E6%96%B9%E6%B3%95\&#34;&gt;checkeræ–¹æ³•&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#ngx_http_core_generic_phase\&#34;&gt;ngx_http_core_generic_phase&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ngx_http_core_rewrite_phase\&#34;&gt;ngx_http_core_rewrite_phase&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ngx_http_core_find_config_phase\&#34;&gt;ngx_http_core_find_config_phase&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ngx_http_core_post_rewrite_phase\&#34;&gt;ngx_http_core_post_rewrite_phase&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ngx_http_core_access_phase\&#34;&gt;ngx_http_core_access_phase&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ngx_http_core_post_access_phase\&#34;&gt;ngx_http_core_post_access_phase&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ngx_http_core_content_phase\&#34;&gt;ngx_http_core_content_phase&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E7%BB%8F%E8%BF%8710%E4%B8%AA%E9%98%B6%E6%AE%B5\&#34;&gt;å¤„ç†è¯·æ±‚ç»è¿‡10ä¸ªé˜¶æ®µ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%AE%B0%E5%BD%95http%E6%97%A5%E5%BF%97%E9%98%B6%E6%AE%B5%E7%89%B9%E6%AE%8A%E5%A4%84%E7%90%86\&#34;&gt;è®°å½•httpæ—¥å¿—é˜¶æ®µç‰¹æ®Šå¤„ç†&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;zshæ›¿æ¢bashï¼Œå¯ä»¥è®©å‘½ä»¤è¡Œæ“ä½œæ›´é«˜æ•ˆã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;å®‰è£…zsh\&#34;&gt;å®‰è£…zsh&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;yum install zsh -y\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;å®‰è£…oh-my-zsh\&#34;&gt;å®‰è£…oh-my-zsh&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sh -c &amp;quot;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&amp;quot;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;å®‰è£…zsh-autosuggestionsæ’ä»¶\&#34;&gt;å®‰è£…zsh-autosuggestionsæ’ä»¶&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;ä¿®æ”¹~zshrcæ–‡ä»¶\&#34;&gt;ä¿®æ”¹~/.zshrcæ–‡ä»¶&lt;/h2&gt;\n&lt;p&gt;æ‰¾åˆ°pluginså˜é‡ï¼Œå¢åŠ zsh-autosuggestionsï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;plugins=(zsh-autosuggestions)\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;zsh-ti-dai-bash&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;zshæ›¿æ¢bashï¼Œå¯ä»¥è®©å‘½ä»¤è¡Œæ“ä½œæ›´é«˜æ•ˆã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;zshæ›¿ä»£bash&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;æ•ˆç‡å·¥å…·&#34;,&#34;slug&#34;:&#34;xiao-lu-gong-ju&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/xiao-lu-gong-ju/&#34;}],&#34;date&#34;:&#34;2020-05-01 21:26:09&#34;,&#34;dateFormat&#34;:&#34;2020-05-01&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://xly0713.github.io/post/zsh-ti-dai-bash/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:25000,&#34;words&#34;:84,&#34;minutes&#34;:1},&#34;description&#34;:&#34;zshæ›¿æ¢bashï¼Œå¯ä»¥è®©å‘½ä»¤è¡Œæ“ä½œæ›´é«˜æ•ˆã€‚\n\nå®‰è£…zsh\nyum install zsh -y\n\nå®‰è£…oh-my-zsh\nsh -c &amp;quot;$(curl -fsSL https://raw.github.com/ohmyzsh/oh...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85zsh\&#34;&gt;å®‰è£…zsh&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85oh-my-zsh\&#34;&gt;å®‰è£…oh-my-zsh&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85zsh-autosuggestions%E6%8F%92%E4%BB%B6\&#34;&gt;å®‰è£…zsh-autosuggestionsæ’ä»¶&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BF%AE%E6%94%B9~zshrc%E6%96%87%E4%BB%B6\&#34;&gt;ä¿®æ”¹~/.zshrcæ–‡ä»¶&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹ATSçš„å®‰è£…ã€é…ç½®ã€æ—¥å¿—ç­‰ç›¸å…³åŸºç¡€çŸ¥è¯†çš„æ•´ç†ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;å®‰è£…-ä»¥trafficserver-805ç‰ˆæœ¬ä¸ºä¾‹\&#34;&gt;å®‰è£… ï¼ˆä»¥trafficserver-8.0.5ç‰ˆæœ¬ä¸ºä¾‹ï¼‰&lt;/h2&gt;\n&lt;h3 id=\&#34;ä¸‹è½½æºä»£ç å¹¶è§£å‹\&#34;&gt;ä¸‹è½½æºä»£ç å¹¶è§£å‹&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;yum -y install bzip2 wget\nwget https://mirror.bit.edu.cn/apache/trafficserver/trafficserver-8.0.5.tar.bz2\ntar xf trafficserver-8.0.5.tar.bz2\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;å‡†å¤‡c17ç¼–è¯‘ç¯å¢ƒ\&#34;&gt;å‡†å¤‡c++17ç¼–è¯‘ç¯å¢ƒ&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;yum -y install centos-release-scl\nyum -y install yum-utils\nyum-config-manager --enable rhel-server-rhscl-7-rpms\nyum -y install devtoolset-7\n\nscl enable devtoolset-7 zsh\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;å®‰è£…tcl-dev-package\&#34;&gt;å®‰è£…TCL dev package&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;yum -y install tcl-devel\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;å®‰è£…openssl-devel\&#34;&gt;å®‰è£…openssl-devel&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;yum -y install openssl-devel\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;å®‰è£…lua-devel\&#34;&gt;å®‰è£…lua-devel&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;yum -y install lua-devel\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;å®‰è£…ncurses-devel\&#34;&gt;å®‰è£…ncurses-devel&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;yum -y install ncurses-devel\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;ç”Ÿæˆmakefile\&#34;&gt;ç”ŸæˆMakefile&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;./configure --prefix=/opt/ats\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;æ„å»º-æµ‹è¯•-å®‰è£…\&#34;&gt;æ„å»ºã€æµ‹è¯•ã€å®‰è£…&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;make\nmake test\nmake install\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;æ±‡æ€»å®‰è£…æ­¥éª¤\&#34;&gt;æ±‡æ€»å®‰è£…æ­¥éª¤&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;yum -y install bzip2 wget tcl-devel openssl-devel lua-devel  ncurses-devel \nyum -y install centos-release-scl yum-utils\nyum-config-manager --enable rhel-server-rhscl-7-rpms\nyum -y install devtoolset-7\nscl enable devtoolset-7 zsh\n\n./configure --prefix=/opt/ats\nmake\nmake test\nmake install\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;é…ç½®\&#34;&gt;é…ç½®&lt;/h2&gt;\n&lt;h3 id=\&#34;æ ¸å¿ƒé…ç½®æ–‡ä»¶recordsconfig\&#34;&gt;æ ¸å¿ƒé…ç½®æ–‡ä»¶records.config&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;æš‚ç•¥ï¼Œå¾…è¡¥å……&lt;/li&gt;\n&lt;li&gt;ç‰¹åˆ«çš„ï¼Œå¯ä»¥é…ç½®å¯ç”¨UIæ–¹ä¾¿æŸ¥çœ‹ATSè¿è¡Œæ—¶å…³é”®ä¿¡æ¯ã€æ£€ç´¢å’Œåˆ é™¤ç¼“å­˜ç­‰&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;åå‘ä»£ç†å›æºæ˜ å°„é…ç½®æ–‡ä»¶remapconfig\&#34;&gt;åå‘ä»£ç†å›æºæ˜ å°„é…ç½®æ–‡ä»¶remap.config&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;æš‚ç•¥ï¼Œå¾…è¡¥å……&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;ç¼“å­˜ç›¸å…³é…ç½®æ–‡ä»¶cacheconfig\&#34;&gt;ç¼“å­˜ç›¸å…³é…ç½®æ–‡ä»¶cache.config&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;æš‚ç•¥ï¼Œå¾…è¡¥å……&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;å­˜å‚¨é…ç½®storageconfig\&#34;&gt;å­˜å‚¨é…ç½®storage.config&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;æš‚ç•¥ï¼Œå¾…è¡¥å……&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;æ—¥å¿—\&#34;&gt;æ—¥å¿—&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;åœ¨records.configä¸­é…ç½®æ—¥å¿—è·¯å¾„ã€åˆ†å‰²æ–¹å¼ç­‰&lt;/li&gt;\n&lt;li&gt;squidé£æ ¼çš„æ—¥å¿—ï¼Œä½¿ç”¨traffic_logcatæŸ¥çœ‹&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;æ’ä»¶\&#34;&gt;æ’ä»¶&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;https://github.com/portl4t/ts-lua\&#34;&gt;luaæ’ä»¶&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;https://docs.trafficserver.apache.org/en/8.0.x/admin-guide/plugins/index.en.html\&#34;&gt;å®˜æ–¹æ’ä»¶&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;https://docs.trafficserver.apache.org/en/8.0.x/developer-guide/plugins/index.en.html\&#34;&gt;æ’ä»¶å¼€å‘æŒ‡å—&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;ats-ru-men&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹ATSçš„å®‰è£…ã€é…ç½®ã€æ—¥å¿—ç­‰ç›¸å…³åŸºç¡€çŸ¥è¯†çš„æ•´ç†ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;ATSå…¥é—¨&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Cache&#34;,&#34;slug&#34;:&#34;cache&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/cache/&#34;},{&#34;name&#34;:&#34;CDN&#34;,&#34;slug&#34;:&#34;cdn&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/cdn/&#34;}],&#34;date&#34;:&#34;2020-04-12 12:00:50&#34;,&#34;dateFormat&#34;:&#34;2020-04-12&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://xly0713.github.io/post/ats-ru-men/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:98000,&#34;words&#34;:348,&#34;minutes&#34;:2},&#34;description&#34;:&#34;æœ¬æ–‡æ˜¯å¯¹ATSçš„å®‰è£…ã€é…ç½®ã€æ—¥å¿—ç­‰ç›¸å…³åŸºç¡€çŸ¥è¯†çš„æ•´ç†ã€‚\n\nå®‰è£… ï¼ˆä»¥trafficserver-8.0.5ç‰ˆæœ¬ä¸ºä¾‹ï¼‰\nä¸‹è½½æºä»£ç å¹¶è§£å‹\nyum -y install bzip2 wget\nwget https://mirror.bit.ed...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85-%E4%BB%A5trafficserver-805%E7%89%88%E6%9C%AC%E4%B8%BA%E4%BE%8B\&#34;&gt;å®‰è£… ï¼ˆä»¥trafficserver-8.0.5ç‰ˆæœ¬ä¸ºä¾‹ï¼‰&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%8B%E8%BD%BD%E6%BA%90%E4%BB%A3%E7%A0%81%E5%B9%B6%E8%A7%A3%E5%8E%8B\&#34;&gt;ä¸‹è½½æºä»£ç å¹¶è§£å‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%87%86%E5%A4%87c17%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83\&#34;&gt;å‡†å¤‡c++17ç¼–è¯‘ç¯å¢ƒ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85tcl-dev-package\&#34;&gt;å®‰è£…TCL dev package&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85openssl-devel\&#34;&gt;å®‰è£…openssl-devel&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85lua-devel\&#34;&gt;å®‰è£…lua-devel&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85ncurses-devel\&#34;&gt;å®‰è£…ncurses-devel&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%9F%E6%88%90makefile\&#34;&gt;ç”ŸæˆMakefile&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9E%84%E5%BB%BA-%E6%B5%8B%E8%AF%95-%E5%AE%89%E8%A3%85\&#34;&gt;æ„å»ºã€æµ‹è¯•ã€å®‰è£…&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B1%87%E6%80%BB%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4\&#34;&gt;æ±‡æ€»å®‰è£…æ­¥éª¤&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%85%8D%E7%BD%AE\&#34;&gt;é…ç½®&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6recordsconfig\&#34;&gt;æ ¸å¿ƒé…ç½®æ–‡ä»¶records.config&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%9B%9E%E6%BA%90%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6remapconfig\&#34;&gt;åå‘ä»£ç†å›æºæ˜ å°„é…ç½®æ–‡ä»¶remap.config&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BC%93%E5%AD%98%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6cacheconfig\&#34;&gt;ç¼“å­˜ç›¸å…³é…ç½®æ–‡ä»¶cache.config&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AD%98%E5%82%A8%E9%85%8D%E7%BD%AEstorageconfig\&#34;&gt;å­˜å‚¨é…ç½®storage.config&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%97%A5%E5%BF%97\&#34;&gt;æ—¥å¿—&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8F%92%E4%BB%B6\&#34;&gt;æ’ä»¶&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;Nginxä½œä¸ºé«˜æ€§èƒ½çš„webæœåŠ¡å™¨ï¼Œå®ƒæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„å‘¢ï¼Ÿ&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;å†…å­˜æ± çš„ä¼˜ç‚¹\&#34;&gt;å†…å­˜æ± çš„ä¼˜ç‚¹&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;poolåŒ–å¤„ç†ï¼Œé¿å…å¤šæ¬¡å‘ç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œå‡å°‘ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢ï¼Œæé«˜å†…å­˜åˆ†é…æ•ˆç‡;&lt;/li&gt;\n&lt;li&gt;å†…å­˜ç»Ÿä¸€åˆ†é…å’Œå›æ”¶ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼›&lt;/li&gt;\n&lt;li&gt;æ•´å—åˆ†é…ï¼Œé¿å…å†…å­˜è¿‡äºç¢ç‰‡åŒ–;&lt;/li&gt;\n&lt;li&gt;å†…å­˜å¯¹é½å¤„ç†ï¼Œå‡å°‘CPUè¯»å–å†…å­˜æ¬¡æ•°ï¼Œæé«˜å¯»å€æ•ˆç‡ï¼›&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;å†…å­˜æ± ç›¸å…³çš„æ•°æ®ç»“æ„\&#34;&gt;å†…å­˜æ± ç›¸å…³çš„æ•°æ®ç»“æ„&lt;/h2&gt;\n&lt;h3 id=\&#34;ç»“æ„ä½“ç¤ºæ„å›¾\&#34;&gt;ç»“æ„ä½“ç¤ºæ„å›¾&lt;/h3&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://xly0713.github.io/post-images/1587183416580.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;æ•°æ®ç»“æ„å®šä¹‰\&#34;&gt;æ•°æ®ç»“æ„å®šä¹‰&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;typedef struct ngx_pool_s            ngx_pool_t;\ntypedef struct ngx_pool_large_s  ngx_pool_large_t;\n\nstruct ngx_pool_s { //å†…å­˜æ± å¤´éƒ¨ç»“æ„\n    ngx_pool_data_t       d;        //å†…å­˜æ± çš„æ•°æ®åŒºï¼Œå³çœŸæ­£åˆ†é…å†…å­˜çš„åŒºåŸŸ\n    size_t                max;      //æ¯æ¬¡å¯åˆ†é…æœ€å¤§å†…å­˜ï¼Œç”¨äºåˆ¤å®šæ˜¯èµ°å¤§å†…å­˜åˆ†é…è¿˜æ˜¯å°å†…å­˜åˆ†é…é€»è¾‘\n    ngx_pool_t           *current;  //æŒ‡å‘å½“å‰å†…å­˜æ± å°å—å†…å­˜å¯ç”¨çš„é¦–ä¸ªèŠ‚ç‚¹\n    ngx_chain_t          *chain;    //ç¼“å†²åŒºé“¾è¡¨\n    ngx_pool_large_t     *large;    //å†…å­˜å—å¤§äºmaxå†…å­˜å—çš„é“¾è¡¨\n    ngx_pool_cleanup_t   *cleanup;  //é”€æ¯å†…å­˜æ± å›è°ƒå‡½æ•°\n    ngx_log_t            *log;      //é”™è¯¯æ—¥å¿—æŒ‡é’ˆ\n};\n\ntypedef struct {\n    u_char               *last;     //å½“å‰å†…å­˜å—å·²ä½¿ç”¨åˆ°æ­¤å¤„ï¼Œä¸‹ä¸€æ¬¡ä½¿ç”¨ä»æ­¤å¤„å¼€å§‹\n    u_char               *end;      //å†…å­˜å—ç»“æŸä½ç½®\n    ngx_pool_t           *next;     //å†…å­˜æ± æœ‰å¾ˆå¤šå†…å­˜å—ï¼Œé€šè¿‡nextæŒ‡é’ˆç»„æˆé“¾è¡¨\n    ngx_uint_t            failed;   //å†…å­˜å—åˆ†é…å¤±è´¥æ¬¡æ•°\n} ngx_pool_data_t; //å°å†…å­˜å—(é“¾è¡¨)\n\n//å¤§å†…å­˜å—(é“¾è¡¨)\nstruct ngx_pool_large_s {\n    ngx_pool_large_t     *next;  //ä¸‹ä¸€æ•°æ®å—åœ°å€\n    void                 *alloc; //å½“å‰æ•°æ®å—åœ°å€\n};\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;å†…å­˜æ± ä¸»è¦å‡½æ•°\&#34;&gt;å†…å­˜æ± ä¸»è¦å‡½æ•°&lt;/h2&gt;\n&lt;h3 id=\&#34;æ–°å»ºå†…å­˜æ± \&#34;&gt;æ–°å»ºå†…å­˜æ± &lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * æ–°å»ºä¸€ä¸ªå†…å­˜æ± \n */\nngx_pool_t *\nngx_create_pool(size_t size, ngx_log_t *log)\n{\n    ngx_pool_t  *p;\n\n    //è°ƒç”¨ç³»ç»Ÿå†…å­˜åˆ†é…å‡½æ•°ï¼Œåˆ†é…ä¸€å—å †å†…å­˜ï¼Œä¸”åšå¯¹é½å¤„ç†\n    p = ngx_memalign(NGX_POOL_ALIGNMENT, size, log);\n    if (p == NULL) {\n        return NULL;\n    }\n\n    p-&amp;gt;d.last = (u_char *) p + sizeof(ngx_pool_t);\n    p-&amp;gt;d.end = (u_char *) p + size;\n    p-&amp;gt;d.next = NULL;\n    p-&amp;gt;d.failed = 0;\n\n    size = size - sizeof(ngx_pool_t);\n    //maxæœ€å¤§ä¸ºpagesize-1(æ¯”å¦‚:x86æ—¶ä¸º4095), å³ï¼šæ— è®ºå°å—å†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œè¶…è¿‡pagesize-1å¤§å°çš„å†…å­˜å‡èµ°largeå—åˆ†é…\n    p-&amp;gt;max = (size &amp;lt; NGX_MAX_ALLOC_FROM_POOL) ? size : NGX_MAX_ALLOC_FROM_POOL;\n\n    p-&amp;gt;current = p;\n    p-&amp;gt;chain = NULL;\n    p-&amp;gt;large = NULL;\n    p-&amp;gt;cleanup = NULL;\n    p-&amp;gt;log = log;\n\n    return p;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;ä»å†…å­˜æ± ç”³è¯·å†…å­˜\&#34;&gt;ä»å†…å­˜æ± ç”³è¯·å†…å­˜&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;å…ˆå¯¹é½å†åˆ†é…å†…å­˜&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * ä»å†…å­˜æ± ä¸­ç”³è¯·ä¸€å—å†…å­˜\n * ï¼ˆ1ï¼‰å¦‚æœç”³è¯·çš„å†…å­˜å°äºå®šä¹‰çš„maxï¼Œåˆ™ä»å†…å­˜æ± ä¸­åˆ†é…å†…å­˜ï¼Œéœ€å…ˆå¯¹é½å†åˆ†é…\n * ï¼ˆ2ï¼‰å¦åˆ™åˆ†é…å¤§å—å†…å­˜æŒ‚è½½åˆ°largeæŒ‡é’ˆä¸Š\n */\nvoid *\nngx_palloc(ngx_pool_t *pool, size_t size)\n{\n#if !(NGX_DEBUG_PALLOC)\n    if (size &amp;lt;= pool-&amp;gt;max) {\n        return ngx_palloc_small(pool, size, 1); //å°å—å†…å­˜(å…ˆå¯¹é½)\n    }\n#endif\n\n    return ngx_palloc_large(pool, size);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;å…ˆå¯¹é½å†åˆ†é…å†…å­˜, å¹¶å¡«å……0&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * ä»å†…å­˜æ± ä¸­ç”³è¯·å†…å­˜ï¼Œå¹¶å¡«å……0\n */\nvoid *\nngx_pcalloc(ngx_pool_t *pool, size_t size)\n{\n    void *p;\n\n    p = ngx_palloc(pool, size);\n    if (p) {\n        ngx_memzero(p, size);\n    }\n\n    return p;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ul&gt;\n&lt;li&gt;ä¸ç”¨å¯¹é½åˆ†é…å†…å­˜&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * ä»å†…å­˜æ± ä¸­ç”³è¯·ä¸€å—å†…å­˜ ï¼ˆå°å—å†…å­˜æ— éœ€å…ˆå¯¹é½ï¼‰\n */\nvoid *\nngx_pnalloc(ngx_pool_t *pool, size_t size)\n{\n#if !(NGX_DEBUG_PALLOC)\n    if (size &amp;lt;= pool-&amp;gt;max) {\n        return ngx_palloc_small(pool, size, 0); //å°å—å†…å­˜ï¼ˆæ— éœ€å…ˆå¯¹é½ï¼‰\n    }\n#endif\n\n    return ngx_palloc_large(pool, size);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;ä»å†…å­˜æ± ç”³è¯·å†…å­˜å°å—å†…å­˜\&#34;&gt;ä»å†…å­˜æ± ç”³è¯·å†…å­˜å°å—å†…å­˜&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * åˆ†é…å°å—å†…å­˜\n * 1. å¾ªç¯éå†å†…å­˜å—ngx_pool_data_té“¾è¡¨\n * 2. å¦‚æœå½“å‰å†…å­˜å—å‰©ä½™å¤§å°æ»¡è¶³ç”³è¯·çš„å†…å­˜å¤§å°ï¼Œåˆ™ç§»åŠ¨ç›¸åº”æŒ‡é’ˆï¼Œè¿”å›åˆ†é…çš„å†…å­˜æŒ‡é’ˆ\n * 3. å¦åˆ™ï¼Œç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå†…å­˜å—\n * 4. å¦‚æœæ‰€æœ‰å†…å­˜å—éƒ½æ²¡èƒ½æ»¡è¶³ç”³è¯·çš„å†…å­˜å¤§å°ï¼Œåˆ™é‡æ–°ç”³è¯·ä¸€å—å†…å­˜å—æŒ‚è½½åˆ°é“¾è¡¨ä¸Šï¼Œå¹¶è¿”å›åˆ†é…çš„å†…å­˜åœ°å€\n */\nstatic ngx_inline void *\nngx_palloc_small(ngx_pool_t *pool, size_t size, ngx_uint_t align)\n{\n    u_char      *m;\n    ngx_pool_t  *p;\n\n    p = pool-&amp;gt;current;\n\n    do {\n        m = p-&amp;gt;d.last; //æœ€åä½¿ç”¨ä½ç½®\n\n        if (align) {\n            m = ngx_align_ptr(m, NGX_ALIGNMENT); //å…ˆå†…å­˜å¯¹é½, å‡å°‘CPUè¯»å–å†…å­˜æ¬¡æ•°\n        }\n\n        if ((size_t) (p-&amp;gt;d.end - m) &amp;gt;= size) { //å½“å‰å†…å­˜å—å‰©ä½™ç©ºé—´è¶³å¤Ÿ\n            p-&amp;gt;d.last = m + size; //æœ€åä½¿ç”¨ä½ç½®æ›´æ–°ï¼Œå‰©ä½™ç©ºé—´å˜å°\n\n            return m;\n        }\n\n        p = p-&amp;gt;d.next;\n\n    } while (p);\n\n    //ç°æœ‰å°å—å†…å­˜å‡æ— æ³•åˆ†é…ï¼Œåˆ™æ–°å»ºå†…å­˜å—åå†åˆ†é…\n    return ngx_palloc_block(pool, size);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;æ–°å»ºå°å†…å­˜å—å†åˆ†é…\&#34;&gt;æ–°å»ºå°å†…å­˜å—å†åˆ†é…&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * å†æ¬¡ç”³è¯·å°å—å†…å­˜ï¼Œå¹¶æŒ‚è½½åˆ°å°å—å†…å­˜é“¾è¡¨ä¸Šï¼Œå¹¶è¿”å›å½“æ¬¡ç”³è¯·çš„å†…å­˜æŒ‡é’ˆ\n*/\nstatic void *\nngx_palloc_block(ngx_pool_t *pool, size_t size)\n{\n    u_char      *m;\n    size_t       psize;\n    ngx_pool_t  *p, *new;\n\n    psize = (size_t) (pool-&amp;gt;d.end - (u_char *) pool);\n\n    m = ngx_memalign(NGX_POOL_ALIGNMENT, psize, pool-&amp;gt;log);\n    if (m == NULL) {\n        return NULL;\n    }\n\n    new = (ngx_pool_t *) m;\n\n    new-&amp;gt;d.end = m + psize;\n    new-&amp;gt;d.next = NULL;\n    new-&amp;gt;d.failed = 0;\n\n    m += sizeof(ngx_pool_data_t);\n    m = ngx_align_ptr(m, NGX_ALIGNMENT);\n    new-&amp;gt;d.last = m + size;\n\n    for (p = pool-&amp;gt;current; p-&amp;gt;d.next; p = p-&amp;gt;d.next) {\n        //è°ƒæ•´å„ä¸ªå†…å­˜å—åˆ†é…å¤±è´¥æ¬¡æ•°ï¼Œå¦‚æœå¤±è´¥æ¬¡æ•°å¤§äº4ï¼Œåˆ™æ­¤å—å†…å­˜èŠ‚ç‚¹ä¸å†ä½¿ç”¨\n        if (p-&amp;gt;d.failed++ &amp;gt; 4) {\n            pool-&amp;gt;current = p-&amp;gt;d.next;\n        }\n    }\n\n    p-&amp;gt;d.next = new;\n\n    return m;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;åˆ†é…å¤§å†…å­˜\&#34;&gt;åˆ†é…å¤§å†…å­˜&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * åˆ†é…å¤§å†…å­˜å—\n */\nstatic void *\nngx_palloc_large(ngx_pool_t *pool, size_t size)\n{\n    void              *p;\n    ngx_uint_t         n;\n    ngx_pool_large_t  *large;\n\n    p = ngx_alloc(size, pool-&amp;gt;log); //å‘ç³»ç»Ÿç”³è¯·sizeå¤§å°å †å†…å­˜\n    if (p == NULL) {\n        return NULL;\n    }\n\n    n = 0;\n\n    //æŸ¥æ‰¾ä¸€ä¸ªç©ºçš„largeåŒºï¼Œå¦‚æœæœ‰ï¼Œåˆ™å°†åˆ†é…çš„ç©ºé—´päº¤ç”±å®ƒç®¡ç†ï¼ˆæœ€å¤š3æ¬¡ï¼‰\n    for (large = pool-&amp;gt;large; large; large = large-&amp;gt;next) {\n        if (large-&amp;gt;alloc == NULL) { //ngx_pfreeå‡½æ•°ä¼šäº§ç”Ÿç©ºçš„largeåŒº\n            large-&amp;gt;alloc = p;\n            return p;\n        }\n\n        if (n++ &amp;gt; 3) { //è¶…è¿‡ä¸€å®šæ¬¡æ•°ï¼Œæ”¾å¼ƒæŸ¥æ‰¾ç©ºçš„largeåŒº\n            break;\n        }\n    }\n\n    //åˆ›å»ºä¸€ä¸ªæ–°çš„largeèŠ‚ç‚¹\n    large = ngx_palloc_small(pool, sizeof(ngx_pool_large_t), 1);\n    if (large == NULL) {\n        ngx_free(p);\n        return NULL;\n    }\n\n    //æ–°åˆ†é…çš„ç©ºé—´päº¤ç”±æ–°å»ºçš„largeèŠ‚ç‚¹ç®¡ç†ï¼Œå¹¶ä¸”æ’å…¥åˆ°largeé“¾è¡¨å¤´éƒ¨\n    large-&amp;gt;alloc = p;\n    large-&amp;gt;next = pool-&amp;gt;large;\n    pool-&amp;gt;large = large;\n\n    return p;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;é”€æ¯å†…å­˜æ± \&#34;&gt;é”€æ¯å†…å­˜æ± &lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * é”€æ¯å†…å­˜æ± \n */\nvoid\nngx_destroy_pool(ngx_pool_t *pool)\n{\n    ngx_pool_t          *p, *n;\n    ngx_pool_large_t    *l;\n    ngx_pool_cleanup_t  *c;\n\n    for (c = pool-&amp;gt;cleanup; c; c = c-&amp;gt;next) {\n        if (c-&amp;gt;handler) {\n            ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool-&amp;gt;log, 0,\n                           &amp;quot;run cleanup: %p&amp;quot;, c);\n            c-&amp;gt;handler(c-&amp;gt;data);\n        }\n    }\n\n#if (NGX_DEBUG)\n\n    /*\n     * we could allocate the pool-&amp;gt;log from this pool\n     * so we cannot use this log while free()ing the pool\n     */\n\n    for (l = pool-&amp;gt;large; l; l = l-&amp;gt;next) {\n        ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool-&amp;gt;log, 0, &amp;quot;free: %p&amp;quot;, l-&amp;gt;alloc);\n    }\n\n    for (p = pool, n = pool-&amp;gt;d.next; /* void */; p = n, n = n-&amp;gt;d.next) {\n        ngx_log_debug2(NGX_LOG_DEBUG_ALLOC, pool-&amp;gt;log, 0,\n                       &amp;quot;free: %p, unused: %uz&amp;quot;, p, p-&amp;gt;d.end - p-&amp;gt;d.last);\n\n        if (n == NULL) {\n            break;\n        }\n    }\n\n#endif\n\n    //é‡Šæ”¾å¤§å†…å­˜å—ï¼ˆé“¾è¡¨ï¼‰\n    for (l = pool-&amp;gt;large; l; l = l-&amp;gt;next) {\n        if (l-&amp;gt;alloc) {\n            ngx_free(l-&amp;gt;alloc);\n        }\n    }\n\n    //é‡Šæ”¾å°å†…å­˜å— (é“¾è¡¨)\n    for (p = pool, n = pool-&amp;gt;d.next; /* void */; p = n, n = n-&amp;gt;d.next) {\n        ngx_free(p);\n\n        if (n == NULL) {\n            break;\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;é‡ç½®å†…å­˜æ± \&#34;&gt;é‡ç½®å†…å­˜æ± &lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * é‡ç½®å†…å­˜æ± \n * 1. é‡Šæ”¾å¤§å—å†…å­˜\n * 2. é‡ç½®å¯å¼€å§‹åˆ†é…ä½ç½®æŒ‡é’ˆã€åˆ†é…å¤±è´¥æ¬¡æ•°ä¸º0ã€å¯ç”¨å°å†…å­˜å—currentæŒ‡é’ˆæŒ‡å‘é¦–ä¸ªå†…å­˜å—\n */\nvoid\nngx_reset_pool(ngx_pool_t *pool)\n{\n    ngx_pool_t        *p;\n    ngx_pool_large_t  *l;\n\n    for (l = pool-&amp;gt;large; l; l = l-&amp;gt;next) { //éå†å¤§å—å†…å­˜é“¾è¡¨ï¼Œé‡Šæ”¾å†…å­˜\n        if (l-&amp;gt;alloc) {\n            ngx_free(l-&amp;gt;alloc);\n        }\n    }\n\n    for (p = pool; p; p = p-&amp;gt;d.next) {\n        p-&amp;gt;d.last = (u_char *) p + sizeof(ngx_pool_t); //æ¢å¤è‡³åˆå§‹ä¸ºä½ç½®\n        p-&amp;gt;d.failed = 0; //åˆ†é…å¤±è´¥æ¬¡æ•°é‡ç½®ä¸º0\n    }\n\n    pool-&amp;gt;current = pool; //currentæŒ‡å‘é¦–ä¸ªå†…å­˜å—\n    pool-&amp;gt;chain = NULL;\n    pool-&amp;gt;large = NULL;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;å›æ”¶å¤§å—å†…å­˜é“¾è¡¨ä¸Šçš„æŸä¸ªèŠ‚ç‚¹å†…å­˜\&#34;&gt;å›æ”¶å¤§å—å†…å­˜é“¾è¡¨ä¸Šçš„æŸä¸ªèŠ‚ç‚¹å†…å­˜&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;/*\n * å›æ”¶å¤§å—å†…å­˜é“¾è¡¨ä¸Šçš„æŸä¸ªèŠ‚ç‚¹å†…å­˜\n */\nngx_int_t\nngx_pfree(ngx_pool_t *pool, void *p)\n{\n    ngx_pool_large_t  *l;\n\n    for (l = pool-&amp;gt;large; l; l = l-&amp;gt;next) {\n        if (p == l-&amp;gt;alloc) {\n            ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool-&amp;gt;log, 0,\n                           &amp;quot;free: %p&amp;quot;, l-&amp;gt;alloc);\n            ngx_free(l-&amp;gt;alloc);\n            l-&amp;gt;alloc = NULL;\n\n            return NGX_OK;\n        }\n    }\n\n    return NGX_DECLINED;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;nginx-yuan-ma-xue-xi&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;Nginxä½œä¸ºé«˜æ€§èƒ½çš„webæœåŠ¡å™¨ï¼Œå®ƒæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„å‘¢ï¼Ÿ&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Nginxæºç åˆ†æä¹‹--å†…å­˜æ± &#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Nginx&#34;,&#34;slug&#34;:&#34;ZUZBgmRmp&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/ZUZBgmRmp/&#34;},{&#34;name&#34;:&#34;æºç åˆ†æ&#34;,&#34;slug&#34;:&#34;1FH1KPhrG&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/1FH1KPhrG/&#34;}],&#34;date&#34;:&#34;2020-04-11 22:09:35&#34;,&#34;dateFormat&#34;:&#34;2020-04-11&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://xly0713.github.io/post/nginx-yuan-ma-xue-xi/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;9 min read&#34;,&#34;time&#34;:482000,&#34;words&#34;:1761,&#34;minutes&#34;:9},&#34;description&#34;:&#34;Nginxä½œä¸ºé«˜æ€§èƒ½çš„webæœåŠ¡å™¨ï¼Œå®ƒæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„å‘¢ï¼Ÿ\n\nå†…å­˜æ± çš„ä¼˜ç‚¹\n\npoolåŒ–å¤„ç†ï¼Œé¿å…å¤šæ¬¡å‘ç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œå‡å°‘ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢ï¼Œæé«˜å†…å­˜åˆ†é…æ•ˆç‡;\nå†…å­˜ç»Ÿä¸€åˆ†é…å’Œå›æ”¶ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼›\næ•´å—åˆ†é…ï¼Œé¿å…å†…å­˜è¿‡äºç¢ç‰‡åŒ–;\nå†…å­˜å¯¹é½å¤„...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%86%85%E5%AD%98%E6%B1%A0%E7%9A%84%E4%BC%98%E7%82%B9\&#34;&gt;å†…å­˜æ± çš„ä¼˜ç‚¹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%86%85%E5%AD%98%E6%B1%A0%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84\&#34;&gt;å†…å­˜æ± ç›¸å…³çš„æ•°æ®ç»“æ„&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BB%93%E6%9E%84%E4%BD%93%E7%A4%BA%E6%84%8F%E5%9B%BE\&#34;&gt;ç»“æ„ä½“ç¤ºæ„å›¾&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AE%9A%E4%B9%89\&#34;&gt;æ•°æ®ç»“æ„å®šä¹‰&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%86%85%E5%AD%98%E6%B1%A0%E4%B8%BB%E8%A6%81%E5%87%BD%E6%95%B0\&#34;&gt;å†…å­˜æ± ä¸»è¦å‡½æ•°&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%B0%E5%BB%BA%E5%86%85%E5%AD%98%E6%B1%A0\&#34;&gt;æ–°å»ºå†…å­˜æ± &lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%8E%E5%86%85%E5%AD%98%E6%B1%A0%E7%94%B3%E8%AF%B7%E5%86%85%E5%AD%98\&#34;&gt;ä»å†…å­˜æ± ç”³è¯·å†…å­˜&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%8E%E5%86%85%E5%AD%98%E6%B1%A0%E7%94%B3%E8%AF%B7%E5%86%85%E5%AD%98%E5%B0%8F%E5%9D%97%E5%86%85%E5%AD%98\&#34;&gt;ä»å†…å­˜æ± ç”³è¯·å†…å­˜å°å—å†…å­˜&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%96%B0%E5%BB%BA%E5%B0%8F%E5%86%85%E5%AD%98%E5%9D%97%E5%86%8D%E5%88%86%E9%85%8D\&#34;&gt;æ–°å»ºå°å†…å­˜å—å†åˆ†é…&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%86%E9%85%8D%E5%A4%A7%E5%86%85%E5%AD%98\&#34;&gt;åˆ†é…å¤§å†…å­˜&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%94%80%E6%AF%81%E5%86%85%E5%AD%98%E6%B1%A0\&#34;&gt;é”€æ¯å†…å­˜æ± &lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%87%8D%E7%BD%AE%E5%86%85%E5%AD%98%E6%B1%A0\&#34;&gt;é‡ç½®å†…å­˜æ± &lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9B%9E%E6%94%B6%E5%A4%A7%E5%9D%97%E5%86%85%E5%AD%98%E9%93%BE%E8%A1%A8%E4%B8%8A%E7%9A%84%E6%9F%90%E4%B8%AA%E8%8A%82%E7%82%B9%E5%86%85%E5%AD%98\&#34;&gt;å›æ”¶å¤§å—å†…å­˜é“¾è¡¨ä¸Šçš„æŸä¸ªèŠ‚ç‚¹å†…å­˜&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;å®‰è£…ä¾èµ–\&#34;&gt;å®‰è£…ä¾èµ–&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;yum install libunwind-devel graphviz-devel ghostscript automake libtool -y&lt;/code&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;ç¼–è¯‘gpreftools\&#34;&gt;ç¼–è¯‘gpreftools&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;æºä»£ç ï¼šhttps://github.com/gperftools/gperftools/archive/gperftools-2.7.tar.gz&lt;/li&gt;\n&lt;li&gt;ç¼–è¯‘å®‰è£…\n&lt;ul&gt;\n&lt;li&gt;./autogen.sh&lt;/li&gt;\n&lt;li&gt;./configure&lt;/li&gt;\n&lt;li&gt;make &amp;amp;&amp;amp; make install&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;å¯¼å‡ºLD_LIBRARY_PATH\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;export LD_LIBRARY_PATH=&amp;quot;$LD_LIBRARY_PATH:/usr/local/lib&amp;quot;&lt;/code&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;nginxä½¿ç”¨tcmallocå’Œå¯ç”¨google_perftools_moduleæ¨¡å—\&#34;&gt;nginxä½¿ç”¨tcmallocå’Œå¯ç”¨google_perftools_moduleæ¨¡å—&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;--with-ld-opt=-ltcmalloc --with-google_perftools_module&lt;/code&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;gperftools-fen-xi-nginx&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;gperftoolsåˆ†æNginx&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Nginx&#34;,&#34;slug&#34;:&#34;ZUZBgmRmp&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/ZUZBgmRmp/&#34;}],&#34;date&#34;:&#34;2020-02-09 19:00:55&#34;,&#34;dateFormat&#34;:&#34;2020-02-09&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://xly0713.github.io/post/gperftools-fen-xi-nginx/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:21000,&#34;words&#34;:68,&#34;minutes&#34;:1},&#34;description&#34;:&#34;å®‰è£…ä¾èµ–\n\nyum install libunwind-devel graphviz-devel ghostscript automake libtool -y\n\nç¼–è¯‘gpreftools\n\næºä»£ç ï¼šhttps://github.com/g...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96\&#34;&gt;å®‰è£…ä¾èµ–&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BC%96%E8%AF%91gpreftools\&#34;&gt;ç¼–è¯‘gpreftools&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#nginx%E4%BD%BF%E7%94%A8tcmalloc%E5%92%8C%E5%90%AF%E7%94%A8google_perftools_module%E6%A8%A1%E5%9D%97\&#34;&gt;nginxä½¿ç”¨tcmallocå’Œå¯ç”¨google_perftools_moduleæ¨¡å—&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹tcpåè®®åŸºç¡€çŸ¥è¯†çš„æ•´ç†ä»‹ç»ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;tcpå»ºè¿-æ–­è¿\&#34;&gt;tcpå»ºè¿ã€æ–­è¿&lt;/h2&gt;\n&lt;h3 id=\&#34;ç¤ºæ„å›¾\&#34;&gt;ç¤ºæ„å›¾&lt;/h3&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://xly0713.github.io/post-images/1586241639078.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹\&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;é˜²æ­¢å¤±æ•ˆçš„è¿æ¥è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ã€‚&lt;/li&gt;\n&lt;li&gt;å…·ä½“æè¿°ï¼šå¦‚æœclientå‘é€çš„è¿æ¥è¯·æ±‚SYNåŒ…åœ¨ç½‘ç»œä¸­æ»ç•™äº†è¾ƒé•¿æ—¶é—´ï¼Œserveræœ€ç»ˆä»ä¼šæ”¶åˆ°å¹¶å‘å›è¿æ¥ç¡®è®¤SYN+ACKã€‚è€Œclientç­‰å¾…ä¸€ä¸ªè¶…æ—¶æ—¶é—´åï¼Œè®¤ä¸ºåˆšæ‰æ»ç•™çš„è¿æ¥è¯·æ±‚åŒ…ä¸¢å¤±äº†ï¼Œåˆ™ä¼šé‡æ–°å‘é€SYNåŒ…å‘èµ·è¿æ¥è¯·æ±‚ã€‚å¦‚æœä¸è¿›è¡Œç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆserveræ”¶åˆ°æ»ç•™çš„SYNåŒ…å°±æ‰“å¼€çš„è¿æ¥æ˜¯æ— æ•ˆçš„ï¼›å¦‚æœæœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆclientä¼šå¿½ç•¥serverå¯¹æ»ç•™çš„SYNåŒ…çš„å“åº”SYN+ACKï¼Œä¸å›å¤ACKåŒ…ï¼Œserveræ”¶ä¸åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹ACKåŒ…å°±ä¸ä¼šæ–°å»ºè¿æ¥ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;tcpé¢å‘è¿æ¥ä»€ä¹ˆå«ä¹‰\&#34;&gt;tcpé¢å‘è¿æ¥ä»€ä¹ˆå«ä¹‰ï¼Ÿ&lt;/h3&gt;\n&lt;p&gt;ä¸ºäº†åœ¨clientå’Œserveré—´ç»´æŠ¤è¿æ¥ï¼Œéœ€å»ºç«‹ä¸€å®šçš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤åŒæ–¹çš„äº¤äº’çŠ¶æ€ï¼Œç”¨è¿™æ ·çš„æ•°æ®ç»“æ„æ¥ä¿è¯é¢å‘è¿æ¥çš„ç‰¹æ€§ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹\&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ&lt;/h3&gt;\n&lt;p&gt;ä¸€ç«¯å‘é€FINåŒ…è¯·æ±‚é‡Šæ”¾è¿æ¥ï¼Œå¯¹ç«¯æ”¶åˆ°è¿™ä¸ªFINæŠ¥æ–‡åè¿›å…¥äº†&lt;code&gt;CLOSE_WAIT&lt;/code&gt;çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œä»ç„¶å¯ä»¥å‘å¯¹æ–¹å‘é€æœªå‘é€å®Œæ¯•çš„æ•°æ®ï¼Œæ•°æ®å‘é€å®Œæ¯•åä¹Ÿè¦å‘å¯¹ç«¯å‘é€FINæŠ¥æ–‡é‡Šæ”¾è¿æ¥ï¼Œå¿˜äº†å‘FINåŒ…(è°ƒç”¨close())ä¼šå¯¼è‡´bugã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒTCPæ˜¯å…¨åŒå·¥ä¼ è¾“ï¼Œä¸¤ç«¯éƒ½å¿…é¡»å‘é€FINåŒ…ï¼Œæ‰èƒ½å®Œå…¨æ–­å¼€è¿æ¥ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;time_waitçŠ¶æ€\&#34;&gt;TIME_WAITçŠ¶æ€&lt;/h3&gt;\n&lt;p&gt;ä¸»åŠ¨å‘é€FINåŒ…çš„ä¸€ç«¯ï¼Œåœ¨æ”¶åˆ°å¯¹ç«¯çš„FINæŠ¥æ–‡åè¿›å…¥&lt;code&gt;TIME_WAIT&lt;/code&gt;çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¸€èˆ¬è¦ä¿æŒä¸€ä¸ªè¾ƒé•¿çš„æ—¶é—´2MSLã€‚åŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;ç¡®ä¿æœ€åä¸€ä¸ªåº”ç­”FINçš„æŠ¥æ–‡ACKèƒ½å¤Ÿåˆ°è¾¾ã€‚å› ä¸ºå¦‚æœå¯¹ç«¯æ²¡æœ‰æ”¶åˆ°ACKåº”ç­”ï¼Œåˆ™ä¼šé‡å‘FINåŒ…ã€‚&lt;/li&gt;\n&lt;li&gt;è®©å½“å‰è¿æ¥åœ¨ç½‘ç»œä¸­å¯èƒ½çš„æ‰€æœ‰æŠ¥æ–‡è¾¾åˆ°ç”Ÿå­˜æœŸä¸Šé™åæ¶ˆå¤±ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸ä¼šæ”¶åˆ°æ—§çš„è¿æ¥çš„æ•°æ®ã€‚&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;ä¸‰æ¬¡æ¡æ‰‹å†…æ ¸å®ç°åŸç†ç¤ºæ„å›¾\&#34;&gt;ä¸‰æ¬¡æ¡æ‰‹å†…æ ¸å®ç°åŸç†ç¤ºæ„å›¾&lt;/h2&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://xly0713.github.io/post-images/1586239797212.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;é˜Ÿåˆ—é•¿åº¦é…ç½®\&#34;&gt;é˜Ÿåˆ—é•¿åº¦é…ç½®&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;SYNé˜Ÿåˆ—é•¿åº¦é…ç½®: &lt;code&gt;net.ipv4.tcp_max_syn_backlog = 8192 #SYN_RCVDçŠ¶æ€è¿æ¥çš„æœ€å¤§ä¸ªæ•°&lt;/code&gt;;&lt;/li&gt;\n&lt;li&gt;ACCEPTé˜Ÿåˆ—é•¿åº¦ï¼š\n&lt;ul&gt;\n&lt;li&gt;ç³»ç»Ÿå…¨å±€ï¼š &lt;code&gt;net.core.somaxconn = 262144 #ç³»ç»Ÿå…¨å±€ACCPETé˜Ÿåˆ—æœ€å¤§é•¿åº¦çš„é…ç½®&lt;/code&gt;&lt;/li&gt;\n&lt;li&gt;åº”ç”¨å±‚: socket API listenä¼ å‚æ§åˆ¶&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;synæ”»å‡»\&#34;&gt;SYNæ”»å‡»&lt;/h3&gt;\n&lt;p&gt;æ”»å‡»è€…è¿…é€Ÿä¼ªé€ ä¸åŒIPåœ°å€çš„SYNæŠ¥æ–‡ï¼Œå¿«é€Ÿå æ»¡SYNé˜Ÿåˆ—ï¼Œä½¿å¾—æ­£å¸¸çš„SYNåŒ…æ— æ³•åŠ å…¥é˜Ÿåˆ—ã€‚&lt;/p&gt;\n&lt;h4 id=\&#34;åº”å¯¹synæ”»å‡»çš„å‚æ•°\&#34;&gt;åº”å¯¹SYNæ”»å‡»çš„å‚æ•°&lt;/h4&gt;\n&lt;p&gt;&lt;code&gt;net.core.netdev_max_backlog = 262144 #æ¥æ”¶è‡ªç½‘å¡ã€ä½†æ˜¯æœªè¢«å†…æ ¸åè®®æ ˆå¤„ç†çš„IPæŠ¥æ–‡é˜Ÿåˆ—é•¿åº¦&lt;/code&gt;&lt;br&gt;\n&lt;code&gt;net.ipv4.tcp_max_syn_backlog = 8192 #SYN_RCVDçŠ¶æ€(åŠ)è¿æ¥çš„æœ€å¤§ä¸ªæ•°&lt;/code&gt;&lt;br&gt;\n&lt;code&gt;net.ipv4.tcp_abort_on_overflow = 1 #è®¾ç½®ä¸º1æ—¶è¡¨ç¤º: é˜Ÿåˆ—æ»¡åˆ™å“åº”RSTåŒ…ï¼Œä¸¢å¼ƒè¿æ¥&lt;/code&gt;&lt;/p&gt;\n&lt;h4 id=\&#34;tcp_syncookies\&#34;&gt;tcp_syncookies&lt;/h4&gt;\n&lt;p&gt;&lt;code&gt;net.ipv4.tcp_syncookies = 1 #å¯ç”¨tcp cookie, ä½¿å¾—SYNé˜Ÿåˆ—æ»¡ä»èƒ½å»ºç«‹è¿æ¥&lt;/code&gt;&lt;/p&gt;\n&lt;h3 id=\&#34;æ§åˆ¶tcpä¸‰æ¬¡æ¡æ‰‹çš„å‚æ•°\&#34;&gt;æ§åˆ¶TCPä¸‰æ¬¡æ¡æ‰‹çš„å‚æ•°&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;p&gt;SYN_SENTçŠ¶æ€&lt;br&gt;\n&lt;code&gt;net.ip4.tcp_syn_retries = 6 #ä¸»åŠ¨å»ºç«‹è¿æ¥ï¼Œå‘é€SYNçš„é‡è¯•æ¬¡æ•°&lt;/code&gt;&lt;br&gt;\n&lt;code&gt;net.ipv4.ip_local_port_range = 32768 60999 #å»ºç«‹è¿æ¥æ—¶çš„æœ¬åœ°ç«¯å£å¯é€‰èŒƒå›´&lt;/code&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;SYN_RCVDçŠ¶æ€&lt;br&gt;\n&lt;code&gt;net.ipv4.tcp_max_syn_backlog = 8192 #SYN_RCVDçŠ¶æ€(åŠ)è¿æ¥çš„æœ€å¤§ä¸ªæ•°&lt;/code&gt;&lt;br&gt;\n&lt;code&gt;net.ipv4.tcp_synack_retries = 3 #è¢«åŠ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå‘é€SYN/ACKçš„é‡è¯•æ¬¡æ•°&lt;/code&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;tfotcp-fast-open\&#34;&gt;TFO(TCP Fast Open)&lt;/h2&gt;\n&lt;p&gt;é…ç½®: &lt;code&gt;net.ipv4.tcp_fastopen&lt;/code&gt;ã€‚ï¼ˆ&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå†…æ ¸ç‰ˆæœ¬è¦æ±‚åœ¨Linux 3.7ä»¥ä¸Šï¼‰&lt;br&gt;\nå¯é€‰å€¼ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;0: å…³é—­(é»˜è®¤)&lt;/li&gt;\n&lt;li&gt;1: ä½œä¸ºå®¢æˆ·ç«¯æ—¶å¯ä»¥ä½¿ç”¨TFO&lt;/li&gt;\n&lt;li&gt;2: ä½œä¸ºæœåŠ¡ç«¯æ—¶å¯ä»¥ä½¿ç”¨TFO&lt;/li&gt;\n&lt;li&gt;3: éƒ½å¯ä»¥ä½¿ç”¨TFOï¼Œæ— è®ºæ˜¯ä½œä¸ºæœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h3 id=\&#34;ç¤ºæ„å›¾-2\&#34;&gt;ç¤ºæ„å›¾&lt;/h3&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://xly0713.github.io/post-images/1586580242109.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&#34;,&#34;fileName&#34;:&#34;tcp-xie-yi&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹tcpåè®®åŸºç¡€çŸ¥è¯†çš„æ•´ç†ä»‹ç»ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;TCPåè®®åŸºç¡€&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;ç½‘ç»œåè®®&#34;,&#34;slug&#34;:&#34;Q1k2X6rnU&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/Q1k2X6rnU/&#34;}],&#34;date&#34;:&#34;2020-02-02 20:41:15&#34;,&#34;dateFormat&#34;:&#34;2020-02-02&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://xly0713.github.io/post/tcp-xie-yi/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;4 min read&#34;,&#34;time&#34;:196000,&#34;words&#34;:882,&#34;minutes&#34;:4},&#34;description&#34;:&#34;æœ¬æ–‡æ˜¯å¯¹tcpåè®®åŸºç¡€çŸ¥è¯†çš„æ•´ç†ä»‹ç»ã€‚\n\ntcpå»ºè¿ã€æ–­è¿\nç¤ºæ„å›¾\n\nä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ\n\né˜²æ­¢å¤±æ•ˆçš„è¿æ¥è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ã€‚\nå…·ä½“æè¿°ï¼šå¦‚æœclientå‘é€çš„è¿æ¥è¯·æ±‚SYNåŒ…åœ¨ç½‘ç»œä¸­æ»ç•™äº†è¾ƒé•¿æ—¶é—´ï¼Œserveræœ€ç»ˆä»ä¼šæ”¶åˆ°å¹¶å‘å›è¿æ¥ç¡®è®¤SY...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#tcp%E5%BB%BA%E8%BF%9E-%E6%96%AD%E8%BF%9E\&#34;&gt;tcpå»ºè¿ã€æ–­è¿&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%A4%BA%E6%84%8F%E5%9B%BE\&#34;&gt;ç¤ºæ„å›¾&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B\&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#tcp%E9%9D%A2%E5%90%91%E8%BF%9E%E6%8E%A5%E4%BB%80%E4%B9%88%E5%90%AB%E4%B9%89\&#34;&gt;tcpé¢å‘è¿æ¥ä»€ä¹ˆå«ä¹‰ï¼Ÿ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B\&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#time_wait%E7%8A%B6%E6%80%81\&#34;&gt;TIME_WAITçŠ¶æ€&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%86%85%E6%A0%B8%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE\&#34;&gt;ä¸‰æ¬¡æ¡æ‰‹å†…æ ¸å®ç°åŸç†ç¤ºæ„å›¾&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%98%9F%E5%88%97%E9%95%BF%E5%BA%A6%E9%85%8D%E7%BD%AE\&#34;&gt;é˜Ÿåˆ—é•¿åº¦é…ç½®&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#syn%E6%94%BB%E5%87%BB\&#34;&gt;SYNæ”»å‡»&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BA%94%E5%AF%B9syn%E6%94%BB%E5%87%BB%E7%9A%84%E5%8F%82%E6%95%B0\&#34;&gt;åº”å¯¹SYNæ”»å‡»çš„å‚æ•°&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#tcp_syncookies\&#34;&gt;tcp_syncookies&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8E%A7%E5%88%B6tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E7%9A%84%E5%8F%82%E6%95%B0\&#34;&gt;æ§åˆ¶TCPä¸‰æ¬¡æ¡æ‰‹çš„å‚æ•°&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#tfotcp-fast-open\&#34;&gt;TFO(TCP Fast Open)&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%A4%BA%E6%84%8F%E5%9B%BE-2\&#34;&gt;ç¤ºæ„å›¾&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹DNSåè®®çš„ç®€å•æ•´ç†ä»‹ç»ã€‚&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;dnsæ˜¯ä»€ä¹ˆ\&#34;&gt;DNSæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;\n&lt;p&gt;DNSæ˜¯äº’è”ç½‘ä¸–ç•Œçš„åœ°å€è–„ï¼Œç±»ä¼¼äºç”µè¯æœ¬ï¼Œä¸»è¦æä¾›å°†åŸŸåæ˜ å°„åˆ°IPåœ°å€çš„åŠŸèƒ½ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;dnsçš„æ ‘çŠ¶å±‚æ¬¡ç»“æ„\&#34;&gt;DNSçš„æ ‘çŠ¶å±‚æ¬¡ç»“æ„&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;ç¬¬ä¸€å±‚: æ ¹DNSæœåŠ¡å™¨ï¼Œè´Ÿè´£è¿”å›é¡¶çº§DNS(TLD)æœåŠ¡å™¨çš„IPåœ°å€ã€‚ç›®å‰å…¨ä¸–ç•Œæœ‰13å°æœåŠ¡èŠ‚ç‚¹ã€‚&lt;/li&gt;\n&lt;li&gt;ç¬¬äºŒå±‚: TLDæœåŠ¡å™¨ï¼Œè´Ÿè´£è¿”å›æƒå¨DNSæœåŠ¡å™¨çš„IPåœ°å€ã€‚&lt;/li&gt;\n&lt;li&gt;ç¬¬ä¸‰å±‚: æƒå¨DNSæœåŠ¡å™¨ï¼Œè´Ÿè´£è¿”å›ç›¸åº”ä¸»æœºæˆ–åŸŸåçš„IPåœ°å€ã€‚&lt;br&gt;\n&lt;img src=\&#34;https://xly0713.github.io/post-images/1586003718190.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;dnsçš„è§£ææµç¨‹\&#34;&gt;DNSçš„è§£ææµç¨‹&lt;/h2&gt;\n&lt;p&gt;åœ¨æœªå‘½ä¸­ç¼“å­˜çš„æƒ…å†µä¸‹ï¼ŒDNSå®ŒæˆåŸŸåçš„è§£æéœ€è¦ç»è¿‡å¦‚ä¸‹æ­¥éª¤:&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥â€œexample.comâ€, æŸ¥è¯¢ç”±æœ¬åœ°DNSæœåŠ¡(&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;)è§£æå™¨æ¥æ”¶ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;æŸ¥è¯¢&lt;strong&gt;æ ¹DNSåŸŸåæœåŠ¡å™¨&lt;/strong&gt;ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æ ¹DNSæœåŠ¡å™¨&lt;/strong&gt;ä½¿ç”¨&lt;strong&gt;é¡¶çº§DNS(TLD)æœåŠ¡å™¨&lt;/strong&gt;(ä¾‹å¦‚.comæˆ–.net)çš„åœ°å€å“åº”ç»™&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;ã€‚å¦‚ï¼šâ€œexample.comâ€ï¼Œåˆ™è¿”å›.com TLDçš„IPåœ°å€ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;å‘.com&lt;strong&gt;é¡¶çº§DNS(TLD)æœåŠ¡å™¨&lt;/strong&gt;å‘å‡ºè¯·æ±‚ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;é¡¶çº§DNS(TLD)æœåŠ¡å™¨&lt;/strong&gt;å“åº”&lt;strong&gt;æƒå¨DNSæœåŠ¡å™¨&lt;/strong&gt;çš„IPåœ°å€ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;å‘&lt;strong&gt;æƒå¨DNSæœåŠ¡å™¨&lt;/strong&gt;ç¿»å‡ºè¯·æ±‚ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;æƒå¨DNSæœåŠ¡å™¨&lt;/strong&gt;å“åº”example.comçš„IPåœ°å€ç»™&lt;strong&gt;é€’å½’æœåŠ¡å™¨&lt;/strong&gt;ã€‚&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;é€’å½’DNSæœåŠ¡å™¨&lt;/strong&gt;å°†example.comçš„IPåœ°å€å“åº”ç»™æµè§ˆå™¨ã€‚ï¼ˆ&lt;em&gt;DNSè§£æå®Œæˆ&lt;/em&gt;ï¼‰&lt;/li&gt;\n&lt;li&gt;æµè§ˆå™¨å‘example.comçš„IPåœ°å€å‘å‡ºHTTPè¯·æ±‚...&lt;br&gt;\n&lt;img src=\&#34;https://xly0713.github.io/post-images/1586005095657.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;dnsç¼“å­˜\&#34;&gt;DNSç¼“å­˜&lt;/h2&gt;\n&lt;p&gt;åœ¨æœªå‘½ä¸­ç¼“å­˜çš„æƒ…å½¢ä¸‹ï¼ŒDNSè§£æçš„æµç¨‹æ˜¯å¤æ‚ä¸”è€—æ—¶çš„ã€‚DNSæ•°æ®å¯ä»¥è¢«ç¼“å­˜åœ¨å¤šä¸ªä½ç½®ï¼Œæ¯ä¸ªä½ç½®å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…(è®°å½•ç”Ÿå­˜æ—¶é—´TTL)ç¼“å­˜DNSæ•°æ®è®°å½•:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;æµè§ˆå™¨DNSç¼“å­˜&lt;/li&gt;\n&lt;li&gt;æ“ä½œç³»ç»Ÿçº§DNSç¼“å­˜&lt;/li&gt;\n&lt;li&gt;é€’å½’DNSæœåŠ¡å™¨çº§åˆ«ç¼“å­˜ã€‚&lt;em&gt;å¦‚æœåŸŸåç¼“å­˜æœªå‘½ä¸­ï¼Œä½†æ˜¯å‘½ä¸­äº†è¯¥åŸŸåçš„NSè®°å½•ï¼Œåˆ™è·³è¿‡è¯·æ±‚æ ¹å’ŒTLDæœåŠ¡å™¨ï¼›å¦‚æœæ²¡æœ‰NSè®°å½•ï¼Œä½†æ˜¯å‘½ä¸­äº†TLDçš„è®°å½•ï¼Œåˆ™è·³è¿‡è¯·æ±‚æ ¹æœåŠ¡å™¨ï¼›å¦‚æœæ²¡æœ‰å‘½ä¸­TLDçš„è®°å½•ï¼Œåˆ™è¦å®Œæ•´èµ°å®Œè¿­ä»£è®¿é—®æ ¹DNSæœåŠ¡å™¨åˆ°æƒå¨æœåŠ¡å™¨è¿™ä¸€å…¨æµç¨‹äº†ã€‚&lt;/em&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;dnsè®°å½•ç±»å‹\&#34;&gt;DNSè®°å½•ç±»å‹&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;å¸¸è§ç±»å‹ï¼š&lt;/li&gt;\n&lt;/ul&gt;\n&lt;ol&gt;\n&lt;li&gt;Aè®°å½•: åŸŸåæ˜ å°„çš„IPv4åœ°å€ã€‚&lt;/li&gt;\n&lt;li&gt;CNAMEè®°å½•ï¼šåŸŸååˆ«åæ˜ å°„ï¼Œå°†åŸŸåæŒ‡å‘å¦å¤–ä¸€ä¸ªåŸŸåã€‚&lt;/li&gt;\n&lt;li&gt;NSè®°å½•ï¼šåŸŸåæ˜ å°„çš„æƒå¨æœåŠ¡å™¨è®°å½•ã€‚&lt;/li&gt;\n&lt;li&gt;AAAAè®°å½•ï¼šåŸŸåæ˜ å°„çš„IPv6åœ°å€ã€‚&lt;/li&gt;\n&lt;li&gt;MXè®°å½•ï¼šåŸŸåæ˜ å°„çš„é‚®ç®±æœåŠ¡å™¨åœ°å€ã€‚&lt;/li&gt;\n&lt;li&gt;TXTè®°å½•ï¼šå…è®¸ç®¡ç†å‘˜åœ¨è®°å½•ä¸­å­˜å‚¨æ–‡æœ¬ã€‚&lt;/li&gt;\n&lt;li&gt;SOAè®°å½•ï¼šå­˜å‚¨æœ‰å…³åŸŸçš„ç®¡ç†å‘˜ä¿¡æ¯ã€‚&lt;/li&gt;\n&lt;li&gt;SRVè®°å½•ï¼šæŒ‡å®šç‰¹å®šæœåŠ¡çš„ç«¯å£ã€‚&lt;/li&gt;\n&lt;li&gt;PTRè®°å½•ï¼šåœ¨åå‘æŸ¥è¯¢ä¸­æä¾›åŸŸåã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;dnsåè®®æŠ¥æ–‡æ ¼å¼\&#34;&gt;DNSåè®®æŠ¥æ–‡æ ¼å¼&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;https://jocent.me/2017/06/18/dns-protocol-principle.html&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;èƒ¶æ°´è®°å½•glue-record\&#34;&gt;èƒ¶æ°´è®°å½•(Glue record)&lt;/h2&gt;\n&lt;p&gt;å½“ç»™&lt;strong&gt;åŸŸåA&lt;/strong&gt;é…ç½®NSè®°å½•æ—¶ï¼Œå¦‚æœNSè®°å½•ä¸º&lt;strong&gt;åŸŸåA&lt;/strong&gt;çš„å­åŸŸåï¼Œåˆ™å¿…é¡»é…ç½®NSè®°å½•çš„Aè®°å½•ã€‚&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;é€šå¸¸éœ€è¦åœ¨åŸŸåæä¾›å•†å“ªé‡Œç”³è¯·ä¸¤ä¸ªåŸŸåï¼Œè€Œä¸å»ºè®®é‡‡ç”¨èƒ¶æ°´è®°å½•æ–¹å¼ã€‚&lt;/li&gt;\n&lt;li&gt;å‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/7d69ec2976c7&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=\&#34;dnsä¼˜ç§€çš„goå¼€æºé¡¹ç›®\&#34;&gt;DNSä¼˜ç§€çš„goå¼€æºé¡¹ç›®&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;https://github.com/miekg/dns&lt;/li&gt;\n&lt;li&gt;https://github.com/abh/geodns ï¼ˆä½¿ç”¨miekg/dnsï¼‰&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;dns&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹DNSåè®®çš„ç®€å•æ•´ç†ä»‹ç»ã€‚&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;DNSåè®®åŸºç¡€&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;ç½‘ç»œåè®®&#34;,&#34;slug&#34;:&#34;Q1k2X6rnU&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/Q1k2X6rnU/&#34;},{&#34;name&#34;:&#34;GSLB&#34;,&#34;slug&#34;:&#34;pRwAbJURI&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://xly0713.github.io/tag/pRwAbJURI/&#34;}],&#34;date&#34;:&#34;2020-01-30 20:31:48&#34;,&#34;dateFormat&#34;:&#34;2020-01-30&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://xly0713.github.io/post/dns/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;3 min read&#34;,&#34;time&#34;:176000,&#34;words&#34;:794,&#34;minutes&#34;:3},&#34;description&#34;:&#34;æœ¬æ–‡æ˜¯å¯¹DNSåè®®çš„ç®€å•æ•´ç†ä»‹ç»ã€‚\n\nDNSæ˜¯ä»€ä¹ˆï¼Ÿ\nDNSæ˜¯äº’è”ç½‘ä¸–ç•Œçš„åœ°å€è–„ï¼Œç±»ä¼¼äºç”µè¯æœ¬ï¼Œä¸»è¦æä¾›å°†åŸŸåæ˜ å°„åˆ°IPåœ°å€çš„åŠŸèƒ½ã€‚\nDNSçš„æ ‘çŠ¶å±‚æ¬¡ç»“æ„\n\nç¬¬ä¸€å±‚: æ ¹DNSæœåŠ¡å™¨ï¼Œè´Ÿè´£è¿”å›é¡¶çº§DNS(TLD)æœåŠ¡å™¨çš„IPåœ°å€ã€‚ç›®å‰å…¨ä¸–ç•Œ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#dns%E6%98%AF%E4%BB%80%E4%B9%88\&#34;&gt;DNSæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#dns%E7%9A%84%E6%A0%91%E7%8A%B6%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84\&#34;&gt;DNSçš„æ ‘çŠ¶å±‚æ¬¡ç»“æ„&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#dns%E7%9A%84%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B\&#34;&gt;DNSçš„è§£ææµç¨‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#dns%E7%BC%93%E5%AD%98\&#34;&gt;DNSç¼“å­˜&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#dns%E8%AE%B0%E5%BD%95%E7%B1%BB%E5%9E%8B\&#34;&gt;DNSè®°å½•ç±»å‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#dns%E5%8D%8F%E8%AE%AE%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F\&#34;&gt;DNSåè®®æŠ¥æ–‡æ ¼å¼&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%83%B6%E6%B0%B4%E8%AE%B0%E5%BD%95glue-record\&#34;&gt;èƒ¶æ°´è®°å½•(Glue record)&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#dns%E4%BC%98%E7%A7%80%E7%9A%84go%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE\&#34;&gt;DNSä¼˜ç§€çš„goå¼€æºé¡¹ç›®&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;å…³äºæœ¬ç«™\&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/h2&gt;\n&lt;p&gt;æœ¬ç«™ä¸»è¦ç”¨æ¥è®°å½•ä¸€äº›æŠ€æœ¯ï¼Œå¸®åŠ©è‡ªå·±æ•´ç†é›¶ç¢çš„çŸ¥è¯†ï¼Œå¸Œæœ›å¯¹ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚æ¬¢è¿&lt;a href=\&#34;/atom.xml\&#34;&gt;RSS&lt;/a&gt;è®¢é˜…æœ¬ç«™ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;åšä¸»æ˜¯è°\&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/h2&gt;\n&lt;p&gt;åšä¸»æ˜¯ä¸€ååå°ç ”å‘æ”»åŸç‹®ï¼Œå…³æ³¨äº‘è®¡ç®—ç›¸å…³é¢†åŸŸï¼Œç›®å‰ä¸“æ³¨äºCDNæŠ€æœ¯å’Œç›´æ’­æŠ€æœ¯ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;è”ç³»æˆ‘å‘€\&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;é‚®ä»¶: xly880713@gmail.com&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;fileName&#34;:&#34;about&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;å…³äº&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2019-01-25 19:09:48&#34;,&#34;dateFormat&#34;:&#34;2019-01-25&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://xly0713.github.io/post/about/&#34;,&#34;hideInList&#34;:true,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:21000,&#34;words&#34;:105,&#34;minutes&#34;:1},&#34;description&#34;:&#34;\næ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤\n\nğŸ  å…³äºæœ¬ç«™\næœ¬ç«™ä¸»è¦ç”¨æ¥è®°å½•ä¸€äº›æŠ€æœ¯ï¼Œå¸®åŠ©è‡ªå·±æ•´ç†é›¶ç¢çš„çŸ¥è¯†ï¼Œå¸Œæœ›å¯¹ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚æ¬¢è¿RSSè®¢é˜…æœ¬ç«™ã€‚\nğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°\nåšä¸»æ˜¯ä¸€ååå°ç ”å‘æ”»åŸç‹®ï¼Œå…³æ³¨äº‘è®¡ç®—ç›¸å…³é¢†åŸŸï¼Œç›®å‰ä¸“æ³¨äºCDNæŠ€æœ¯...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99\&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8D%9A%E4%B8%BB%E6%98%AF%E8%B0%81\&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%81%94%E7%B3%BB%E6%88%91%E5%91%80\&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;}]";
  // var json = escape.substr(1, escape.length - 2);
  // var datas = json.split(',');
  // for (let i=0; i < datas.length; i++) {
  //   let item = datas[i];
  //   let attrs = item.split('34;:&#34')
  //   debugger
  //   console.log(datas[i])
  // }
  let escapeMap = new Map();
  escapeMap.set('&#34;', '"');
  escapeMap.set('&gt;', '>');
  escapeMap.set('&#39;', "'");
  escapeMap.set('&lt;', '<');
  escapeMap.set('&quot;', '"');
  escapeMap.set('&amp;', '&');
</script> -->

<script src="/media/js/mouse/love.js"></script>

<!-- <script src="/media/js/mouse/peace.js"></script> -->
</html>